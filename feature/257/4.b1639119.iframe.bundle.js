/*! For license information please see 4.b1639119.iframe.bundle.js.LICENSE.txt */
(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{1e3:function(module,exports,__webpack_require__){"use strict";exports.__esModule=!0,exports.VideoInsertMode=void 0,function(VideoInsertMode){VideoInsertMode.AFTER="AFTER",VideoInsertMode.APPEND="APPEND",VideoInsertMode.BEFORE="BEFORE",VideoInsertMode.PREPEND="PREPEND",VideoInsertMode.REPLACE="REPLACE"}(exports.VideoInsertMode||(exports.VideoInsertMode={}))},1003:function(module,exports,__webpack_require__){"use strict";var extendStatics,__extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}),__awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},__generator=this&&this.__generator||function(thisArg,body){var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=_.trys,(t=t.length>0&&t[t.length-1])||6!==op[0]&&2!==op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}};exports.__esModule=!0,exports.Publisher=void 0;var platform,Session_1=__webpack_require__(999),Stream_1=__webpack_require__(1004),StreamManager_1=__webpack_require__(1007),StreamEvent_1=__webpack_require__(1013),StreamPropertyChangedEvent_1=__webpack_require__(995),VideoElementEvent_1=__webpack_require__(1011),OpenViduError_1=__webpack_require__(996),OpenViduLogger_1=__webpack_require__(992),Platform_1=__webpack_require__(994),logger=OpenViduLogger_1.OpenViduLogger.getInstance(),Publisher=function(_super){function Publisher(targEl,properties,openvidu){var _this=_super.call(this,new Stream_1.Stream(openvidu.session?openvidu.session:new Session_1.Session(openvidu),{publisherProperties:properties,mediaConstraints:{}}),targEl)||this;return _this.accessAllowed=!1,_this.isSubscribedToRemote=!1,_this.accessDenied=!1,platform=Platform_1.PlatformUtils.getInstance(),_this.properties=properties,_this.openvidu=openvidu,_this.stream.ee.on("local-stream-destroyed",(function(reason){_this.stream.isLocalStreamPublished=!1;var streamEvent=new StreamEvent_1.StreamEvent(!0,_this,"streamDestroyed",_this.stream,reason);_this.emitEvent("streamDestroyed",[streamEvent]),streamEvent.callDefaultBehavior()})),_this}return __extends(Publisher,_super),Publisher.prototype.publishAudio=function(value){var _this=this;this.stream.audioActive!==value&&((this.stream.displayMyRemote()?this.stream.localMediaStreamWhenSubscribedToRemote:this.stream.getMediaStream()).getAudioTracks().forEach((function(track){track.enabled=value})),this.session&&this.stream.streamId&&this.session.openvidu.sendRequest("streamPropertyChanged",{streamId:this.stream.streamId,property:"audioActive",newValue:value,reason:"publishAudio"},(function(error,response){error?logger.error("Error sending 'streamPropertyChanged' event",error):(_this.session.emitEvent("streamPropertyChanged",[new StreamPropertyChangedEvent_1.StreamPropertyChangedEvent(_this.session,_this.stream,"audioActive",value,!value,"publishAudio")]),_this.emitEvent("streamPropertyChanged",[new StreamPropertyChangedEvent_1.StreamPropertyChangedEvent(_this,_this.stream,"audioActive",value,!value,"publishAudio")]),_this.session.sendVideoData(_this.stream.streamManager))})),this.stream.audioActive=value,logger.info("'Publisher' has "+(value?"published":"unpublished")+" its audio stream"))},Publisher.prototype.publishVideo=function(value){var _this=this;this.stream.videoActive!==value&&((this.stream.displayMyRemote()?this.stream.localMediaStreamWhenSubscribedToRemote:this.stream.getMediaStream()).getVideoTracks().forEach((function(track){track.enabled=value})),this.session&&this.stream.streamId&&this.session.openvidu.sendRequest("streamPropertyChanged",{streamId:this.stream.streamId,property:"videoActive",newValue:value,reason:"publishVideo"},(function(error,response){error?logger.error("Error sending 'streamPropertyChanged' event",error):(_this.session.emitEvent("streamPropertyChanged",[new StreamPropertyChangedEvent_1.StreamPropertyChangedEvent(_this.session,_this.stream,"videoActive",value,!value,"publishVideo")]),_this.emitEvent("streamPropertyChanged",[new StreamPropertyChangedEvent_1.StreamPropertyChangedEvent(_this,_this.stream,"videoActive",value,!value,"publishVideo")]),_this.session.sendVideoData(_this.stream.streamManager))})),this.stream.videoActive=value,logger.info("'Publisher' has "+(value?"published":"unpublished")+" its video stream"))},Publisher.prototype.subscribeToRemote=function(value){value=void 0===value||value,this.isSubscribedToRemote=value,this.stream.subscribeToMyRemote(value)},Publisher.prototype.on=function(type,handler){var _this=this;return _super.prototype.on.call(this,type,handler),"streamCreated"===type&&(this.stream&&this.stream.isLocalStreamPublished?this.emitEvent("streamCreated",[new StreamEvent_1.StreamEvent(!1,this,"streamCreated",this.stream,"")]):this.stream.ee.on("stream-created-by-publisher",(function(){_this.emitEvent("streamCreated",[new StreamEvent_1.StreamEvent(!1,_this,"streamCreated",_this.stream,"")])}))),"remoteVideoPlaying"===type&&this.stream.displayMyRemote()&&this.videos[0]&&this.videos[0].video&&this.videos[0].video.currentTime>0&&!1===this.videos[0].video.paused&&!1===this.videos[0].video.ended&&4===this.videos[0].video.readyState&&this.emitEvent("remoteVideoPlaying",[new VideoElementEvent_1.VideoElementEvent(this.videos[0].video,this,"remoteVideoPlaying")]),"accessAllowed"===type&&this.accessAllowed&&this.emitEvent("accessAllowed",[]),"accessDenied"===type&&this.accessDenied&&this.emitEvent("accessDenied",[]),this},Publisher.prototype.once=function(type,handler){var _this=this;return _super.prototype.once.call(this,type,handler),"streamCreated"===type&&(this.stream&&this.stream.isLocalStreamPublished?this.emitEvent("streamCreated",[new StreamEvent_1.StreamEvent(!1,this,"streamCreated",this.stream,"")]):this.stream.ee.once("stream-created-by-publisher",(function(){_this.emitEvent("streamCreated",[new StreamEvent_1.StreamEvent(!1,_this,"streamCreated",_this.stream,"")])}))),"remoteVideoPlaying"===type&&this.stream.displayMyRemote()&&this.videos[0]&&this.videos[0].video&&this.videos[0].video.currentTime>0&&!1===this.videos[0].video.paused&&!1===this.videos[0].video.ended&&4===this.videos[0].video.readyState&&this.emitEvent("remoteVideoPlaying",[new VideoElementEvent_1.VideoElementEvent(this.videos[0].video,this,"remoteVideoPlaying")]),"accessAllowed"===type&&this.accessAllowed&&this.emitEvent("accessAllowed",[]),"accessDenied"===type&&this.accessDenied&&this.emitEvent("accessDenied",[]),this},Publisher.prototype.replaceTrack=function(track){return __awaiter(this,void 0,void 0,(function(){var replaceTrackInMediaStream,replaceTrackInRtcRtpSender,trackOriginalEnabledValue,error_1,_this=this;return __generator(this,(function(_a){switch(_a.label){case 0:replaceTrackInMediaStream=function(){return new Promise((function(resolve,reject){var removedTrack,mediaStream=_this.stream.displayMyRemote()?_this.stream.localMediaStreamWhenSubscribedToRemote:_this.stream.getMediaStream();removedTrack="video"===track.kind?mediaStream.getVideoTracks()[0]:mediaStream.getAudioTracks()[0],mediaStream.removeTrack(removedTrack),removedTrack.stop(),mediaStream.addTrack(track),"video"===track.kind&&_this.stream.isLocalStreamPublished&&(_this.openvidu.sendNewVideoDimensionsIfRequired(_this,"trackReplaced",50,30),_this.session.sendVideoData(_this.stream.streamManager,5,!0,5)),resolve()}))},replaceTrackInRtcRtpSender=function(){return new Promise((function(resolve,reject){var sender,senders=_this.stream.getRTCPeerConnection().getSenders();if("video"===track.kind){if(!(sender=senders.find((function(s){return!!s.track&&"video"===s.track.kind}))))return void reject(new Error("There's no replaceable track for that kind of MediaStreamTrack in this Publisher object"))}else{if("audio"!==track.kind)return void reject(new Error("Unknown track kind "+track.kind));if(!(sender=senders.find((function(s){return!!s.track&&"audio"===s.track.kind}))))return void reject(new Error("There's no replaceable track for that kind of MediaStreamTrack in this Publisher object"))}sender.replaceTrack(track).then((function(){resolve()})).catch((function(error){reject(error)}))}))},trackOriginalEnabledValue=track.enabled,"video"===track.kind?track.enabled=this.stream.videoActive:"audio"===track.kind&&(track.enabled=this.stream.audioActive),_a.label=1;case 1:return _a.trys.push([1,7,,8]),this.stream.isLocalStreamPublished?[4,replaceTrackInRtcRtpSender()]:[3,4];case 2:return _a.sent(),[4,replaceTrackInMediaStream()];case 3:return[2,_a.sent()];case 4:return[4,replaceTrackInMediaStream()];case 5:return[2,_a.sent()];case 6:return[3,8];case 7:throw error_1=_a.sent(),track.enabled=trackOriginalEnabledValue,error_1;case 8:return[2]}}))}))},Publisher.prototype.initialize=function(){var _this=this;return new Promise((function(resolve,reject){var startTime,constraints={},constraintsAux={},errorCallback=function(openViduError){_this.accessDenied=!0,_this.accessAllowed=!1,reject(openViduError)},successCallback=function(mediaStream){if(_this.accessAllowed=!0,_this.accessDenied=!1,"undefined"!=typeof MediaStreamTrack&&_this.properties.audioSource instanceof MediaStreamTrack&&(mediaStream.removeTrack(mediaStream.getAudioTracks()[0]),mediaStream.addTrack(_this.properties.audioSource)),"undefined"!=typeof MediaStreamTrack&&_this.properties.videoSource instanceof MediaStreamTrack&&(mediaStream.removeTrack(mediaStream.getVideoTracks()[0]),mediaStream.addTrack(_this.properties.videoSource)),mediaStream.getAudioTracks()[0]){var enabled=void 0!==_this.stream.audioActive&&null!==_this.stream.audioActive?_this.stream.audioActive:!!_this.stream.outboundStreamOpts.publisherProperties.publishAudio;mediaStream.getAudioTracks()[0].enabled=enabled}if(mediaStream.getVideoTracks()[0]){enabled=void 0!==_this.stream.videoActive&&null!==_this.stream.videoActive?_this.stream.videoActive:!!_this.stream.outboundStreamOpts.publisherProperties.publishVideo;mediaStream.getVideoTracks()[0].enabled=enabled}_this.initializeVideoReference(mediaStream),_this.stream.displayMyRemote()||_this.stream.updateMediaStreamInVideos(),delete _this.firstVideoElement,_this.stream.isSendVideo()?_this.getVideoDimensions(mediaStream).then((function(dimensions){_this.stream.videoDimensions={width:dimensions.width,height:dimensions.height},_this.stream.isSendScreen()&&(_this.screenShareResizeInterval=setInterval((function(){var settings=mediaStream.getVideoTracks()[0].getSettings(),newWidth=settings.width,newHeight=settings.height;!_this.stream.isLocalStreamPublished||newWidth===_this.stream.videoDimensions.width&&newHeight===_this.stream.videoDimensions.height||_this.openvidu.sendVideoDimensionsChangedEvent(_this,"screenResized",_this.stream.videoDimensions.width,_this.stream.videoDimensions.height,newWidth||0,newHeight||0)}),650)),_this.stream.isLocalStreamReadyToPublish=!0,_this.stream.ee.emitEvent("stream-ready-to-publish",[])})):(_this.stream.isLocalStreamReadyToPublish=!0,_this.stream.ee.emitEvent("stream-ready-to-publish",[])),resolve()},getMediaSuccess=function(mediaStream,definedAudioConstraint){_this.clearPermissionDialogTimer(startTime,1500),_this.stream.isSendScreen()&&_this.stream.isSendAudio()?(constraintsAux.audio=definedAudioConstraint,constraintsAux.video=!1,startTime=Date.now(),_this.setPermissionDialogTimer(1500),navigator.mediaDevices.getUserMedia(constraintsAux).then((function(audioOnlyStream){_this.clearPermissionDialogTimer(startTime,1500),mediaStream.addTrack(audioOnlyStream.getAudioTracks()[0]),successCallback(mediaStream)})).catch((function(error){_this.clearPermissionDialogTimer(startTime,1500),mediaStream.getAudioTracks().forEach((function(track){track.stop()})),mediaStream.getVideoTracks().forEach((function(track){track.stop()})),errorCallback(_this.openvidu.generateAudioDeviceError(error,constraints))}))):successCallback(mediaStream)},getMediaError=function(error){var errorName,errorMessage;switch(logger.error(error),_this.clearPermissionDialogTimer(startTime,1500),"Error"===error.name&&(error.name=error.constructor.name),error.name.toLowerCase()){case"notfounderror":navigator.mediaDevices.getUserMedia({audio:!1,video:constraints.video}).then((function(mediaStream){mediaStream.getVideoTracks().forEach((function(track){track.stop()})),errorName=OpenViduError_1.OpenViduErrorName.INPUT_AUDIO_DEVICE_NOT_FOUND,errorMessage=error.toString(),errorCallback(new OpenViduError_1.OpenViduError(errorName,errorMessage))})).catch((function(e){errorName=OpenViduError_1.OpenViduErrorName.INPUT_VIDEO_DEVICE_NOT_FOUND,errorMessage=error.toString(),errorCallback(new OpenViduError_1.OpenViduError(errorName,errorMessage))}));break;case"notallowederror":errorName=_this.stream.isSendScreen()?OpenViduError_1.OpenViduErrorName.SCREEN_CAPTURE_DENIED:OpenViduError_1.OpenViduErrorName.DEVICE_ACCESS_DENIED,errorMessage=error.toString(),errorCallback(new OpenViduError_1.OpenViduError(errorName,errorMessage));break;case"overconstrainederror":navigator.mediaDevices.getUserMedia({audio:!1,video:constraints.video}).then((function(mediaStream){mediaStream.getVideoTracks().forEach((function(track){track.stop()})),"deviceid"===error.constraint.toLowerCase()?(errorName=OpenViduError_1.OpenViduErrorName.INPUT_AUDIO_DEVICE_NOT_FOUND,errorMessage="Audio input device with deviceId '"+constraints.audio.deviceId.exact+"' not found"):(errorName=OpenViduError_1.OpenViduErrorName.PUBLISHER_PROPERTIES_ERROR,errorMessage="Audio input device doesn't support the value passed for constraint '"+error.constraint+"'"),errorCallback(new OpenViduError_1.OpenViduError(errorName,errorMessage))})).catch((function(e){"deviceid"===error.constraint.toLowerCase()?(errorName=OpenViduError_1.OpenViduErrorName.INPUT_VIDEO_DEVICE_NOT_FOUND,errorMessage="Video input device with deviceId '"+constraints.video.deviceId.exact+"' not found"):(errorName=OpenViduError_1.OpenViduErrorName.PUBLISHER_PROPERTIES_ERROR,errorMessage="Video input device doesn't support the value passed for constraint '"+error.constraint+"'"),errorCallback(new OpenViduError_1.OpenViduError(errorName,errorMessage))}));break;case"aborterror":case"notreadableerror":errorName=OpenViduError_1.OpenViduErrorName.DEVICE_ALREADY_IN_USE,errorMessage=error.toString(),errorCallback(new OpenViduError_1.OpenViduError(errorName,errorMessage));break;default:errorName=OpenViduError_1.OpenViduErrorName.GENERIC_ERROR,errorMessage=error.toString(),errorCallback(new OpenViduError_1.OpenViduError(errorName,errorMessage))}};_this.openvidu.generateMediaConstraints(_this.properties).then((function(myConstraints){var _a,_b;if(myConstraints.videoTrack&&myConstraints.audioTrack||myConstraints.audioTrack&&!1===(null===(_a=myConstraints.constraints)||void 0===_a?void 0:_a.video)||myConstraints.videoTrack&&!1===(null===(_b=myConstraints.constraints)||void 0===_b?void 0:_b.audio))successCallback(_this.openvidu.addAlreadyProvidedTracks(myConstraints,new MediaStream));else{var outboundStreamOptions={mediaConstraints:constraints=myConstraints.constraints,publisherProperties:_this.properties};_this.stream.setOutboundStreamOptions(outboundStreamOptions);var definedAudioConstraint=void 0===constraints.audio||constraints.audio;constraintsAux.audio=!_this.stream.isSendScreen()&&definedAudioConstraint,constraintsAux.video=constraints.video,startTime=Date.now(),_this.setPermissionDialogTimer(1500),_this.stream.isSendScreen()&&navigator.mediaDevices.getDisplayMedia&&!platform.isElectron()?navigator.mediaDevices.getDisplayMedia({video:!0}).then((function(mediaStream){_this.openvidu.addAlreadyProvidedTracks(myConstraints,mediaStream),getMediaSuccess(mediaStream,definedAudioConstraint)})).catch((function(error){getMediaError(error)})):navigator.mediaDevices.getUserMedia(constraintsAux).then((function(mediaStream){_this.openvidu.addAlreadyProvidedTracks(myConstraints,mediaStream),getMediaSuccess(mediaStream,definedAudioConstraint)})).catch((function(error){getMediaError(error)}))}})).catch((function(error){errorCallback(error)}))}))},Publisher.prototype.getVideoDimensions=function(mediaStream){var _this=this;return new Promise((function(resolve,reject){var loadedmetadataListener,requiresDomInsertion=platform.isIonicIos()||platform.isIOSWithSafari(),resolveDimensions=function(){var width,height;if("function"==typeof _this.stream.getMediaStream().getVideoTracks()[0].getSettings){var settings=_this.stream.getMediaStream().getVideoTracks()[0].getSettings();width=settings.width||_this.videoReference.videoWidth,height=settings.height||_this.videoReference.videoHeight}else logger.warn("MediaStreamTrack does not have getSettings method on "+platform.getDescription()),width=_this.videoReference.videoWidth,height=_this.videoReference.videoHeight;null!=loadedmetadataListener&&_this.videoReference.removeEventListener("loadedmetadata",loadedmetadataListener),requiresDomInsertion&&document.body.removeChild(_this.videoReference),resolve({width:width,height:height})};_this.videoReference.readyState>=1?resolveDimensions():(loadedmetadataListener=function(){if(_this.videoReference.videoWidth)resolveDimensions();else var interval_1=setInterval((function(){_this.videoReference.videoWidth&&(clearInterval(interval_1),resolveDimensions())}),40)},_this.videoReference.addEventListener("loadedmetadata",loadedmetadataListener),requiresDomInsertion&&document.body.appendChild(_this.videoReference))}))},Publisher.prototype.reestablishStreamPlayingEvent=function(){this.ee.getListeners("streamPlaying").length>0&&this.addPlayEventToFirstVideo()},Publisher.prototype.initializeVideoReference=function(mediaStream){this.videoReference=document.createElement("video"),this.videoReference.setAttribute("muted","true"),this.videoReference.style.display="none",platform.isSafariBrowser()&&this.videoReference.setAttribute("playsinline","true"),this.stream.setMediaStream(mediaStream),this.firstVideoElement&&this.createVideoElement(this.firstVideoElement.targetElement,this.properties.insertMode),this.videoReference.srcObject=mediaStream},Publisher.prototype.setPermissionDialogTimer=function(waitTime){var _this=this;this.permissionDialogTimeout=setTimeout((function(){_this.emitEvent("accessDialogOpened",[])}),waitTime)},Publisher.prototype.clearPermissionDialogTimer=function(startTime,waitTime){clearTimeout(this.permissionDialogTimeout),Date.now()-startTime>waitTime&&this.emitEvent("accessDialogClosed",[])},Publisher}(StreamManager_1.StreamManager);exports.Publisher=Publisher},1004:function(module,exports,__webpack_require__){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},__generator=this&&this.__generator||function(thisArg,body){var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=_.trys,(t=t.length>0&&t[t.length-1])||6!==op[0]&&2!==op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}};exports.__esModule=!0,exports.Stream=void 0;var platform,Filter_1=__webpack_require__(1005),Subscriber_1=__webpack_require__(1006),WebRtcPeer_1=__webpack_require__(1091),WebRtcStats_1=__webpack_require__(1096),ExceptionEvent_1=__webpack_require__(998),PublisherSpeakingEvent_1=__webpack_require__(1029),StreamManagerEvent_1=__webpack_require__(1010),StreamPropertyChangedEvent_1=__webpack_require__(995),OpenViduError_1=__webpack_require__(996),OpenViduLogger_1=__webpack_require__(992),Platform_1=__webpack_require__(994),hark=__webpack_require__(1097),EventEmitter=__webpack_require__(1009),logger=OpenViduLogger_1.OpenViduLogger.getInstance(),Stream=function(){function Stream(session,options){var _this=this;this.isSubscribeToRemote=!1,this.isLocalStreamReadyToPublish=!1,this.isLocalStreamPublished=!1,this.publishedOnce=!1,this.harkSpeakingEnabled=!1,this.harkSpeakingEnabledOnce=!1,this.harkStoppedSpeakingEnabled=!1,this.harkStoppedSpeakingEnabledOnce=!1,this.harkVolumeChangeEnabled=!1,this.harkVolumeChangeEnabledOnce=!1,this.ee=new EventEmitter,platform=Platform_1.PlatformUtils.getInstance(),this.session=session,options.hasOwnProperty("id")?(this.inboundStreamOpts=options,this.streamId=this.inboundStreamOpts.id,this.creationTime=this.inboundStreamOpts.createdAt,this.hasAudio=this.inboundStreamOpts.hasAudio,this.hasVideo=this.inboundStreamOpts.hasVideo,this.hasAudio&&(this.audioActive=this.inboundStreamOpts.audioActive),this.hasVideo&&(this.videoActive=this.inboundStreamOpts.videoActive,this.typeOfVideo=this.inboundStreamOpts.typeOfVideo?this.inboundStreamOpts.typeOfVideo:void 0,this.frameRate=-1===this.inboundStreamOpts.frameRate?void 0:this.inboundStreamOpts.frameRate,this.videoDimensions=this.inboundStreamOpts.videoDimensions),this.inboundStreamOpts.filter&&Object.keys(this.inboundStreamOpts.filter).length>0&&(this.inboundStreamOpts.filter.lastExecMethod&&0===Object.keys(this.inboundStreamOpts.filter.lastExecMethod).length&&delete this.inboundStreamOpts.filter.lastExecMethod,this.filter=this.inboundStreamOpts.filter)):(this.outboundStreamOpts=options,this.hasAudio=this.isSendAudio(),this.hasVideo=this.isSendVideo(),this.hasAudio&&(this.audioActive=!!this.outboundStreamOpts.publisherProperties.publishAudio),this.hasVideo&&(this.videoActive=!!this.outboundStreamOpts.publisherProperties.publishVideo,this.frameRate=this.outboundStreamOpts.publisherProperties.frameRate,"undefined"!=typeof MediaStreamTrack&&this.outboundStreamOpts.publisherProperties.videoSource instanceof MediaStreamTrack?this.typeOfVideo="CUSTOM":this.typeOfVideo=this.isSendScreen()?"SCREEN":"CAMERA"),this.outboundStreamOpts.publisherProperties.filter&&(this.filter=this.outboundStreamOpts.publisherProperties.filter)),this.ee.on("mediastream-updated",(function(){_this.streamManager.updateMediaStream(_this.mediaStream),logger.debug("Video srcObject ["+_this.mediaStream+"] updated in stream ["+_this.streamId+"]")}))}return Stream.prototype.reconnect=function(){return this.reconnectStream("API")},Stream.prototype.applyFilter=function(type,options){var _this=this;return new Promise((function(resolve,reject){_this.session.sessionConnected()||reject(_this.session.notConnectedError()),logger.info("Applying filter to stream "+_this.streamId);var optionsString=options=null!=options?options:{};"string"!=typeof optionsString&&(optionsString=JSON.stringify(optionsString)),_this.session.openvidu.sendRequest("applyFilter",{streamId:_this.streamId,type:type,options:optionsString},(function(error,response){if(error)logger.error("Error applying filter for Stream "+_this.streamId,error),401===error.code?reject(new OpenViduError_1.OpenViduError(OpenViduError_1.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to apply a filter")):reject(error);else{logger.info("Filter successfully applied on Stream "+_this.streamId);var oldValue=_this.filter;_this.filter=new Filter_1.Filter(type,options),_this.filter.stream=_this,_this.session.emitEvent("streamPropertyChanged",[new StreamPropertyChangedEvent_1.StreamPropertyChangedEvent(_this.session,_this,"filter",_this.filter,oldValue,"applyFilter")]),_this.streamManager.emitEvent("streamPropertyChanged",[new StreamPropertyChangedEvent_1.StreamPropertyChangedEvent(_this.streamManager,_this,"filter",_this.filter,oldValue,"applyFilter")]),resolve(_this.filter)}}))}))},Stream.prototype.removeFilter=function(){var _this=this;return new Promise((function(resolve,reject){_this.session.sessionConnected()||reject(_this.session.notConnectedError()),logger.info("Removing filter of stream "+_this.streamId),_this.session.openvidu.sendRequest("removeFilter",{streamId:_this.streamId},(function(error,response){if(error)logger.error("Error removing filter for Stream "+_this.streamId,error),401===error.code?reject(new OpenViduError_1.OpenViduError(OpenViduError_1.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to remove a filter")):reject(error);else{logger.info("Filter successfully removed from Stream "+_this.streamId);var oldValue=_this.filter;delete _this.filter,_this.session.emitEvent("streamPropertyChanged",[new StreamPropertyChangedEvent_1.StreamPropertyChangedEvent(_this.session,_this,"filter",_this.filter,oldValue,"applyFilter")]),_this.streamManager.emitEvent("streamPropertyChanged",[new StreamPropertyChangedEvent_1.StreamPropertyChangedEvent(_this.streamManager,_this,"filter",_this.filter,oldValue,"applyFilter")]),resolve()}}))}))},Stream.prototype.getRTCPeerConnection=function(){return this.webRtcPeer.pc},Stream.prototype.getMediaStream=function(){return this.mediaStream},Stream.prototype.setMediaStream=function(mediaStream){this.mediaStream=mediaStream},Stream.prototype.updateMediaStreamInVideos=function(){this.ee.emitEvent("mediastream-updated",[])},Stream.prototype.getWebRtcPeer=function(){return this.webRtcPeer},Stream.prototype.subscribeToMyRemote=function(value){this.isSubscribeToRemote=value},Stream.prototype.setOutboundStreamOptions=function(outboundStreamOpts){this.outboundStreamOpts=outboundStreamOpts},Stream.prototype.subscribe=function(){var _this=this;return new Promise((function(resolve,reject){_this.initWebRtcPeerReceive(!1).then((function(){resolve()})).catch((function(error){reject(error)}))}))},Stream.prototype.publish=function(){var _this=this;return new Promise((function(resolve,reject){_this.isLocalStreamReadyToPublish?_this.initWebRtcPeerSend(!1).then((function(){resolve()})).catch((function(error){reject(error)})):_this.ee.once("stream-ready-to-publish",(function(){_this.publish().then((function(){resolve()})).catch((function(error){reject(error)}))}))}))},Stream.prototype.disposeWebRtcPeer=function(){var webrtcId=this.webRtcPeer.id;this.webRtcPeer&&(this.webRtcPeer.dispose(),this.stopWebRtcStats()),logger.info((this.outboundStreamOpts?"Outbound ":"Inbound ")+"RTCPeerConnection with id ["+webrtcId+"] from 'Stream' with id ["+this.streamId+"] is now closed")},Stream.prototype.disposeMediaStream=function(){this.mediaStream&&(this.mediaStream.getAudioTracks().forEach((function(track){track.stop()})),this.mediaStream.getVideoTracks().forEach((function(track){track.stop()})),delete this.mediaStream),this.localMediaStreamWhenSubscribedToRemote&&(this.localMediaStreamWhenSubscribedToRemote.getAudioTracks().forEach((function(track){track.stop()})),this.localMediaStreamWhenSubscribedToRemote.getVideoTracks().forEach((function(track){track.stop()})),delete this.localMediaStreamWhenSubscribedToRemote),this.speechEvent&&(this.speechEvent.stop&&this.speechEvent.stop(),delete this.speechEvent),logger.info((this.outboundStreamOpts?"Local ":"Remote ")+"MediaStream from 'Stream' with id ["+this.streamId+"] is now disposed")},Stream.prototype.displayMyRemote=function(){return this.isSubscribeToRemote},Stream.prototype.isSendAudio=function(){return!!this.outboundStreamOpts&&null!==this.outboundStreamOpts.publisherProperties.audioSource&&!1!==this.outboundStreamOpts.publisherProperties.audioSource},Stream.prototype.isSendVideo=function(){return!!this.outboundStreamOpts&&null!==this.outboundStreamOpts.publisherProperties.videoSource&&!1!==this.outboundStreamOpts.publisherProperties.videoSource},Stream.prototype.isSendScreen=function(){var screen="screen"===this.outboundStreamOpts.publisherProperties.videoSource;return platform.isElectron()&&(screen="string"==typeof this.outboundStreamOpts.publisherProperties.videoSource&&this.outboundStreamOpts.publisherProperties.videoSource.startsWith("screen:")),!!this.outboundStreamOpts&&screen},Stream.prototype.enableHarkSpeakingEvent=function(){var _this=this;this.setHarkListenerIfNotExists(),this.harkSpeakingEnabled||(this.harkSpeakingEnabled=!0,this.speechEvent.on("speaking",(function(){_this.session.emitEvent("publisherStartSpeaking",[new PublisherSpeakingEvent_1.PublisherSpeakingEvent(_this.session,"publisherStartSpeaking",_this.connection,_this.streamId)]),_this.streamManager.emitEvent("publisherStartSpeaking",[new PublisherSpeakingEvent_1.PublisherSpeakingEvent(_this.streamManager,"publisherStartSpeaking",_this.connection,_this.streamId)]),_this.harkSpeakingEnabledOnce=!1})))},Stream.prototype.enableOnceHarkSpeakingEvent=function(){var _this=this;this.setHarkListenerIfNotExists(),this.harkSpeakingEnabledOnce||(this.harkSpeakingEnabledOnce=!0,this.speechEvent.once("speaking",(function(){_this.harkSpeakingEnabledOnce&&(_this.session.emitEvent("publisherStartSpeaking",[new PublisherSpeakingEvent_1.PublisherSpeakingEvent(_this.session,"publisherStartSpeaking",_this.connection,_this.streamId)]),_this.streamManager.emitEvent("publisherStartSpeaking",[new PublisherSpeakingEvent_1.PublisherSpeakingEvent(_this.streamManager,"publisherStartSpeaking",_this.connection,_this.streamId)])),_this.disableHarkSpeakingEvent(!0)})))},Stream.prototype.disableHarkSpeakingEvent=function(disabledByOnce){if(this.speechEvent){if(this.harkSpeakingEnabledOnce=!1,disabledByOnce){if(this.harkSpeakingEnabled)return}else this.harkSpeakingEnabled=!1;this.harkVolumeChangeEnabled||this.harkVolumeChangeEnabledOnce||this.harkStoppedSpeakingEnabled||this.harkStoppedSpeakingEnabledOnce?this.speechEvent.off("speaking"):(this.speechEvent.stop(),delete this.speechEvent)}},Stream.prototype.enableHarkStoppedSpeakingEvent=function(){var _this=this;this.setHarkListenerIfNotExists(),this.harkStoppedSpeakingEnabled||(this.harkStoppedSpeakingEnabled=!0,this.speechEvent.on("stopped_speaking",(function(){_this.session.emitEvent("publisherStopSpeaking",[new PublisherSpeakingEvent_1.PublisherSpeakingEvent(_this.session,"publisherStopSpeaking",_this.connection,_this.streamId)]),_this.streamManager.emitEvent("publisherStopSpeaking",[new PublisherSpeakingEvent_1.PublisherSpeakingEvent(_this.streamManager,"publisherStopSpeaking",_this.connection,_this.streamId)]),_this.harkStoppedSpeakingEnabledOnce=!1})))},Stream.prototype.enableOnceHarkStoppedSpeakingEvent=function(){var _this=this;this.setHarkListenerIfNotExists(),this.harkStoppedSpeakingEnabledOnce||(this.harkStoppedSpeakingEnabledOnce=!0,this.speechEvent.once("stopped_speaking",(function(){_this.harkStoppedSpeakingEnabledOnce&&(_this.session.emitEvent("publisherStopSpeaking",[new PublisherSpeakingEvent_1.PublisherSpeakingEvent(_this.session,"publisherStopSpeaking",_this.connection,_this.streamId)]),_this.streamManager.emitEvent("publisherStopSpeaking",[new PublisherSpeakingEvent_1.PublisherSpeakingEvent(_this.streamManager,"publisherStopSpeaking",_this.connection,_this.streamId)])),_this.disableHarkStoppedSpeakingEvent(!0)})))},Stream.prototype.disableHarkStoppedSpeakingEvent=function(disabledByOnce){if(this.speechEvent){if(this.harkStoppedSpeakingEnabledOnce=!1,disabledByOnce){if(this.harkStoppedSpeakingEnabled)return}else this.harkStoppedSpeakingEnabled=!1;this.harkVolumeChangeEnabled||this.harkVolumeChangeEnabledOnce||this.harkSpeakingEnabled||this.harkSpeakingEnabledOnce?this.speechEvent.off("stopped_speaking"):(this.speechEvent.stop(),delete this.speechEvent)}},Stream.prototype.enableHarkVolumeChangeEvent=function(force){var _this=this;this.setHarkListenerIfNotExists()?this.harkVolumeChangeEnabled&&!force||(this.harkVolumeChangeEnabled=!0,this.speechEvent.on("volume_change",(function(harkEvent){var value={newValue:harkEvent,oldValue:_this.speechEvent.oldVolumeValue};_this.speechEvent.oldVolumeValue=harkEvent,_this.streamManager.emitEvent("streamAudioVolumeChange",[new StreamManagerEvent_1.StreamManagerEvent(_this.streamManager,"streamAudioVolumeChange",value)])}))):this.harkVolumeChangeEnabled=!0},Stream.prototype.enableOnceHarkVolumeChangeEvent=function(force){var _this=this;this.setHarkListenerIfNotExists()?this.harkVolumeChangeEnabledOnce&&!force||(this.harkVolumeChangeEnabledOnce=!0,this.speechEvent.once("volume_change",(function(harkEvent){var value={newValue:harkEvent,oldValue:_this.speechEvent.oldVolumeValue};_this.speechEvent.oldVolumeValue=harkEvent,_this.disableHarkVolumeChangeEvent(!0),_this.streamManager.emitEvent("streamAudioVolumeChange",[new StreamManagerEvent_1.StreamManagerEvent(_this.streamManager,"streamAudioVolumeChange",value)])}))):this.harkVolumeChangeEnabledOnce=!0},Stream.prototype.disableHarkVolumeChangeEvent=function(disabledByOnce){if(this.speechEvent){if(this.harkVolumeChangeEnabledOnce=!1,disabledByOnce){if(this.harkVolumeChangeEnabled)return}else this.harkVolumeChangeEnabled=!1;this.harkSpeakingEnabled||this.harkSpeakingEnabledOnce||this.harkStoppedSpeakingEnabled||this.harkStoppedSpeakingEnabledOnce?this.speechEvent.off("volume_change"):(this.speechEvent.stop(),delete this.speechEvent)}},Stream.prototype.isLocal=function(){return!this.inboundStreamOpts&&!!this.outboundStreamOpts},Stream.prototype.getSelectedIceCandidate=function(){var _this=this;return new Promise((function(resolve,reject){_this.webRtcStats.getSelectedIceCandidateInfo().then((function(report){return resolve(report)})).catch((function(error){return reject(error)}))}))},Stream.prototype.getRemoteIceCandidateList=function(){return this.webRtcPeer.remoteCandidatesQueue},Stream.prototype.getLocalIceCandidateList=function(){return this.webRtcPeer.localCandidatesQueue},Stream.prototype.streamIceConnectionStateBroken=function(){if(!this.getWebRtcPeer()||!this.getRTCPeerConnection())return!1;if(this.isLocal()&&this.session.openvidu.advancedConfiguration.forceMediaReconnectionAfterNetworkDrop)return logger.warn('OpenVidu Browser advanced configuration option "forceMediaReconnectionAfterNetworkDrop" is enabled. Stream '+this.streamId+" ("+(this.isLocal()?"Publisher":"Subscriber")+") will force a reconnection"),!0;var iceConnectionState=this.getRTCPeerConnection().iceConnectionState;return"connected"!==iceConnectionState&&"completed"!==iceConnectionState},Stream.prototype.setHarkListenerIfNotExists=function(){if(this.mediaStream){if(!this.speechEvent){var harkOptions=this.harkOptions?this.harkOptions:this.session.openvidu.advancedConfiguration.publisherSpeakingEventsOptions||{};harkOptions.interval="number"==typeof harkOptions.interval?harkOptions.interval:100,harkOptions.threshold="number"==typeof harkOptions.threshold?harkOptions.threshold:-50,this.speechEvent=hark(this.mediaStream,harkOptions)}return!0}return!1},Stream.prototype.initWebRtcPeerSend=function(reconnect){var _this=this;return new Promise((function(resolve,reject){if(reconnect){if(null!=_this.reconnectionEventEmitter)return console.warn("Trying to reconnect stream "+_this.streamId+" (Publisher) but an ongoing reconnection process is active. Waiting for response..."),_this.reconnectionEventEmitter.once("success",(function(){resolve()})),void _this.reconnectionEventEmitter.once("error",(function(error){reject(error)}));_this.reconnectionEventEmitter=new EventEmitter}else _this.initHarkEvents();var finalReject=function(error){var _a;reconnect&&(null===(_a=_this.reconnectionEventEmitter)||void 0===_a||_a.emitEvent("error",[error]),delete _this.reconnectionEventEmitter),reject(error)},userMediaConstraints={audio:_this.isSendAudio(),video:_this.isSendVideo()},options={mediaStream:_this.mediaStream,mediaConstraints:userMediaConstraints,onIceCandidate:_this.connection.sendIceCandidate.bind(_this.connection),onIceConnectionStateException:_this.onIceConnectionStateExceptionHandler.bind(_this),iceServers:_this.getIceServersConf(),simulcast:!1},successOfferCallback=function(sdpOfferParam){logger.debug("Sending SDP offer to publish as "+_this.streamId,sdpOfferParam);var params,method=reconnect?"reconnectStream":"publishVideo";if(reconnect)params={stream:_this.streamId,sdpString:sdpOfferParam};else{var typeOfVideo="";_this.isSendVideo()&&(typeOfVideo="undefined"!=typeof MediaStreamTrack&&_this.outboundStreamOpts.publisherProperties.videoSource instanceof MediaStreamTrack?"CUSTOM":_this.isSendScreen()?"SCREEN":"CAMERA"),params={doLoopback:_this.displayMyRemote()||!1,hasAudio:_this.isSendAudio(),hasVideo:_this.isSendVideo(),audioActive:_this.audioActive,videoActive:_this.videoActive,typeOfVideo:typeOfVideo,frameRate:_this.frameRate?_this.frameRate:-1,videoDimensions:JSON.stringify(_this.videoDimensions),filter:_this.outboundStreamOpts.publisherProperties.filter,sdpOffer:sdpOfferParam}}_this.session.openvidu.sendRequest(method,params,(function(error,response){error?401===error.code?finalReject(new OpenViduError_1.OpenViduError(OpenViduError_1.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to publish")):finalReject("Error on publishVideo: "+JSON.stringify(error)):_this.webRtcPeer.processRemoteAnswer(response.sdpAnswer).then((function(){var _a;_this.streamId=response.id,_this.creationTime=response.createdAt,_this.isLocalStreamPublished=!0,_this.publishedOnce=!0,_this.displayMyRemote()&&(_this.localMediaStreamWhenSubscribedToRemote=_this.mediaStream,_this.remotePeerSuccessfullyEstablished(reconnect)),reconnect?_this.ee.emitEvent("stream-reconnected-by-publisher",[]):_this.ee.emitEvent("stream-created-by-publisher",[]),_this.initWebRtcStats(),logger.info("'Publisher' ("+_this.streamId+") successfully "+(reconnect?"reconnected":"published")+" to session"),reconnect&&(null===(_a=_this.reconnectionEventEmitter)||void 0===_a||_a.emitEvent("success"),delete _this.reconnectionEventEmitter),resolve()})).catch((function(error){finalReject(error)}))}))};reconnect&&_this.disposeWebRtcPeer(),_this.displayMyRemote()?_this.webRtcPeer=new WebRtcPeer_1.WebRtcPeerSendrecv(options):_this.webRtcPeer=new WebRtcPeer_1.WebRtcPeerSendonly(options),_this.webRtcPeer.addIceConnectionStateChangeListener("publisher of "+_this.connection.connectionId),_this.webRtcPeer.createOffer().then((function(sdpOffer){_this.webRtcPeer.processLocalOffer(sdpOffer).then((function(){successOfferCallback(sdpOffer.sdp)})).catch((function(error){finalReject(new Error("(publish) SDP process local offer error: "+JSON.stringify(error)))}))})).catch((function(error){finalReject(new Error("(publish) SDP create offer error: "+JSON.stringify(error)))}))}))},Stream.prototype.initWebRtcPeerReceive=function(reconnect){var _this=this;return new Promise((function(resolve,reject){if(reconnect){if(null!=_this.reconnectionEventEmitter)return console.warn("Trying to reconnect stream "+_this.streamId+" (Subscriber) but an ongoing reconnection process is active. Waiting for response..."),_this.reconnectionEventEmitter.once("success",(function(){resolve()})),void _this.reconnectionEventEmitter.once("error",(function(error){reject(error)}));_this.reconnectionEventEmitter=new EventEmitter}var finalResolve=function(){var _a;logger.info("'Subscriber' ("+_this.streamId+") successfully "+(reconnect?"reconnected":"subscribed")),_this.remotePeerSuccessfullyEstablished(reconnect),_this.initWebRtcStats(),reconnect&&(null===(_a=_this.reconnectionEventEmitter)||void 0===_a||_a.emitEvent("success"),delete _this.reconnectionEventEmitter),resolve()},finalReject=function(error){var _a;reconnect&&(null===(_a=_this.reconnectionEventEmitter)||void 0===_a||_a.emitEvent("error",[error]),delete _this.reconnectionEventEmitter),reject(error)};"mediasoup"===_this.session.openvidu.mediaServer?_this.initWebRtcPeerReceiveFromServer(reconnect).then((function(){return finalResolve()})).catch((function(error){return finalReject(error)})):_this.initWebRtcPeerReceiveFromClient(reconnect).then((function(){return finalResolve()})).catch((function(error){return finalReject(error)}))}))},Stream.prototype.initWebRtcPeerReceiveFromClient=function(reconnect){var _this=this;return new Promise((function(resolve,reject){_this.completeWebRtcPeerReceive(reconnect).then((function(response){_this.webRtcPeer.processRemoteAnswer(response.sdpAnswer).then((function(){return resolve()})).catch((function(error){return reject(error)}))})).catch((function(error){return reject(error)}))}))},Stream.prototype.initWebRtcPeerReceiveFromServer=function(reconnect){var _this=this;return new Promise((function(resolve,reject){_this.session.openvidu.sendRequest("prepareReceiveVideoFrom",{sender:_this.streamId,reconnect:reconnect},(function(error,response){error?reject(new Error("Error on prepareReceiveVideoFrom: "+JSON.stringify(error))):_this.completeWebRtcPeerReceive(reconnect,response.sdpOffer).then((function(){return resolve()})).catch((function(error){return reject(error)}))}))}))},Stream.prototype.completeWebRtcPeerReceive=function(reconnect,sdpOfferByServer){var _this=this;return new Promise((function(resolve,reject){var offerConstraints={audio:_this.inboundStreamOpts.hasAudio,video:_this.inboundStreamOpts.hasVideo};logger.debug("'Session.subscribe(Stream)' called. Constraints of generate SDP offer",offerConstraints);var options={mediaConstraints:offerConstraints,onIceCandidate:_this.connection.sendIceCandidate.bind(_this.connection),onIceConnectionStateException:_this.onIceConnectionStateExceptionHandler.bind(_this),iceServers:_this.getIceServersConf(),simulcast:!1},sendSdpToServer=function(sdpString){logger.debug("Sending local SDP "+(sdpOfferByServer?"answer":"offer")+" to subscribe to "+_this.streamId,sdpString);var method=reconnect?"reconnectStream":"receiveVideoFrom",params={};params[reconnect?"stream":"sender"]=_this.streamId,sdpOfferByServer?params[reconnect?"sdpString":"sdpAnswer"]=sdpString:params.sdpOffer=sdpString,_this.session.openvidu.sendRequest(method,params,(function(error,response){error?reject(new Error("Error on "+method+" : "+JSON.stringify(error))):resolve(response)}))};reconnect&&_this.disposeWebRtcPeer(),_this.webRtcPeer=new WebRtcPeer_1.WebRtcPeerRecvonly(options),_this.webRtcPeer.addIceConnectionStateChangeListener(_this.streamId),sdpOfferByServer?_this.webRtcPeer.processRemoteOffer(sdpOfferByServer).then((function(){_this.webRtcPeer.createAnswer().then((function(sdpAnswer){_this.webRtcPeer.processLocalAnswer(sdpAnswer).then((function(){sendSdpToServer(sdpAnswer.sdp)})).catch((function(error){reject(new Error("(subscribe) SDP process local answer error: "+JSON.stringify(error)))}))})).catch((function(error){reject(new Error("(subscribe) SDP create answer error: "+JSON.stringify(error)))}))})).catch((function(error){reject(new Error("(subscribe) SDP process remote offer error: "+JSON.stringify(error)))})):_this.webRtcPeer.createOffer().then((function(sdpOffer){_this.webRtcPeer.processLocalOffer(sdpOffer).then((function(){sendSdpToServer(sdpOffer.sdp)})).catch((function(error){reject(new Error("(subscribe) SDP process local offer error: "+JSON.stringify(error)))}))})).catch((function(error){reject(new Error("(subscribe) SDP create offer error: "+JSON.stringify(error)))}))}))},Stream.prototype.remotePeerSuccessfullyEstablished=function(reconnect){var receiver;reconnect&&null!=this.mediaStream&&this.disposeMediaStream(),this.mediaStream=new MediaStream;for(var _i=0,_a=this.webRtcPeer.pc.getReceivers();_i<_a.length;_i++)(receiver=_a[_i]).track&&this.mediaStream.addTrack(receiver.track);if(logger.debug("Peer remote stream",this.mediaStream),this.mediaStream){if(this.streamManager instanceof Subscriber_1.Subscriber){if(this.mediaStream.getAudioTracks()[0]){var enabled=reconnect?this.audioActive:!!this.streamManager.properties.subscribeToAudio;this.mediaStream.getAudioTracks()[0].enabled=enabled}if(this.mediaStream.getVideoTracks()[0]){enabled=reconnect?this.videoActive:!!this.streamManager.properties.subscribeToVideo;this.mediaStream.getVideoTracks()[0].enabled=enabled}}this.updateMediaStreamInVideos(),this.initHarkEvents()}},Stream.prototype.initHarkEvents=function(){this.mediaStream.getAudioTracks()[0]&&(this.session.anySpeechEventListenerEnabled("publisherStartSpeaking",!0,this.streamManager)&&this.enableOnceHarkSpeakingEvent(),this.session.anySpeechEventListenerEnabled("publisherStartSpeaking",!1,this.streamManager)&&this.enableHarkSpeakingEvent(),this.session.anySpeechEventListenerEnabled("publisherStopSpeaking",!0,this.streamManager)&&this.enableOnceHarkStoppedSpeakingEvent(),this.session.anySpeechEventListenerEnabled("publisherStopSpeaking",!1,this.streamManager)&&this.enableHarkStoppedSpeakingEvent(),this.harkVolumeChangeEnabledOnce&&this.enableOnceHarkVolumeChangeEvent(!0),this.harkVolumeChangeEnabled&&this.enableHarkVolumeChangeEvent(!0))},Stream.prototype.onIceConnectionStateExceptionHandler=function(exceptionName,message,data){switch(exceptionName){case ExceptionEvent_1.ExceptionEventName.ICE_CONNECTION_FAILED:this.onIceConnectionFailed();break;case ExceptionEvent_1.ExceptionEventName.ICE_CONNECTION_DISCONNECTED:this.onIceConnectionDisconnected()}this.session.emitEvent("exception",[new ExceptionEvent_1.ExceptionEvent(this.session,exceptionName,this,message,data)])},Stream.prototype.onIceConnectionFailed=function(){logger.log("[ICE_CONNECTION_FAILED] Handling ICE_CONNECTION_FAILED event. Reconnecting stream "+this.streamId+" ("+(this.isLocal()?"Publisher":"Subscriber")+")"),this.reconnectStreamAndLogResultingIceConnectionState(ExceptionEvent_1.ExceptionEventName.ICE_CONNECTION_FAILED)},Stream.prototype.onIceConnectionDisconnected=function(){var _this=this;logger.log("[ICE_CONNECTION_DISCONNECTED] Handling ICE_CONNECTION_DISCONNECTED event. Waiting for ICE to be restored and reconnect stream "+this.streamId+" ("+(this.isLocal()?"Publisher":"Subscriber")+") if not possible");var timeout=this.session.openvidu.advancedConfiguration.iceConnectionDisconnectedExceptionTimeout||4e3;this.awaitWebRtcPeerConnectionState(timeout).then((function(state){switch(state){case"failed":logger.warn("[ICE_CONNECTION_DISCONNECTED] ICE connection of stream "+_this.streamId+" ("+(_this.isLocal()?"Publisher":"Subscriber")+") is now failed after ICE_CONNECTION_DISCONNECTED");break;case"connected":case"completed":logger.log("[ICE_CONNECTION_DISCONNECTED] ICE connection of stream "+_this.streamId+" ("+(_this.isLocal()?"Publisher":"Subscriber")+") automatically restored after ICE_CONNECTION_DISCONNECTED. Current ICE connection state: "+state);break;case"closed":case"checking":case"new":case"disconnected":logger.warn("[ICE_CONNECTION_DISCONNECTED] ICE connection of stream "+_this.streamId+" ("+(_this.isLocal()?"Publisher":"Subscriber")+") couldn't be restored after ICE_CONNECTION_DISCONNECTED event. Current ICE connection state after "+timeout+" ms: "+state),_this.reconnectStreamAndLogResultingIceConnectionState(ExceptionEvent_1.ExceptionEventName.ICE_CONNECTION_DISCONNECTED)}}))},Stream.prototype.reconnectStreamAndLogResultingIceConnectionState=function(event){return __awaiter(this,void 0,void 0,(function(){var finalIceStateAfterReconnection,error_1;return __generator(this,(function(_a){switch(_a.label){case 0:return _a.trys.push([0,2,,3]),[4,this.reconnectStreamAndReturnIceConnectionState(event)];case 1:switch(finalIceStateAfterReconnection=_a.sent()){case"connected":case"completed":logger.log("["+event+"] Stream "+this.streamId+" ("+(this.isLocal()?"Publisher":"Subscriber")+") successfully reconnected after "+event+". Current ICE connection state: "+finalIceStateAfterReconnection);break;default:logger.error("["+event+"] Stream "+this.streamId+" ("+(this.isLocal()?"Publisher":"Subscriber")+") failed to reconnect after "+event+". Current ICE connection state: "+finalIceStateAfterReconnection)}return[3,3];case 2:return error_1=_a.sent(),logger.error("["+event+"] Error reconnecting stream "+this.streamId+" ("+(this.isLocal()?"Publisher":"Subscriber")+") after "+event+": "+error_1),[3,3];case 3:return[2]}}))}))},Stream.prototype.reconnectStreamAndReturnIceConnectionState=function(event){return __awaiter(this,void 0,void 0,(function(){var timeout,error_2;return __generator(this,(function(_a){switch(_a.label){case 0:logger.log("["+event+"] Reconnecting stream "+this.streamId+" ("+(this.isLocal()?"Publisher":"Subscriber")+") after event "+event),_a.label=1;case 1:return _a.trys.push([1,3,,4]),[4,this.reconnectStream(event)];case 2:return _a.sent(),timeout=this.session.openvidu.advancedConfiguration.iceConnectionDisconnectedExceptionTimeout||4e3,[2,this.awaitWebRtcPeerConnectionState(timeout)];case 3:return error_2=_a.sent(),logger.warn("["+event+"] Error reconnecting stream "+this.streamId+" ("+(this.isLocal()?"Publisher":"Subscriber")+"). Reason: "+error_2),[2,this.awaitWebRtcPeerConnectionState(1)];case 4:return[2]}}))}))},Stream.prototype.reconnectStream=function(event){return __awaiter(this,void 0,void 0,(function(){var errorMsg;return __generator(this,(function(_a){switch(_a.label){case 0:return[4,this.isWebsocketConnected(event,3e3)];case 1:if(_a.sent())return logger.log("["+event+"] Trying to reconnect stream "+this.streamId+" ("+(this.isLocal()?"Publisher":"Subscriber")+") and the websocket is opened"),this.isLocal()?[2,this.initWebRtcPeerSend(!0)]:[2,this.initWebRtcPeerReceive(!0)];throw errorMsg="["+event+"] Trying to reconnect stream "+this.streamId+" ("+(this.isLocal()?"Publisher":"Subscriber")+") but the websocket wasn't opened",logger.error(errorMsg),Error(errorMsg)}}))}))},Stream.prototype.isWebsocketConnected=function(event,msResponseTimeout){var _this=this;return new Promise((function(resolve,reject){var wsReadyState=_this.session.openvidu.getWsReadyState();if(1===wsReadyState){var responseTimeout_1=setTimeout((function(){console.warn("["+event+"] Websocket timeout of "+msResponseTimeout+"ms"),resolve(!1)}),msResponseTimeout);_this.session.openvidu.sendRequest("echo",{},(function(error,response){clearTimeout(responseTimeout_1),error?(console.warn("["+event+"] Websocket 'echo' returned error: "+error),resolve(!1)):resolve(!0)}))}else console.warn("["+event+"] Websocket readyState is "+wsReadyState),resolve(!1)}))},Stream.prototype.awaitWebRtcPeerConnectionState=function(timeout){return __awaiter(this,void 0,void 0,(function(){var state,interval,intervals,i;return __generator(this,(function(_a){switch(_a.label){case 0:state=this.getRTCPeerConnection().iceConnectionState,interval=150,intervals=Math.ceil(timeout/interval),i=0,_a.label=1;case 1:return i<intervals?"connected"===(state=this.getRTCPeerConnection().iceConnectionState)||"completed"===state?[3,4]:[4,new Promise((function(resolve){return setTimeout(resolve,interval)}))]:[3,4];case 2:_a.sent(),_a.label=3;case 3:return i++,[3,1];case 4:return[2,state]}}))}))},Stream.prototype.initWebRtcStats=function(){this.webRtcStats=new WebRtcStats_1.WebRtcStats(this),this.webRtcStats.initWebRtcStats()},Stream.prototype.stopWebRtcStats=function(){this.webRtcStats&&this.webRtcStats.isEnabled()&&this.webRtcStats.stopWebRtcStats()},Stream.prototype.getIceServersConf=function(){return this.session.openvidu.advancedConfiguration.iceServers?"freeice"===this.session.openvidu.advancedConfiguration.iceServers?void 0:this.session.openvidu.advancedConfiguration.iceServers:this.session.openvidu.iceServers?this.session.openvidu.iceServers:void 0},Stream.prototype.gatherStatsForPeer=function(){var _this=this;return new Promise((function(resolve,reject){_this.isLocal()?_this.getRTCPeerConnection().getSenders().forEach((function(sender){return sender.getStats().then((function(response){response.forEach((function(report){if(_this.isReportWanted(report)){var finalReport={};finalReport.type=report.type,finalReport.timestamp=report.timestamp,finalReport.id=report.id,"outbound-rtp"===report.type&&(finalReport.ssrc=report.ssrc,finalReport.firCount=report.firCount,finalReport.pliCount=report.pliCount,finalReport.nackCount=report.nackCount,finalReport.qpSum=report.qpSum,report.kind?finalReport.mediaType=report.kind:report.mediaType?finalReport.mediaType=report.mediaType:finalReport.mediaType=-1!==report.id.indexOf("VideoStream")?"video":"audio","video"===finalReport.mediaType&&(finalReport.framesEncoded=report.framesEncoded),finalReport.packetsSent=report.packetsSent,finalReport.bytesSent=report.bytesSent),"candidate-pair"===report.type&&void 0!==report.totalRoundTripTime&&(finalReport.availableOutgoingBitrate=report.availableOutgoingBitrate,finalReport.rtt=report.currentRoundTripTime,finalReport.averageRtt=report.totalRoundTripTime/report.responsesReceived),"remote-inbound-rtp"===report.type||report.type,logger.log(finalReport)}}))}))})):_this.getRTCPeerConnection().getReceivers().forEach((function(receiver){return receiver.getStats().then((function(response){response.forEach((function(report){if(_this.isReportWanted(report)){var finalReport={};finalReport.type=report.type,finalReport.timestamp=report.timestamp,finalReport.id=report.id,"inbound-rtp"===report.type&&(finalReport.ssrc=report.ssrc,finalReport.firCount=report.firCount,finalReport.pliCount=report.pliCount,finalReport.nackCount=report.nackCount,finalReport.qpSum=report.qpSum,report.kind?finalReport.mediaType=report.kind:report.mediaType?finalReport.mediaType=report.mediaType:finalReport.mediaType=-1!==report.id.indexOf("VideoStream")?"video":"audio","video"===finalReport.mediaType&&(finalReport.framesDecoded=report.framesDecoded),finalReport.packetsReceived=report.packetsReceived,finalReport.packetsLost=report.packetsLost,finalReport.jitter=report.jitter,finalReport.bytesReceived=report.bytesReceived),"candidate-pair"===report.type&&void 0!==report.totalRoundTripTime&&(finalReport.availableIncomingBitrate=report.availableIncomingBitrate,finalReport.rtt=report.currentRoundTripTime,finalReport.averageRtt=report.totalRoundTripTime/report.responsesReceived),"remote-inbound-rtp"===report.type||report.type,logger.log(finalReport)}}))}))}))}))},Stream.prototype.isReportWanted=function(report){return"inbound-rtp"===report.type&&!this.isLocal()||"outbound-rtp"===report.type&&this.isLocal()||"candidate-pair"===report.type&&report.nominated&&report.bytesSent>0},Stream}();exports.Stream=Stream},1005:function(module,exports,__webpack_require__){"use strict";exports.__esModule=!0,exports.Filter=void 0;var StreamPropertyChangedEvent_1=__webpack_require__(995),OpenViduError_1=__webpack_require__(996),logger=__webpack_require__(992).OpenViduLogger.getInstance(),Filter=function(){function Filter(type,options){this.handlers=new Map,this.type=type,this.options=options}return Filter.prototype.execMethod=function(method,params){var _this=this;return new Promise((function(resolve,reject){var stringParams;if(logger.info("Executing filter method to stream "+_this.stream.streamId),"string"!=typeof params)try{stringParams=JSON.stringify(params)}catch(error){var errorMsg="'params' property must be a JSON formatted object";logger.error(errorMsg),reject(errorMsg)}else stringParams=params;_this.stream.session.openvidu.sendRequest("execFilterMethod",{streamId:_this.stream.streamId,method:method,params:stringParams},(function(error,response){if(error)logger.error("Error executing filter method for Stream "+_this.stream.streamId,error),401===error.code?reject(new OpenViduError_1.OpenViduError(OpenViduError_1.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to execute a filter method")):reject(error);else{logger.info("Filter method successfully executed on Stream "+_this.stream.streamId);var oldValue=Object.assign({},_this.stream.filter);_this.stream.filter.lastExecMethod={method:method,params:JSON.parse(stringParams)},_this.stream.session.emitEvent("streamPropertyChanged",[new StreamPropertyChangedEvent_1.StreamPropertyChangedEvent(_this.stream.session,_this.stream,"filter",_this.stream.filter,oldValue,"execFilterMethod")]),_this.stream.streamManager.emitEvent("streamPropertyChanged",[new StreamPropertyChangedEvent_1.StreamPropertyChangedEvent(_this.stream.streamManager,_this.stream,"filter",_this.stream.filter,oldValue,"execFilterMethod")]),resolve()}}))}))},Filter.prototype.addEventListener=function(eventType,handler){var _this=this;return new Promise((function(resolve,reject){logger.info("Adding filter event listener to event "+eventType+" to stream "+_this.stream.streamId),_this.stream.session.openvidu.sendRequest("addFilterEventListener",{streamId:_this.stream.streamId,eventType:eventType},(function(error,response){error?(logger.error("Error adding filter event listener to event "+eventType+"for Stream "+_this.stream.streamId,error),401===error.code?reject(new OpenViduError_1.OpenViduError(OpenViduError_1.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to add a filter event listener")):reject(error)):(_this.handlers.set(eventType,handler),logger.info("Filter event listener to event "+eventType+" successfully applied on Stream "+_this.stream.streamId),resolve())}))}))},Filter.prototype.removeEventListener=function(eventType){var _this=this;return new Promise((function(resolve,reject){logger.info("Removing filter event listener to event "+eventType+" to stream "+_this.stream.streamId),_this.stream.session.openvidu.sendRequest("removeFilterEventListener",{streamId:_this.stream.streamId,eventType:eventType},(function(error,response){error?(logger.error("Error removing filter event listener to event "+eventType+"for Stream "+_this.stream.streamId,error),401===error.code?reject(new OpenViduError_1.OpenViduError(OpenViduError_1.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to add a filter event listener")):reject(error)):(_this.handlers.delete(eventType),logger.info("Filter event listener to event "+eventType+" successfully removed on Stream "+_this.stream.streamId),resolve())}))}))},Filter}();exports.Filter=Filter},1006:function(module,exports,__webpack_require__){"use strict";var extendStatics,__extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)});exports.__esModule=!0,exports.Subscriber=void 0;var StreamManager_1=__webpack_require__(1007),logger=__webpack_require__(992).OpenViduLogger.getInstance(),Subscriber=function(_super){function Subscriber(stream,targEl,properties){var _this=_super.call(this,stream,targEl)||this;return _this.element=_this.targetElement,_this.stream=stream,_this.properties=properties,_this}return __extends(Subscriber,_super),Subscriber.prototype.subscribeToAudio=function(value){return this.stream.getMediaStream().getAudioTracks().forEach((function(track){track.enabled=value})),this.stream.audioActive=value,logger.info("'Subscriber' has "+(value?"subscribed to":"unsubscribed from")+" its audio stream"),this},Subscriber.prototype.subscribeToVideo=function(value){return this.stream.getMediaStream().getVideoTracks().forEach((function(track){track.enabled=value})),this.stream.videoActive=value,logger.info("'Subscriber' has "+(value?"subscribed to":"unsubscribed from")+" its video stream"),this},Subscriber}(StreamManager_1.StreamManager);exports.Subscriber=Subscriber},1007:function(module,exports,__webpack_require__){"use strict";var extendStatics,__extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)});exports.__esModule=!0,exports.StreamManager=void 0;var platform,EventDispatcher_1=__webpack_require__(1008),StreamManagerEvent_1=__webpack_require__(1010),VideoElementEvent_1=__webpack_require__(1011),VideoInsertMode_1=__webpack_require__(1e3),OpenViduLogger_1=__webpack_require__(992),Platform_1=__webpack_require__(994),ExceptionEvent_1=__webpack_require__(998),logger=OpenViduLogger_1.OpenViduLogger.getInstance(),StreamManager=function(_super){function StreamManager(stream,targetElement){var _this=_super.call(this)||this;if(_this.videos=[],_this.lazyLaunchVideoElementCreatedEvent=!1,platform=Platform_1.PlatformUtils.getInstance(),_this.stream=stream,_this.stream.streamManager=_this,_this.remote=!_this.stream.isLocal(),targetElement){var targEl=void 0;"string"==typeof targetElement?targEl=document.getElementById(targetElement):targetElement instanceof HTMLElement&&(targEl=targetElement),targEl&&(_this.firstVideoElement={targetElement:targEl,video:document.createElement("video"),id:"",canplayListenerAdded:!1},platform.isSafariBrowser()&&_this.firstVideoElement.video.setAttribute("playsinline","true"),_this.targetElement=targEl,_this.element=targEl)}return _this.canPlayListener=function(){_this.deactivateStreamPlayingEventExceptionTimeout(),_this.remote?(logger.info("Remote 'Stream' with id ["+_this.stream.streamId+"] video is now playing"),_this.ee.emitEvent("videoPlaying",[new VideoElementEvent_1.VideoElementEvent(_this.videos[0].video,_this,"videoPlaying")])):_this.stream.displayMyRemote()?(logger.info("Your own remote 'Stream' with id ["+_this.stream.streamId+"] video is now playing"),_this.ee.emitEvent("remoteVideoPlaying",[new VideoElementEvent_1.VideoElementEvent(_this.videos[0].video,_this,"remoteVideoPlaying")])):(logger.info("Your local 'Stream' with id ["+_this.stream.streamId+"] video is now playing"),_this.ee.emitEvent("videoPlaying",[new VideoElementEvent_1.VideoElementEvent(_this.videos[0].video,_this,"videoPlaying")])),_this.ee.emitEvent("streamPlaying",[new StreamManagerEvent_1.StreamManagerEvent(_this,"streamPlaying",void 0)])},_this}return __extends(StreamManager,_super),StreamManager.prototype.on=function(type,handler){return _super.prototype.onAux.call(this,type,"Event '"+type+"' triggered by '"+(this.remote?"Subscriber":"Publisher")+"'",handler),"videoElementCreated"===type&&this.stream&&this.lazyLaunchVideoElementCreatedEvent&&(this.ee.emitEvent("videoElementCreated",[new VideoElementEvent_1.VideoElementEvent(this.videos[0].video,this,"videoElementCreated")]),this.lazyLaunchVideoElementCreatedEvent=!1),"streamPlaying"!==type&&"videoPlaying"!==type||this.videos[0]&&this.videos[0].video&&this.videos[0].video.currentTime>0&&!1===this.videos[0].video.paused&&!1===this.videos[0].video.ended&&4===this.videos[0].video.readyState&&(this.ee.emitEvent("streamPlaying",[new StreamManagerEvent_1.StreamManagerEvent(this,"streamPlaying",void 0)]),this.ee.emitEvent("videoPlaying",[new VideoElementEvent_1.VideoElementEvent(this.videos[0].video,this,"videoPlaying")])),this.stream.hasAudio&&("publisherStartSpeaking"===type&&this.stream.enableHarkSpeakingEvent(),"publisherStopSpeaking"===type&&this.stream.enableHarkStoppedSpeakingEvent(),"streamAudioVolumeChange"===type&&this.stream.enableHarkVolumeChangeEvent(!1)),this},StreamManager.prototype.once=function(type,handler){return _super.prototype.onceAux.call(this,type,"Event '"+type+"' triggered once by '"+(this.remote?"Subscriber":"Publisher")+"'",handler),"videoElementCreated"===type&&this.stream&&this.lazyLaunchVideoElementCreatedEvent&&this.ee.emitEvent("videoElementCreated",[new VideoElementEvent_1.VideoElementEvent(this.videos[0].video,this,"videoElementCreated")]),"streamPlaying"!==type&&"videoPlaying"!==type||this.videos[0]&&this.videos[0].video&&this.videos[0].video.currentTime>0&&!1===this.videos[0].video.paused&&!1===this.videos[0].video.ended&&4===this.videos[0].video.readyState&&(this.ee.emitEvent("streamPlaying",[new StreamManagerEvent_1.StreamManagerEvent(this,"streamPlaying",void 0)]),this.ee.emitEvent("videoPlaying",[new VideoElementEvent_1.VideoElementEvent(this.videos[0].video,this,"videoPlaying")])),this.stream.hasAudio&&("publisherStartSpeaking"===type&&this.stream.enableOnceHarkSpeakingEvent(),"publisherStopSpeaking"===type&&this.stream.enableOnceHarkStoppedSpeakingEvent(),"streamAudioVolumeChange"===type&&this.stream.enableOnceHarkVolumeChangeEvent(!1)),this},StreamManager.prototype.off=function(type,handler){(_super.prototype.off.call(this,type,handler),"publisherStartSpeaking"===type)&&(0===this.ee.getListeners(type).length+this.stream.session.ee.getListeners(type).length&&this.stream.disableHarkSpeakingEvent(!1));"publisherStopSpeaking"===type&&(0===this.ee.getListeners(type).length+this.stream.session.ee.getListeners(type).length&&this.stream.disableHarkStoppedSpeakingEvent(!1));"streamAudioVolumeChange"===type&&(0===this.ee.getListeners(type).length&&this.stream.disableHarkVolumeChangeEvent(!1));return this},StreamManager.prototype.addVideoElement=function(video){this.initializeVideoProperties(video),!this.remote&&this.stream.displayMyRemote()&&video.srcObject!==this.stream.getMediaStream()&&(video.srcObject=this.stream.getMediaStream());for(var _i=0,_a=this.videos;_i<_a.length;_i++){if(_a[_i].video===video)return 0}for(var returnNumber=1,_b=0,_c=this.stream.session.streamManagers;_b<_c.length;_b++){if(_c[_b].disassociateVideo(video)){returnNumber=-1;break}}return this.stream.session.streamManagers.forEach((function(streamManager){streamManager.disassociateVideo(video)})),this.pushNewStreamManagerVideo({video:video,id:video.id,canplayListenerAdded:!1}),logger.info("New video element associated to ",this),returnNumber},StreamManager.prototype.createVideoElement=function(targetElement,insertMode){var targEl;if("string"==typeof targetElement){if(!(targEl=document.getElementById(targetElement)))throw new Error("The provided 'targetElement' couldn't be resolved to any HTML element: "+targetElement)}else{if(!(targetElement instanceof HTMLElement))throw new Error("The provided 'targetElement' couldn't be resolved to any HTML element: "+targetElement);targEl=targetElement}var video=this.createVideo();this.initializeVideoProperties(video);var insMode=insertMode||VideoInsertMode_1.VideoInsertMode.APPEND;switch(insMode){case VideoInsertMode_1.VideoInsertMode.AFTER:targEl.parentNode.insertBefore(video,targEl.nextSibling);break;case VideoInsertMode_1.VideoInsertMode.APPEND:targEl.appendChild(video);break;case VideoInsertMode_1.VideoInsertMode.BEFORE:targEl.parentNode.insertBefore(video,targEl);break;case VideoInsertMode_1.VideoInsertMode.PREPEND:targEl.insertBefore(video,targEl.childNodes[0]);break;case VideoInsertMode_1.VideoInsertMode.REPLACE:targEl.parentNode.replaceChild(video,targEl);break;default:insMode=VideoInsertMode_1.VideoInsertMode.APPEND,targEl.appendChild(video)}var v={targetElement:targEl,video:video,insertMode:insMode,id:video.id,canplayListenerAdded:!1};return this.pushNewStreamManagerVideo(v),this.ee.emitEvent("videoElementCreated",[new VideoElementEvent_1.VideoElementEvent(v.video,this,"videoElementCreated")]),this.lazyLaunchVideoElementCreatedEvent=!!this.firstVideoElement,video},StreamManager.prototype.updatePublisherSpeakingEventsOptions=function(publisherSpeakingEventsOptions){var currentHarkOptions=this.stream.harkOptions?this.stream.harkOptions:this.stream.session.openvidu.advancedConfiguration.publisherSpeakingEventsOptions||{},newInterval="number"==typeof publisherSpeakingEventsOptions.interval?publisherSpeakingEventsOptions.interval:"number"==typeof currentHarkOptions.interval?currentHarkOptions.interval:100,newThreshold="number"==typeof publisherSpeakingEventsOptions.threshold?publisherSpeakingEventsOptions.threshold:"number"==typeof currentHarkOptions.threshold?currentHarkOptions.threshold:-50;this.stream.harkOptions={interval:newInterval,threshold:newThreshold},this.stream.speechEvent&&(this.stream.speechEvent.setInterval(newInterval),this.stream.speechEvent.setThreshold(newThreshold))},StreamManager.prototype.initializeVideoProperties=function(video){!this.remote&&this.stream.displayMyRemote()||video.srcObject!==this.stream.getMediaStream()&&(video.srcObject=this.stream.getMediaStream()),video.autoplay=!0,video.controls=!1,platform.isSafariBrowser()&&video.setAttribute("playsinline","true"),video.id||(video.id=(this.remote?"remote-":"local-")+"video-"+this.stream.streamId,!this.id&&this.targetElement&&(this.id=video.id)),this.remote||this.stream.displayMyRemote()||(video.muted=!0,"rotateY(180deg)"!==video.style.transform||this.stream.outboundStreamOpts.publisherProperties.mirror?this.stream.outboundStreamOpts.publisherProperties.mirror&&!this.stream.isSendScreen()&&this.mirrorVideo(video):this.removeMirrorVideo(video))},StreamManager.prototype.removeAllVideos=function(){for(var _this=this,i=this.stream.session.streamManagers.length-1;i>=0;--i)this.stream.session.streamManagers[i]===this&&this.stream.session.streamManagers.splice(i,1);this.videos.forEach((function(streamManagerVideo){streamManagerVideo.video&&streamManagerVideo.video.removeEventListener&&streamManagerVideo.video.removeEventListener("canplay",_this.canPlayListener),streamManagerVideo.canplayListenerAdded=!1,streamManagerVideo.targetElement&&(streamManagerVideo.video.parentNode.removeChild(streamManagerVideo.video),_this.ee.emitEvent("videoElementDestroyed",[new VideoElementEvent_1.VideoElementEvent(streamManagerVideo.video,_this,"videoElementDestroyed")])),_this.removeSrcObject(streamManagerVideo),_this.videos.filter((function(v){return!v.targetElement}))}))},StreamManager.prototype.disassociateVideo=function(video){for(var disassociated=!1,i=0;i<this.videos.length;i++)if(this.videos[i].video===video){this.videos[i].video.removeEventListener("canplay",this.canPlayListener),this.videos.splice(i,1),disassociated=!0,logger.info("Video element disassociated from ",this);break}return disassociated},StreamManager.prototype.addPlayEventToFirstVideo=function(){this.videos[0]&&this.videos[0].video&&!this.videos[0].canplayListenerAdded&&(this.activateStreamPlayingEventExceptionTimeout(),this.videos[0].video.addEventListener("canplay",this.canPlayListener),this.videos[0].canplayListenerAdded=!0)},StreamManager.prototype.updateMediaStream=function(mediaStream){this.videos.forEach((function(streamManagerVideo){if(streamManagerVideo.video.srcObject=mediaStream,platform.isIonicIos()){var vParent=streamManagerVideo.video.parentElement,newVideo=streamManagerVideo.video;vParent.replaceChild(newVideo,streamManagerVideo.video),streamManagerVideo.video=newVideo}}))},StreamManager.prototype.emitEvent=function(type,eventArray){this.ee.emitEvent(type,eventArray)},StreamManager.prototype.createVideo=function(){return document.createElement("video")},StreamManager.prototype.removeSrcObject=function(streamManagerVideo){streamManagerVideo.video.srcObject=null,this.deactivateStreamPlayingEventExceptionTimeout()},StreamManager.prototype.pushNewStreamManagerVideo=function(streamManagerVideo){this.videos.push(streamManagerVideo),this.addPlayEventToFirstVideo(),-1===this.stream.session.streamManagers.indexOf(this)&&this.stream.session.streamManagers.push(this)},StreamManager.prototype.mirrorVideo=function(video){platform.isIonicIos()||(video.style.transform="rotateY(180deg)",video.style.webkitTransform="rotateY(180deg)")},StreamManager.prototype.removeMirrorVideo=function(video){video.style.transform="unset",video.style.webkitTransform="unset"},StreamManager.prototype.activateStreamPlayingEventExceptionTimeout=function(){var _this=this;if(this.remote&&null==this.streamPlayingEventExceptionTimeout){var msTimeout=this.stream.session.openvidu.advancedConfiguration.noStreamPlayingEventExceptionTimeout||4e3;this.streamPlayingEventExceptionTimeout=setTimeout((function(){var msg="StreamManager of Stream "+_this.stream.streamId+" ("+(_this.remote?"Subscriber":"Publisher")+') did not trigger "streamPlaying" event in '+msTimeout+" ms";logger.warn(msg),_this.stream.session.emitEvent("exception",[new ExceptionEvent_1.ExceptionEvent(_this.stream.session,ExceptionEvent_1.ExceptionEventName.NO_STREAM_PLAYING_EVENT,_this,msg)]),delete _this.streamPlayingEventExceptionTimeout}),msTimeout)}},StreamManager.prototype.deactivateStreamPlayingEventExceptionTimeout=function(){clearTimeout(this.streamPlayingEventExceptionTimeout),delete this.streamPlayingEventExceptionTimeout},StreamManager}(EventDispatcher_1.EventDispatcher);exports.StreamManager=StreamManager},1008:function(module,exports,__webpack_require__){"use strict";exports.__esModule=!0,exports.EventDispatcher=void 0;var EventEmitter=__webpack_require__(1009),logger=__webpack_require__(992).OpenViduLogger.getInstance(),EventDispatcher=function(){function EventDispatcher(){this.userHandlerArrowHandler=new WeakMap,this.ee=new EventEmitter}return EventDispatcher.prototype.off=function(type,handler){if(handler){var arrowHandler=this.userHandlerArrowHandler.get(handler);arrowHandler&&this.ee.off(type,arrowHandler),this.userHandlerArrowHandler.delete(handler)}else this.ee.removeAllListeners(type);return this},EventDispatcher.prototype.onAux=function(type,message,handler){var arrowHandler=function(event){event?logger.info(message,event):logger.info(message),handler(event)};return this.userHandlerArrowHandler.set(handler,arrowHandler),this.ee.on(type,arrowHandler),this},EventDispatcher.prototype.onceAux=function(type,message,handler){var _this=this,arrowHandler=function(event){event?logger.info(message,event):logger.info(message),handler(event),_this.userHandlerArrowHandler.delete(handler)};return this.userHandlerArrowHandler.set(handler,arrowHandler),this.ee.once(type,arrowHandler),this},EventDispatcher}();exports.EventDispatcher=EventDispatcher},1009:function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_RESULT__;!function(exports){"use strict";function EventEmitter(){}var proto=EventEmitter.prototype,originalGlobalValue=exports.EventEmitter;function indexOfListener(listeners,listener){for(var i=listeners.length;i--;)if(listeners[i].listener===listener)return i;return-1}function alias(name){return function aliasClosure(){return this[name].apply(this,arguments)}}function isValidListener(listener){return"function"==typeof listener||listener instanceof RegExp||!(!listener||"object"!=typeof listener)&&isValidListener(listener.listener)}proto.getListeners=function getListeners(evt){var response,key,events=this._getEvents();if(evt instanceof RegExp)for(key in response={},events)events.hasOwnProperty(key)&&evt.test(key)&&(response[key]=events[key]);else response=events[evt]||(events[evt]=[]);return response},proto.flattenListeners=function flattenListeners(listeners){var i,flatListeners=[];for(i=0;i<listeners.length;i+=1)flatListeners.push(listeners[i].listener);return flatListeners},proto.getListenersAsObject=function getListenersAsObject(evt){var response,listeners=this.getListeners(evt);return listeners instanceof Array&&((response={})[evt]=listeners),response||listeners},proto.addListener=function addListener(evt,listener){if(!isValidListener(listener))throw new TypeError("listener must be a function");var key,listeners=this.getListenersAsObject(evt),listenerIsWrapped="object"==typeof listener;for(key in listeners)listeners.hasOwnProperty(key)&&-1===indexOfListener(listeners[key],listener)&&listeners[key].push(listenerIsWrapped?listener:{listener:listener,once:!1});return this},proto.on=alias("addListener"),proto.addOnceListener=function addOnceListener(evt,listener){return this.addListener(evt,{listener:listener,once:!0})},proto.once=alias("addOnceListener"),proto.defineEvent=function defineEvent(evt){return this.getListeners(evt),this},proto.defineEvents=function defineEvents(evts){for(var i=0;i<evts.length;i+=1)this.defineEvent(evts[i]);return this},proto.removeListener=function removeListener(evt,listener){var index,key,listeners=this.getListenersAsObject(evt);for(key in listeners)listeners.hasOwnProperty(key)&&-1!==(index=indexOfListener(listeners[key],listener))&&listeners[key].splice(index,1);return this},proto.off=alias("removeListener"),proto.addListeners=function addListeners(evt,listeners){return this.manipulateListeners(!1,evt,listeners)},proto.removeListeners=function removeListeners(evt,listeners){return this.manipulateListeners(!0,evt,listeners)},proto.manipulateListeners=function manipulateListeners(remove,evt,listeners){var i,value,single=remove?this.removeListener:this.addListener,multiple=remove?this.removeListeners:this.addListeners;if("object"!=typeof evt||evt instanceof RegExp)for(i=listeners.length;i--;)single.call(this,evt,listeners[i]);else for(i in evt)evt.hasOwnProperty(i)&&(value=evt[i])&&("function"==typeof value?single.call(this,i,value):multiple.call(this,i,value));return this},proto.removeEvent=function removeEvent(evt){var key,type=typeof evt,events=this._getEvents();if("string"===type)delete events[evt];else if(evt instanceof RegExp)for(key in events)events.hasOwnProperty(key)&&evt.test(key)&&delete events[key];else delete this._events;return this},proto.removeAllListeners=alias("removeEvent"),proto.emitEvent=function emitEvent(evt,args){var listeners,listener,i,key,listenersMap=this.getListenersAsObject(evt);for(key in listenersMap)if(listenersMap.hasOwnProperty(key))for(listeners=listenersMap[key].slice(0),i=0;i<listeners.length;i++)!0===(listener=listeners[i]).once&&this.removeListener(evt,listener.listener),listener.listener.apply(this,args||[])===this._getOnceReturnValue()&&this.removeListener(evt,listener.listener);return this},proto.trigger=alias("emitEvent"),proto.emit=function emit(evt){var args=Array.prototype.slice.call(arguments,1);return this.emitEvent(evt,args)},proto.setOnceReturnValue=function setOnceReturnValue(value){return this._onceReturnValue=value,this},proto._getOnceReturnValue=function _getOnceReturnValue(){return!this.hasOwnProperty("_onceReturnValue")||this._onceReturnValue},proto._getEvents=function _getEvents(){return this._events||(this._events={})},EventEmitter.noConflict=function noConflict(){return exports.EventEmitter=originalGlobalValue,EventEmitter},void 0===(__WEBPACK_AMD_DEFINE_RESULT__=function(){return EventEmitter}.call(exports,__webpack_require__,exports,module))||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)}("undefined"!=typeof window?window:this||{})},1010:function(module,exports,__webpack_require__){"use strict";var extendStatics,__extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)});exports.__esModule=!0,exports.StreamManagerEvent=void 0;var StreamManagerEvent=function(_super){function StreamManagerEvent(target,type,value){var _this=_super.call(this,!1,target,type)||this;return _this.value=value,_this}return __extends(StreamManagerEvent,_super),StreamManagerEvent.prototype.callDefaultBehavior=function(){},StreamManagerEvent}(__webpack_require__(993).Event);exports.StreamManagerEvent=StreamManagerEvent},1011:function(module,exports,__webpack_require__){"use strict";var extendStatics,__extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)});exports.__esModule=!0,exports.VideoElementEvent=void 0;var VideoElementEvent=function(_super){function VideoElementEvent(element,target,type){var _this=_super.call(this,!1,target,type)||this;return _this.element=element,_this}return __extends(VideoElementEvent,_super),VideoElementEvent.prototype.callDefaultBehavior=function(){},VideoElementEvent}(__webpack_require__(993).Event);exports.VideoElementEvent=VideoElementEvent},1012:function(module,exports,__webpack_require__){"use strict";var extendStatics,__extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)});exports.__esModule=!0,exports.SessionDisconnectedEvent=void 0;var Event_1=__webpack_require__(993),logger=__webpack_require__(992).OpenViduLogger.getInstance(),SessionDisconnectedEvent=function(_super){function SessionDisconnectedEvent(target,reason){var _this=_super.call(this,!0,target,"sessionDisconnected")||this;return _this.reason=reason,_this}return __extends(SessionDisconnectedEvent,_super),SessionDisconnectedEvent.prototype.callDefaultBehavior=function(){logger.info("Calling default behavior upon '"+this.type+"' event dispatched by 'Session'");var session=this.target;session.remoteConnections.forEach((function(remoteConnection){var _a,_b,_c,_d,_e,_f,_g,_h,connectionId=remoteConnection.connectionId;if(null===(_a=session.remoteConnections.get(connectionId))||void 0===_a?void 0:_a.stream){null===(_b=session.remoteConnections.get(connectionId))||void 0===_b||_b.stream.disposeWebRtcPeer(),null===(_c=session.remoteConnections.get(connectionId))||void 0===_c||_c.stream.disposeMediaStream(),(null===(_d=session.remoteConnections.get(connectionId))||void 0===_d?void 0:_d.stream.streamManager)&&(null===(_e=session.remoteConnections.get(connectionId))||void 0===_e||_e.stream.streamManager.removeAllVideos());var streamId=null===(_g=null===(_f=session.remoteConnections.get(connectionId))||void 0===_f?void 0:_f.stream)||void 0===_g?void 0:_g.streamId;streamId&&session.remoteStreamsCreated.delete(streamId),null===(_h=session.remoteConnections.get(connectionId))||void 0===_h||_h.dispose()}session.remoteConnections.delete(connectionId)}))},SessionDisconnectedEvent}(Event_1.Event);exports.SessionDisconnectedEvent=SessionDisconnectedEvent},1013:function(module,exports,__webpack_require__){"use strict";var extendStatics,__extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)});exports.__esModule=!0,exports.StreamEvent=void 0;var Event_1=__webpack_require__(993),Publisher_1=__webpack_require__(1003),Session_1=__webpack_require__(999),logger=__webpack_require__(992).OpenViduLogger.getInstance(),StreamEvent=function(_super){function StreamEvent(cancelable,target,type,stream,reason){var _this=_super.call(this,cancelable,target,type)||this;return _this.stream=stream,_this.reason=reason,_this}return __extends(StreamEvent,_super),StreamEvent.prototype.callDefaultBehavior=function(){if("streamDestroyed"===this.type){if(this.target instanceof Session_1.Session)logger.info("Calling default behavior upon '"+this.type+"' event dispatched by 'Session'"),this.stream.disposeWebRtcPeer();else if(this.target instanceof Publisher_1.Publisher){logger.info("Calling default behavior upon '"+this.type+"' event dispatched by 'Publisher'"),clearInterval(this.target.screenShareResizeInterval),this.stream.isLocalStreamReadyToPublish=!1;for(var openviduPublishers=this.target.openvidu.publishers,i=0;i<openviduPublishers.length;i++)if(openviduPublishers[i]===this.target){openviduPublishers.splice(i,1);break}}this.stream.disposeMediaStream(),this.stream.streamManager&&this.stream.streamManager.removeAllVideos(),this.stream.session.remoteStreamsCreated.delete(this.stream.streamId);var remoteConnection=this.stream.session.remoteConnections.get(this.stream.connection.connectionId);if(remoteConnection&&remoteConnection.remoteOptions){var streamOptionsServer=remoteConnection.remoteOptions.streams;for(i=streamOptionsServer.length-1;i>=0;--i)streamOptionsServer[i].id===this.stream.streamId&&streamOptionsServer.splice(i,1)}}},StreamEvent}(Event_1.Event);exports.StreamEvent=StreamEvent},1025:function(module,exports,__webpack_require__){"use strict";exports.__esModule=!0,exports.LocalRecorder=void 0;var platform,LocalRecorderState_1=__webpack_require__(1026),OpenViduLogger_1=__webpack_require__(992),Platform_1=__webpack_require__(994),logger=OpenViduLogger_1.OpenViduLogger.getInstance(),LocalRecorder=function(){function LocalRecorder(stream){this.stream=stream,this.chunks=[],platform=Platform_1.PlatformUtils.getInstance(),this.connectionId=this.stream.connection?this.stream.connection.connectionId:"default-connection",this.id=this.stream.streamId+"_"+this.connectionId+"_localrecord",this.state=LocalRecorderState_1.LocalRecorderState.READY}return LocalRecorder.prototype.record=function(mimeType){var _this=this;return new Promise((function(resolve,reject){try{if("undefined"==typeof MediaRecorder)throw logger.error("MediaRecorder not supported on your browser. See compatibility in https://caniuse.com/#search=MediaRecorder"),Error("MediaRecorder not supported on your browser. See compatibility in https://caniuse.com/#search=MediaRecorder");if(_this.state!==LocalRecorderState_1.LocalRecorderState.READY)throw Error("'LocalRecord.record()' needs 'LocalRecord.state' to be 'READY' (current value: '"+_this.state+"'). Call 'LocalRecorder.clean()' or init a new LocalRecorder before");logger.log("Starting local recording of stream '"+_this.stream.streamId+"' of connection '"+_this.connectionId+"'");var options={};"function"==typeof MediaRecorder.isTypeSupported?mimeType?(MediaRecorder.isTypeSupported(mimeType)||reject(new Error('mimeType "'+mimeType+'" is not supported')),options={mimeType:mimeType}):logger.log("No mimeType parameter provided. Using default codecs"):logger.warn("MediaRecorder#isTypeSupported is not supported. Using default codecs"),_this.mediaRecorder=new MediaRecorder(_this.stream.getMediaStream(),options),_this.mediaRecorder.start(10)}catch(err){reject(err)}_this.mediaRecorder.ondataavailable=function(e){_this.chunks.push(e.data)},_this.mediaRecorder.onerror=function(e){logger.error("MediaRecorder error: ",e)},_this.mediaRecorder.onstart=function(){logger.log("MediaRecorder started (state="+_this.mediaRecorder.state+")")},_this.mediaRecorder.onstop=function(){_this.onStopDefault()},_this.mediaRecorder.onpause=function(){logger.log("MediaRecorder paused (state="+_this.mediaRecorder.state+")")},_this.mediaRecorder.onresume=function(){logger.log("MediaRecorder resumed (state="+_this.mediaRecorder.state+")")},_this.mediaRecorder.onwarning=function(e){logger.log("MediaRecorder warning: "+e)},_this.state=LocalRecorderState_1.LocalRecorderState.RECORDING,resolve()}))},LocalRecorder.prototype.stop=function(){var _this=this;return new Promise((function(resolve,reject){try{if(_this.state===LocalRecorderState_1.LocalRecorderState.READY||_this.state===LocalRecorderState_1.LocalRecorderState.FINISHED)throw Error("'LocalRecord.stop()' needs 'LocalRecord.state' to be 'RECORDING' or 'PAUSED' (current value: '"+_this.state+"'). Call 'LocalRecorder.start()' before");_this.mediaRecorder.onstop=function(){_this.onStopDefault(),resolve()},_this.mediaRecorder.stop()}catch(e){reject(e)}}))},LocalRecorder.prototype.pause=function(){var _this=this;return new Promise((function(resolve,reject){try{_this.state!==LocalRecorderState_1.LocalRecorderState.RECORDING&&reject(Error("'LocalRecord.pause()' needs 'LocalRecord.state' to be 'RECORDING' (current value: '"+_this.state+"'). Call 'LocalRecorder.start()' or 'LocalRecorder.resume()' before")),_this.mediaRecorder.pause(),_this.state=LocalRecorderState_1.LocalRecorderState.PAUSED,resolve()}catch(error){reject(error)}}))},LocalRecorder.prototype.resume=function(){var _this=this;return new Promise((function(resolve,reject){try{if(_this.state!==LocalRecorderState_1.LocalRecorderState.PAUSED)throw Error("'LocalRecord.resume()' needs 'LocalRecord.state' to be 'PAUSED' (current value: '"+_this.state+"'). Call 'LocalRecorder.pause()' before");_this.mediaRecorder.resume(),_this.state=LocalRecorderState_1.LocalRecorderState.RECORDING,resolve()}catch(error){reject(error)}}))},LocalRecorder.prototype.preview=function(parentElement){if(this.state!==LocalRecorderState_1.LocalRecorderState.FINISHED)throw Error("'LocalRecord.preview()' needs 'LocalRecord.state' to be 'FINISHED' (current value: '"+this.state+"'). Call 'LocalRecorder.stop()' before");if(this.videoPreview=document.createElement("video"),this.videoPreview.id=this.id,this.videoPreview.autoplay=!0,platform.isSafariBrowser()&&this.videoPreview.setAttribute("playsinline","true"),"string"==typeof parentElement){var parentElementDom=document.getElementById(parentElement);parentElementDom&&(this.videoPreview=parentElementDom.appendChild(this.videoPreview))}else this.videoPreview=parentElement.appendChild(this.videoPreview);return this.videoPreview.src=this.videoPreviewSrc,this.videoPreview},LocalRecorder.prototype.clean=function(){var _this=this,f=function(){delete _this.blob,_this.chunks=[],delete _this.mediaRecorder,_this.state=LocalRecorderState_1.LocalRecorderState.READY};this.state===LocalRecorderState_1.LocalRecorderState.RECORDING||this.state===LocalRecorderState_1.LocalRecorderState.PAUSED?this.stop().then((function(){return f()})).catch((function(){return f()})):f()},LocalRecorder.prototype.download=function(){if(this.state!==LocalRecorderState_1.LocalRecorderState.FINISHED)throw Error("'LocalRecord.download()' needs 'LocalRecord.state' to be 'FINISHED' (current value: '"+this.state+"'). Call 'LocalRecorder.stop()' before");var a=document.createElement("a");a.style.display="none",document.body.appendChild(a);var url=window.URL.createObjectURL(this.blob);a.href=url,a.download=this.id+".webm",a.click(),window.URL.revokeObjectURL(url),document.body.removeChild(a)},LocalRecorder.prototype.getBlob=function(){if(this.state!==LocalRecorderState_1.LocalRecorderState.FINISHED)throw Error("Call 'LocalRecord.stop()' before getting Blob file");return this.blob},LocalRecorder.prototype.uploadAsBinary=function(endpoint,headers){var _this=this;return new Promise((function(resolve,reject){if(_this.state!==LocalRecorderState_1.LocalRecorderState.FINISHED)reject(Error("'LocalRecord.uploadAsBinary()' needs 'LocalRecord.state' to be 'FINISHED' (current value: '"+_this.state+"'). Call 'LocalRecorder.stop()' before"));else{var http_1=new XMLHttpRequest;if(http_1.open("POST",endpoint,!0),"object"==typeof headers)for(var _i=0,_a=Object.keys(headers);_i<_a.length;_i++){var key=_a[_i];http_1.setRequestHeader(key,headers[key])}http_1.onreadystatechange=function(){4===http_1.readyState&&("2"===http_1.status.toString().charAt(0)?resolve(http_1.responseText):reject(http_1.status))},http_1.send(_this.blob)}}))},LocalRecorder.prototype.uploadAsMultipartfile=function(endpoint,headers){var _this=this;return new Promise((function(resolve,reject){if(_this.state!==LocalRecorderState_1.LocalRecorderState.FINISHED)reject(Error("'LocalRecord.uploadAsMultipartfile()' needs 'LocalRecord.state' to be 'FINISHED' (current value: '"+_this.state+"'). Call 'LocalRecorder.stop()' before"));else{var http_2=new XMLHttpRequest;if(http_2.open("POST",endpoint,!0),"object"==typeof headers)for(var _i=0,_a=Object.keys(headers);_i<_a.length;_i++){var key=_a[_i];http_2.setRequestHeader(key,headers[key])}var sendable=new FormData;sendable.append("file",_this.blob,_this.id+".webm"),http_2.onreadystatechange=function(){4===http_2.readyState&&("2"===http_2.status.toString().charAt(0)?resolve(http_2.responseText):reject(http_2.status))},http_2.send(sendable)}}))},LocalRecorder.prototype.onStopDefault=function(){logger.log("MediaRecorder stopped  (state="+this.mediaRecorder.state+")"),this.blob=new Blob(this.chunks,{type:"video/webm"}),this.chunks=[],this.videoPreviewSrc=window.URL.createObjectURL(this.blob),this.state=LocalRecorderState_1.LocalRecorderState.FINISHED},LocalRecorder}();exports.LocalRecorder=LocalRecorder},1026:function(module,exports,__webpack_require__){"use strict";exports.__esModule=!0,exports.LocalRecorderState=void 0,function(LocalRecorderState){LocalRecorderState.READY="READY",LocalRecorderState.RECORDING="RECORDING",LocalRecorderState.PAUSED="PAUSED",LocalRecorderState.FINISHED="FINISHED"}(exports.LocalRecorderState||(exports.LocalRecorderState={}))},1027:function(module,exports,__webpack_require__){"use strict";exports.__esModule=!0,exports.OpenViduLoggerConfiguration=void 0,function(OpenViduLoggerConfiguration){OpenViduLoggerConfiguration.disabled="disabled",OpenViduLoggerConfiguration.debug="debug"}(exports.OpenViduLoggerConfiguration||(exports.OpenViduLoggerConfiguration={}))},1028:function(module,exports,__webpack_require__){"use strict";exports.__esModule=!0,exports.Connection=void 0;var Stream_1=__webpack_require__(1004),OpenViduLogger_1=__webpack_require__(992),ExceptionEvent_1=__webpack_require__(998),logger=OpenViduLogger_1.OpenViduLogger.getInstance(),Connection=function(){function Connection(session,connectionOptions){this.session=session,this.disposed=!1;var msg="'Connection' created ";connectionOptions.role?(this.localOptions=connectionOptions,this.connectionId=this.localOptions.id,this.creationTime=this.localOptions.createdAt,this.data=this.localOptions.metadata,this.rpcSessionId=this.localOptions.sessionId,this.role=this.localOptions.role,this.record=this.localOptions.record,msg+="(local)"):(this.remoteOptions=connectionOptions,this.connectionId=this.remoteOptions.id,this.creationTime=this.remoteOptions.createdAt,this.remoteOptions.metadata&&(this.data=this.remoteOptions.metadata),this.remoteOptions.streams&&this.initRemoteStreams(this.remoteOptions.streams),msg+="(remote) with 'connectionId' ["+this.remoteOptions.id+"]"),logger.info(msg)}return Connection.prototype.sendIceCandidate=function(candidate){var _this=this;logger.debug((this.stream.outboundStreamOpts?"Local":"Remote")+"candidate for"+this.connectionId,candidate),this.session.openvidu.sendRequest("onIceCandidate",{endpointName:this.connectionId,candidate:candidate.candidate,sdpMid:candidate.sdpMid,sdpMLineIndex:candidate.sdpMLineIndex},(function(error,response){error&&(logger.error("Error sending ICE candidate: "+JSON.stringify(error)),_this.session.emitEvent("exception",[new ExceptionEvent_1.ExceptionEvent(_this.session,ExceptionEvent_1.ExceptionEventName.ICE_CANDIDATE_ERROR,_this.session,"There was an unexpected error on the server-side processing an ICE candidate generated and sent by the client-side",error)]))}))},Connection.prototype.initRemoteStreams=function(options){var _this=this;options.forEach((function(opts){var streamOptions={id:opts.id,createdAt:opts.createdAt,connection:_this,hasAudio:opts.hasAudio,hasVideo:opts.hasVideo,audioActive:opts.audioActive,videoActive:opts.videoActive,typeOfVideo:opts.typeOfVideo,frameRate:opts.frameRate,videoDimensions:opts.videoDimensions?JSON.parse(opts.videoDimensions):void 0,filter:opts.filter?opts.filter:void 0},stream=new Stream_1.Stream(_this.session,streamOptions);_this.addStream(stream)})),logger.info("Remote 'Connection' with 'connectionId' ["+this.connectionId+"] is now configured for receiving Streams with options: ",this.stream.inboundStreamOpts)},Connection.prototype.addStream=function(stream){stream.connection=this,this.stream=stream},Connection.prototype.removeStream=function(streamId){delete this.stream},Connection.prototype.dispose=function(){this.stream&&delete this.stream,this.disposed=!0},Connection}();exports.Connection=Connection},1029:function(module,exports,__webpack_require__){"use strict";var extendStatics,__extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)});exports.__esModule=!0,exports.PublisherSpeakingEvent=void 0;var PublisherSpeakingEvent=function(_super){function PublisherSpeakingEvent(target,type,connection,streamId){var _this=_super.call(this,!1,target,type)||this;return _this.type=type,_this.connection=connection,_this.streamId=streamId,_this}return __extends(PublisherSpeakingEvent,_super),PublisherSpeakingEvent.prototype.callDefaultBehavior=function(){},PublisherSpeakingEvent}(__webpack_require__(993).Event);exports.PublisherSpeakingEvent=PublisherSpeakingEvent},1030:function(module,exports,__webpack_require__){"use strict";var extendStatics,__extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)});exports.__esModule=!0,exports.ConnectionEvent=void 0;var ConnectionEvent=function(_super){function ConnectionEvent(cancelable,target,type,connection,reason){var _this=_super.call(this,cancelable,target,type)||this;return _this.connection=connection,_this.reason=reason,_this}return __extends(ConnectionEvent,_super),ConnectionEvent.prototype.callDefaultBehavior=function(){},ConnectionEvent}(__webpack_require__(993).Event);exports.ConnectionEvent=ConnectionEvent},1031:function(module,exports,__webpack_require__){"use strict";var extendStatics,__extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)});exports.__esModule=!0,exports.FilterEvent=void 0;var FilterEvent=function(_super){function FilterEvent(target,eventType,data){var _this=_super.call(this,!1,target,eventType)||this;return _this.data=data,_this}return __extends(FilterEvent,_super),FilterEvent.prototype.callDefaultBehavior=function(){},FilterEvent}(__webpack_require__(993).Event);exports.FilterEvent=FilterEvent},1032:function(module,exports,__webpack_require__){"use strict";var extendStatics,__extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)});exports.__esModule=!0,exports.RecordingEvent=void 0;var RecordingEvent=function(_super){function RecordingEvent(target,type,id,name,reason){var _this=_super.call(this,!1,target,type)||this;return _this.id=id,name!==id&&(_this.name=name),_this.reason=reason,_this}return __extends(RecordingEvent,_super),RecordingEvent.prototype.callDefaultBehavior=function(){},RecordingEvent}(__webpack_require__(993).Event);exports.RecordingEvent=RecordingEvent},1033:function(module,exports,__webpack_require__){"use strict";var extendStatics,__extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)});exports.__esModule=!0,exports.SignalEvent=void 0;var SignalEvent=function(_super){function SignalEvent(target,type,data,from){var _this=_super.call(this,!1,target,"signal")||this;return type&&(_this.type="signal:"+type),_this.data=data,_this.from=from,_this}return __extends(SignalEvent,_super),SignalEvent.prototype.callDefaultBehavior=function(){},SignalEvent}(__webpack_require__(993).Event);exports.SignalEvent=SignalEvent},1034:function(module,exports,__webpack_require__){"use strict";var extendStatics,__extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)});exports.__esModule=!0,exports.ConnectionPropertyChangedEvent=void 0;var ConnectionPropertyChangedEvent=function(_super){function ConnectionPropertyChangedEvent(target,connection,changedProperty,newValue,oldValue){var _this=_super.call(this,!1,target,"connectionPropertyChanged")||this;return _this.connection=connection,_this.changedProperty=changedProperty,_this.newValue=newValue,_this.oldValue=oldValue,_this}return __extends(ConnectionPropertyChangedEvent,_super),ConnectionPropertyChangedEvent.prototype.callDefaultBehavior=function(){},ConnectionPropertyChangedEvent}(__webpack_require__(993).Event);exports.ConnectionPropertyChangedEvent=ConnectionPropertyChangedEvent},1035:function(module,exports,__webpack_require__){"use strict";var extendStatics,__extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)});exports.__esModule=!0,exports.NetworkQualityLevelChangedEvent=void 0;var NetworkQualityLevelChangedEvent=function(_super){function NetworkQualityLevelChangedEvent(target,newValue,oldValue,connection){var _this=_super.call(this,!1,target,"networkQualityLevelChanged")||this;return _this.newValue=newValue,_this.oldValue=oldValue,_this.connection=connection,_this}return __extends(NetworkQualityLevelChangedEvent,_super),NetworkQualityLevelChangedEvent.prototype.callDefaultBehavior=function(){},NetworkQualityLevelChangedEvent}(__webpack_require__(993).Event);exports.NetworkQualityLevelChangedEvent=NetworkQualityLevelChangedEvent},1036:function(module,exports,__webpack_require__){var defineProperty_IE8=!1;if(Object.defineProperty)try{Object.defineProperty({},"x",{})}catch(e){defineProperty_IE8=!0}Function.prototype.bind||(Function.prototype.bind=function(oThis){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var aArgs=Array.prototype.slice.call(arguments,1),fToBind=this,fNOP=function(){},fBound=function(){return fToBind.apply(this instanceof fNOP&&oThis?this:oThis,aArgs.concat(Array.prototype.slice.call(arguments)))};return fNOP.prototype=this.prototype,fBound.prototype=new fNOP,fBound});var EventEmitter=__webpack_require__(1101).EventEmitter,inherits=__webpack_require__(1102),packers=__webpack_require__(1103),Mapper=__webpack_require__(1106);function unifyTransport(transport){if(transport){if(transport instanceof Function)return{send:transport};if(transport.send instanceof Function)return transport;if(transport.postMessage instanceof Function)return transport.send=transport.postMessage,transport;if(transport.write instanceof Function)return transport.send=transport.write,transport;if(void 0===transport.onmessage&&!(transport.pause instanceof Function))throw new SyntaxError("Transport is not a function nor a valid object")}}function RpcNotification(method,params){defineProperty_IE8?(this.method=method,this.params=params):(Object.defineProperty(this,"method",{value:method,enumerable:!0}),Object.defineProperty(this,"params",{value:params,enumerable:!0}))}function RpcBuilder(packer,options,transport,onRequest){var self=this;if(!packer)throw new SyntaxError("Packer is not defined");if(!packer.pack||!packer.unpack)throw new SyntaxError("Packer is invalid");var responseMethods=function unifyResponseMethods(responseMethods){if(!responseMethods)return{};for(var key in responseMethods){var value=responseMethods[key];"string"==typeof value&&(responseMethods[key]={response:value})}return responseMethods}(packer.responseMethods);if(options instanceof Function){if(null!=transport)throw new SyntaxError("There can't be parameters after onRequest");onRequest=options,transport=void 0,options=void 0}if(options&&options.send instanceof Function){if(transport&&!(transport instanceof Function))throw new SyntaxError("Only a function can be after transport");onRequest=transport,transport=options,options=void 0}if(transport instanceof Function){if(null!=onRequest)throw new SyntaxError("There can't be parameters after onRequest");onRequest=transport,transport=void 0}if(transport&&transport.send instanceof Function&&onRequest&&!(onRequest instanceof Function))throw new SyntaxError("Only a function can be after transport");options=options||{},EventEmitter.call(this),onRequest&&this.on("request",onRequest),defineProperty_IE8?this.peerID=options.peerID:Object.defineProperty(this,"peerID",{value:options.peerID});var max_retries=options.max_retries||0;function transportMessage(event){self.decode(event.data||event)}this.getTransport=function(){return transport},this.setTransport=function(value){transport&&(transport.removeEventListener?transport.removeEventListener("message",transportMessage):transport.removeListener&&transport.removeListener("data",transportMessage)),value&&(value.addEventListener?value.addEventListener("message",transportMessage):value.addListener&&value.addListener("data",transportMessage)),transport=unifyTransport(value)},defineProperty_IE8||Object.defineProperty(this,"transport",{get:this.getTransport.bind(this),set:this.setTransport.bind(this)}),this.setTransport(transport);var request_timeout=options.request_timeout||5e3,ping_request_timeout=options.ping_request_timeout||request_timeout,response_timeout=options.response_timeout||5e3,duplicates_timeout=options.duplicates_timeout||5e3,requestID=0,requests=new Mapper,responses=new Mapper,processedResponses=new Mapper,message2Key={};function storeProcessedResponse(ack,from){var timeout=setTimeout((function(){processedResponses.remove(ack,from)}),duplicates_timeout);processedResponses.set(timeout,ack,from)}function RpcRequest(method,params,id,from,transport){RpcNotification.call(this,method,params),this.getTransport=function(){return transport},this.setTransport=function(value){transport=unifyTransport(value)},defineProperty_IE8||Object.defineProperty(this,"transport",{get:this.getTransport.bind(this),set:this.setTransport.bind(this)});var response=responses.get(id,from);transport||self.getTransport()||(defineProperty_IE8?this.duplicated=Boolean(response):Object.defineProperty(this,"duplicated",{value:Boolean(response)}));var responseMethod=responseMethods[method];this.pack=packer.pack.bind(packer,this,id),this.reply=function(error,result,transport){if(error instanceof Function||error&&error.send instanceof Function){if(null!=result)throw new SyntaxError("There can't be parameters after callback");transport=error,result=null,error=void 0}else if(result instanceof Function||result&&result.send instanceof Function){if(null!=transport)throw new SyntaxError("There can't be parameters after callback");transport=result,result=null}var message;if(transport=unifyTransport(transport),response&&clearTimeout(response.timeout),null!=from&&(error&&(error.dest=from),result&&(result.dest=from)),error||null!=result){if(null!=self.peerID&&(error?error.from=self.peerID:result.from=self.peerID),responseMethod)if(null==responseMethod.error&&error)message={error:error};else message={method:error?responseMethod.error:responseMethod.response,params:error||result};else message={error:error,result:result};message=packer.pack(message,id)}else message=response?response.message:packer.pack({result:null},id);return function storeResponse(message,id,dest){var response={message:message,timeout:setTimeout((function(){responses.remove(id,dest)}),response_timeout)};responses.set(response,id,dest)}(message,id,from),(transport=transport||this.getTransport()||self.getTransport())?transport.send(message):message}}function cancel(message){var key=message2Key[message];if(key){delete message2Key[message];var request=requests.pop(key.id,key.dest);request&&(clearTimeout(request.timeout),storeProcessedResponse(key.id,key.dest))}}inherits(RpcRequest,RpcNotification),this.cancel=function(message){if(message)return cancel(message);for(var message in message2Key)cancel(message)},this.close=function(){var transport=this.getTransport();transport&&transport.close&&transport.close(4003,"Cancel request"),this.cancel(),processedResponses.forEach(clearTimeout),responses.forEach((function(response){clearTimeout(response.timeout)}))},this.encode=function(method,params,dest,transport,callback){if(params instanceof Function){if(null!=dest)throw new SyntaxError("There can't be parameters after callback");callback=params,transport=void 0,dest=void 0,params=void 0}else if(dest instanceof Function){if(null!=transport)throw new SyntaxError("There can't be parameters after callback");callback=dest,transport=void 0,dest=void 0}else if(transport instanceof Function){if(null!=callback)throw new SyntaxError("There can't be parameters after callback");callback=transport,transport=void 0}null!=self.peerID&&((params=params||{}).from=self.peerID),null!=dest&&((params=params||{}).dest=dest);var message={method:method,params:params};if(callback){var id=requestID++,retried=0;function dispatchCallback(error,result){self.cancel(message),callback(error,result)}var request={message:message=packer.pack(message,id),callback:dispatchCallback,responseMethods:responseMethods[method]||{}},encode_transport=unifyTransport(transport);function sendRequest(transport){var rt="ping"===method?ping_request_timeout:request_timeout;return request.timeout=setTimeout(timeout,rt*Math.pow(2,retried++)),message2Key[message]={id:id,dest:dest},requests.set(request,id,dest),(transport=transport||encode_transport||self.getTransport())?transport.send(message):message}function retry(transport){transport=unifyTransport(transport),console.warn(retried+" retry for request message:",message);var timeout=processedResponses.pop(id,dest);return clearTimeout(timeout),sendRequest(transport)}function timeout(){if(retried<max_retries)return retry(transport);var error=new Error("Request has timed out");error.request=message,error.retry=retry,dispatchCallback(error)}return sendRequest(transport)}return message=packer.pack(message),(transport=transport||this.getTransport())?transport.send(message):message},this.decode=function(message,transport){if(!message)throw new TypeError("Message is not defined");try{message=packer.unpack(message)}catch(e){return console.debug(e,message)}var id=message.id,ack=message.ack,method=message.method,params=message.params||{},from=params.from,dest=params.dest;if(null==self.peerID||from!=self.peerID){if(null==id&&null==ack){var notification=new RpcNotification(method,params);if(self.emit("request",notification))return;return notification}if(method){if(null==dest||dest==self.peerID){if(request=requests.get(ack,from)){var responseMethods=request.responseMethods;return method==responseMethods.error?processResponse(request,params):method==responseMethods.response?processResponse(request,null,params):processRequest()}if(processed=processedResponses.get(ack,from))return duplicatedResponse(processed)}return processRequest()}var error=message.error,result=message.result;if(!(error&&error.dest&&error.dest!=self.peerID||result&&result.dest&&result.dest!=self.peerID)){var request,processed;if(!(request=requests.get(ack,from)))return(processed=processedResponses.get(ack,from))?duplicatedResponse(processed):console.warn("No callback was defined for this message",message);processResponse(request,error,result)}}function processRequest(){if(transport=unifyTransport(transport)||self.getTransport()){var response=responses.get(id,from);if(response)return transport.send(response.message)}var request=new RpcRequest(method,params,null!=id?id:ack,from,transport);if(!self.emit("request",request))return request}function processResponse(request,error,result){request.callback(error,result)}function duplicatedResponse(timeout){console.warn("Response already processed",message),clearTimeout(timeout),storeProcessedResponse(ack,from)}}}inherits(RpcBuilder,EventEmitter),RpcBuilder.RpcNotification=RpcNotification,module.exports=RpcBuilder;var clients=__webpack_require__(1107),transports=__webpack_require__(1109);RpcBuilder.clients=clients,RpcBuilder.clients.transports=transports,RpcBuilder.packers=packers},1037:function(module,exports,__webpack_require__){"use strict";var Logger=__webpack_require__(992).OpenViduLogger.getInstance();module.exports=function WebSocketWithReconnection(config){var registerMessageHandler,closing=!1,wsUri=config.uri,reconnecting=!1,ws=new WebSocket(wsUri);ws.onopen=function(){Logger.debug("WebSocket connected to "+wsUri),config.onconnected&&config.onconnected()},ws.onerror=function(error){Logger.error("Could not connect to "+wsUri+" (invoking onerror if defined)",error),config.onerror&&config.onerror(error)};var reconnectionOnClose=function(){3===ws.readyState?closing?Logger.debug("Connection closed by user"):config.ismasternodecrashed()?Logger.error("Master Node has crashed. Stopping reconnection process"):(Logger.debug("Connection closed unexpectedly. Reconnecting..."),reconnect(2e3,1)):Logger.debug("Close callback from previous websocket. Ignoring it")};function reconnect(maxRetries,numRetries){if(Logger.debug("reconnect (attempt #"+numRetries+", max="+maxRetries+")"),1===numRetries){if(reconnecting)return void Logger.warn("Trying to reconnect when already reconnecting... Ignoring this reconnection.");reconnecting=!0,config.onreconnecting&&config.onreconnecting()}!function reconnectAux(maxRetries,numRetries){Logger.debug("Reconnection attempt #"+numRetries),ws.close(),(ws=new WebSocket(wsUri)).onopen=function(){Logger.debug("Reconnected to "+wsUri+" after "+numRetries+" attempts..."),reconnecting=!1,registerMessageHandler(),config.onreconnected()&&config.onreconnected(),ws.onclose=reconnectionOnClose},ws.onerror=function(error){Logger.warn("Reconnection error: ",error),numRetries===maxRetries?config.ondisconnect&&config.ondisconnect():setTimeout((function(){reconnect(maxRetries,numRetries+1)}),3e3)}}(maxRetries,numRetries)}ws.onclose=reconnectionOnClose,this.close=function(){closing=!0,ws.close()},this.reconnectWs=function(){Logger.debug("reconnectWs"),reconnect(2e3,1)},this.send=function(message){ws.send(message)},this.addEventListener=function(type,callback){(registerMessageHandler=function(){ws.addEventListener(type,callback)})()},this.getReadyState=function(){return ws.readyState}}},1088:function(module,exports,__webpack_require__){"use strict";exports.__esModule=!0,exports.OpenVidu=void 0;var platform,LocalRecorder_1=__webpack_require__(1025),Publisher_1=__webpack_require__(1003),Session_1=__webpack_require__(999),SessionDisconnectedEvent_1=__webpack_require__(1012),StreamPropertyChangedEvent_1=__webpack_require__(995),OpenViduError_1=__webpack_require__(996),VideoInsertMode_1=__webpack_require__(1e3),OpenViduLogger_1=__webpack_require__(992),Platform_1=__webpack_require__(994),screenSharingAuto=__webpack_require__(1099),screenSharing=__webpack_require__(1100),OpenViduLoggerConfiguration_1=__webpack_require__(1027),EventEmitter=__webpack_require__(1009),RpcBuilder=__webpack_require__(1036),packageJson=__webpack_require__(1110),logger=OpenViduLogger_1.OpenViduLogger.getInstance(),OpenVidu=function(){function OpenVidu(){var _this=this;this.masterNodeHasCrashed=!1,this.publishers=[],this.secret="",this.recorder=!1,this.advancedConfiguration={},this.webrtcStatsInterval=-1,this.sendBrowserLogs=OpenViduLoggerConfiguration_1.OpenViduLoggerConfiguration.disabled,this.ee=new EventEmitter,platform=Platform_1.PlatformUtils.getInstance(),this.libraryVersion=packageJson.version,logger.info("OpenVidu initialized"),logger.info("Platform detected: "+platform.getDescription()),logger.info("openvidu-browser version: "+this.libraryVersion),(platform.isMobileDevice()||platform.isReactNative())&&this.onOrientationChanged((function(){_this.publishers.forEach((function(publisher){publisher.stream.isLocalStreamPublished&&publisher.stream&&publisher.stream.hasVideo&&_this.sendNewVideoDimensionsIfRequired(publisher,"deviceRotated",75,10)}))}))}return OpenVidu.prototype.onOrientationChanged=function(handler){window.addEventListener("orientationchange",handler)},OpenVidu.prototype.sendNewVideoDimensionsIfRequired=function(publisher,reason,WAIT_INTERVAL,MAX_ATTEMPTS){var _this=this,attempts=0,oldWidth=publisher.stream.videoDimensions.width,oldHeight=publisher.stream.videoDimensions.height,repeatUntilChangeOrMaxAttempts=setInterval((function(){++attempts>MAX_ATTEMPTS&&clearTimeout(repeatUntilChangeOrMaxAttempts),publisher.getVideoDimensions(publisher.stream.getMediaStream()).then((function(newDimensions){newDimensions.width===oldWidth&&newDimensions.height===oldHeight||(clearTimeout(repeatUntilChangeOrMaxAttempts),_this.sendVideoDimensionsChangedEvent(publisher,reason,oldWidth,oldHeight,newDimensions.width,newDimensions.height))}))}),WAIT_INTERVAL)},OpenVidu.prototype.sendVideoDimensionsChangedEvent=function(publisher,reason,oldWidth,oldHeight,newWidth,newHeight){var _this=this;publisher.stream.videoDimensions={width:newWidth||0,height:newHeight||0},this.sendRequest("streamPropertyChanged",{streamId:publisher.stream.streamId,property:"videoDimensions",newValue:JSON.stringify(publisher.stream.videoDimensions),reason:reason},(function(error,response){error?logger.error("Error sending 'streamPropertyChanged' event",error):(_this.session.emitEvent("streamPropertyChanged",[new StreamPropertyChangedEvent_1.StreamPropertyChangedEvent(_this.session,publisher.stream,"videoDimensions",publisher.stream.videoDimensions,{width:oldWidth,height:oldHeight},reason)]),publisher.emitEvent("streamPropertyChanged",[new StreamPropertyChangedEvent_1.StreamPropertyChangedEvent(publisher,publisher.stream,"videoDimensions",publisher.stream.videoDimensions,{width:oldWidth,height:oldHeight},reason)]),_this.session.sendVideoData(publisher))}))},OpenVidu.prototype.initSession=function(){return this.session=new Session_1.Session(this),this.session},OpenVidu.prototype.initPublisher=function(targetElement,param2,param3){var properties;properties=param2&&"function"!=typeof param2?{audioSource:void 0!==(properties=param2).audioSource?properties.audioSource:void 0,frameRate:"undefined"!=typeof MediaStreamTrack&&properties.videoSource instanceof MediaStreamTrack?void 0:void 0!==properties.frameRate?properties.frameRate:void 0,insertMode:void 0!==properties.insertMode?"string"==typeof properties.insertMode?VideoInsertMode_1.VideoInsertMode[properties.insertMode]:properties.insertMode:VideoInsertMode_1.VideoInsertMode.APPEND,mirror:void 0===properties.mirror||properties.mirror,publishAudio:void 0===properties.publishAudio||properties.publishAudio,publishVideo:void 0===properties.publishVideo||properties.publishVideo,resolution:"undefined"!=typeof MediaStreamTrack&&properties.videoSource instanceof MediaStreamTrack?void 0:void 0!==properties.resolution?properties.resolution:"640x480",videoSource:void 0!==properties.videoSource?properties.videoSource:void 0,filter:properties.filter}:{insertMode:VideoInsertMode_1.VideoInsertMode.APPEND,mirror:!0,publishAudio:!0,publishVideo:!0,resolution:"640x480"};var completionHandler,publisher=new Publisher_1.Publisher(targetElement,properties,this);return param2&&"function"==typeof param2?completionHandler=param2:param3&&(completionHandler=param3),publisher.initialize().then((function(){void 0!==completionHandler&&completionHandler(void 0),publisher.emitEvent("accessAllowed",[])})).catch((function(error){void 0!==completionHandler&&completionHandler(error),publisher.emitEvent("accessDenied",[error])})),this.publishers.push(publisher),publisher},OpenVidu.prototype.initPublisherAsync=function(targetElement,properties){var _this=this;return new Promise((function(resolve,reject){var publisher,callback=function(error){error?reject(error):resolve(publisher)};publisher=properties?_this.initPublisher(targetElement,properties,callback):_this.initPublisher(targetElement,callback)}))},OpenVidu.prototype.initLocalRecorder=function(stream){return new LocalRecorder_1.LocalRecorder(stream)},OpenVidu.prototype.checkSystemRequirements=function(){return platform.isIPhoneOrIPad()?platform.isIOSWithSafari()||platform.isIonicIos()?1:0:platform.isChromeBrowser()||platform.isChromeMobileBrowser()||platform.isFirefoxBrowser()||platform.isFirefoxMobileBrowser()||platform.isOperaBrowser()||platform.isOperaMobileBrowser()||platform.isEdgeBrowser()||platform.isEdgeMobileBrowser()||platform.isSafariBrowser()||platform.isAndroidBrowser()||platform.isElectron()||platform.isSamsungBrowser()?1:0},OpenVidu.prototype.checkScreenSharingCapabilities=function(){return platform.canScreenShare()},OpenVidu.prototype.getDevices=function(){return new Promise((function(resolve,reject){navigator.mediaDevices.enumerateDevices().then((function(deviceInfos){var _a,devices=[];platform.isIonicAndroid()&&"undefined"!=typeof cordova&&(null===(_a=null===cordova||void 0===cordova?void 0:cordova.plugins)||void 0===_a?void 0:_a.EnumerateDevicesPlugin)?cordova.plugins.EnumerateDevicesPlugin.getEnumerateDevices().then((function(pluginDevices){var pluginAudioDevices=[],videoDevices=[],audioDevices=[];pluginAudioDevices=pluginDevices.filter((function(device){return"audioinput"===device.kind})),videoDevices=deviceInfos.filter((function(device){return"videoinput"===device.kind})),audioDevices=deviceInfos.filter((function(device){return"audioinput"===device.kind})),videoDevices.forEach((function(deviceInfo,index){if(deviceInfo.label)devices.push({kind:deviceInfo.kind,deviceId:deviceInfo.deviceId,label:deviceInfo.label});else{var label="";label=0===index?"Front Camera":1===index?"Back Camera":"Unknown Camera",devices.push({kind:deviceInfo.kind,deviceId:deviceInfo.deviceId,label:label})}})),audioDevices.forEach((function(deviceInfo,index){if(deviceInfo.label)devices.push({kind:deviceInfo.kind,deviceId:deviceInfo.deviceId,label:deviceInfo.label});else{var label="";switch(index){case 0:label="Default";break;case 1:var defaultMatch=pluginAudioDevices.filter((function(d){return d.label.includes("Built")}))[0];label=defaultMatch?defaultMatch.label:"Built-in Microphone";break;case 2:var wiredMatch=pluginAudioDevices.filter((function(d){return d.label.includes("Wired")}))[0];label=wiredMatch?wiredMatch.label:"Headset earpiece";break;case 3:var wirelessMatch=pluginAudioDevices.filter((function(d){return d.label.includes("Bluetooth")}))[0];label=wirelessMatch?wirelessMatch.label:"Wireless";break;default:label="Unknown Microphone"}devices.push({kind:deviceInfo.kind,deviceId:deviceInfo.deviceId,label:label})}})),resolve(devices)})):(deviceInfos.forEach((function(deviceInfo){"audioinput"!==deviceInfo.kind&&"videoinput"!==deviceInfo.kind||devices.push({kind:deviceInfo.kind,deviceId:deviceInfo.deviceId,label:deviceInfo.label})})),resolve(devices))})).catch((function(error){logger.error("Error getting devices",error),reject(error)}))}))},OpenVidu.prototype.getUserMedia=function(options){var _this=this;return new Promise((function(resolve,reject){var askForAudioStreamOnly=function(previousMediaStream,constraints){var constraintsAux={audio:void 0===constraints.audio||constraints.audio,video:!1};navigator.mediaDevices.getUserMedia(constraintsAux).then((function(audioOnlyStream){previousMediaStream.addTrack(audioOnlyStream.getAudioTracks()[0]),resolve(previousMediaStream)})).catch((function(error){previousMediaStream.getAudioTracks().forEach((function(track){track.stop()})),previousMediaStream.getVideoTracks().forEach((function(track){track.stop()})),reject(_this.generateAudioDeviceError(error,constraintsAux))}))};_this.generateMediaConstraints(options).then((function(myConstraints){var _a,_b;if(myConstraints.videoTrack&&myConstraints.audioTrack||myConstraints.audioTrack&&!1===(null===(_a=myConstraints.constraints)||void 0===_a?void 0:_a.video)||myConstraints.videoTrack&&!1===(null===(_b=myConstraints.constraints)||void 0===_b?void 0:_b.audio))resolve(_this.addAlreadyProvidedTracks(myConstraints,new MediaStream));else{myConstraints.videoTrack&&delete myConstraints.constraints.video,myConstraints.audioTrack&&delete myConstraints.constraints.audio;var mustAskForAudioTrackLater_1=!1;if("string"==typeof options.videoSource&&("screen"===options.videoSource||"window"===options.videoSource||platform.isElectron()&&options.videoSource.startsWith("screen:"))&&(mustAskForAudioTrackLater_1=!myConstraints.audioTrack&&null!==options.audioSource&&!1!==options.audioSource,navigator.mediaDevices.getDisplayMedia&&!platform.isElectron()))return void navigator.mediaDevices.getDisplayMedia({video:!0}).then((function(mediaStream){_this.addAlreadyProvidedTracks(myConstraints,mediaStream),mustAskForAudioTrackLater_1?askForAudioStreamOnly(mediaStream,myConstraints.constraints):resolve(mediaStream)})).catch((function(error){var errorName=OpenViduError_1.OpenViduErrorName.SCREEN_CAPTURE_DENIED,errorMessage=error.toString();reject(new OpenViduError_1.OpenViduError(errorName,errorMessage))}));var constraintsAux=mustAskForAudioTrackLater_1?{video:myConstraints.constraints.video}:myConstraints.constraints;navigator.mediaDevices.getUserMedia(constraintsAux).then((function(mediaStream){_this.addAlreadyProvidedTracks(myConstraints,mediaStream),mustAskForAudioTrackLater_1?askForAudioStreamOnly(mediaStream,myConstraints.constraints):resolve(mediaStream)})).catch((function(error){var errorName,errorMessage=error.toString();errorName="screen"!==options.videoSource?OpenViduError_1.OpenViduErrorName.DEVICE_ACCESS_DENIED:OpenViduError_1.OpenViduErrorName.SCREEN_CAPTURE_DENIED,reject(new OpenViduError_1.OpenViduError(errorName,errorMessage))}))}})).catch((function(error){reject(error)}))}))},OpenVidu.prototype.enableProdMode=function(){logger.enableProdMode()},OpenVidu.prototype.setAdvancedConfiguration=function(configuration){this.advancedConfiguration=configuration},OpenVidu.prototype.generateMediaConstraints=function(publisherProperties){var _this=this;return new Promise((function(resolve,reject){var myConstraints={audioTrack:void 0,videoTrack:void 0,constraints:{audio:void 0,video:void 0}},audioSource=publisherProperties.audioSource,videoSource=publisherProperties.videoSource;if(null!==audioSource&&!1!==audioSource||(myConstraints.constraints.audio=!1),null!==videoSource&&!1!==videoSource||(myConstraints.constraints.video=!1),!1===myConstraints.constraints.audio&&!1===myConstraints.constraints.video&&reject(new OpenViduError_1.OpenViduError(OpenViduError_1.OpenViduErrorName.NO_INPUT_SOURCE_SET,"Properties 'audioSource' and 'videoSource' cannot be set to false or null at the same time")),"undefined"!=typeof MediaStreamTrack&&audioSource instanceof MediaStreamTrack&&(myConstraints.audioTrack=audioSource),"undefined"!=typeof MediaStreamTrack&&videoSource instanceof MediaStreamTrack&&(myConstraints.videoTrack=videoSource),void 0===audioSource&&(myConstraints.constraints.audio=!0),void 0===videoSource&&(myConstraints.constraints.video={width:{ideal:640},height:{ideal:480}}),null!==videoSource&&!1!==videoSource){if(publisherProperties.resolution){var widthAndHeight=publisherProperties.resolution.toLowerCase().split("x"),idealWidth=Number(widthAndHeight[0]),idealHeight=Number(widthAndHeight[1]);myConstraints.constraints.video={width:{ideal:idealWidth},height:{ideal:idealHeight}}}publisherProperties.frameRate&&(myConstraints.constraints.video.frameRate={ideal:publisherProperties.frameRate})}_this.configureDeviceIdOrScreensharing(myConstraints,publisherProperties,resolve,reject),resolve(myConstraints)}))},OpenVidu.prototype.startWs=function(onConnectSucces){var config={heartbeat:5e3,ws:{uri:this.wsUri+"?sessionId="+this.session.sessionId,onconnected:onConnectSucces,ondisconnect:this.disconnectCallback.bind(this),onreconnecting:this.reconnectingCallback.bind(this),onreconnected:this.reconnectedCallback.bind(this),ismasternodecrashed:this.isMasterNodeCrashed.bind(this)},rpc:{requestTimeout:1e4,participantJoined:this.session.onParticipantJoined.bind(this.session),participantPublished:this.session.onParticipantPublished.bind(this.session),participantUnpublished:this.session.onParticipantUnpublished.bind(this.session),participantLeft:this.session.onParticipantLeft.bind(this.session),participantEvicted:this.session.onParticipantEvicted.bind(this.session),recordingStarted:this.session.onRecordingStarted.bind(this.session),recordingStopped:this.session.onRecordingStopped.bind(this.session),sendMessage:this.session.onNewMessage.bind(this.session),streamPropertyChanged:this.session.onStreamPropertyChanged.bind(this.session),connectionPropertyChanged:this.session.onConnectionPropertyChanged.bind(this.session),networkQualityLevelChanged:this.session.onNetworkQualityLevelChangedChanged.bind(this.session),filterEventDispatched:this.session.onFilterEventDispatched.bind(this.session),iceCandidate:this.session.recvIceCandidate.bind(this.session),mediaError:this.session.onMediaError.bind(this.session),masterNodeCrashedNotification:this.onMasterNodeCrashedNotification.bind(this)}};this.jsonRpcClient=new RpcBuilder.clients.JsonRpcClient(config)},OpenVidu.prototype.onMasterNodeCrashedNotification=function(response){console.error("Master Node has crashed"),this.masterNodeHasCrashed=!0,this.session.onLostConnection("nodeCrashed"),this.jsonRpcClient.close(4103,"Master Node has crashed")},OpenVidu.prototype.getWsReadyState=function(){return this.jsonRpcClient.getReadyState()},OpenVidu.prototype.closeWs=function(){this.jsonRpcClient.close(4102,"Connection closed by client")},OpenVidu.prototype.sendRequest=function(method,params,callback){params&&params instanceof Function&&(callback=params,params={}),logger.debug('Sending request: {method:"'+method+'", params: '+JSON.stringify(params)+"}"),this.jsonRpcClient.send(method,params,callback)},OpenVidu.prototype.getWsUri=function(){return this.wsUri},OpenVidu.prototype.getSecret=function(){return this.secret},OpenVidu.prototype.getRecorder=function(){return this.recorder},OpenVidu.prototype.generateAudioDeviceError=function(error,constraints){var errorName,errorMessage;switch("Error"===error.name&&(error.name=error.constructor.name),error.name.toLowerCase()){case"notfounderror":return errorName=OpenViduError_1.OpenViduErrorName.INPUT_AUDIO_DEVICE_NOT_FOUND,errorMessage=error.toString(),new OpenViduError_1.OpenViduError(errorName,errorMessage);case"notallowederror":return errorName=OpenViduError_1.OpenViduErrorName.DEVICE_ACCESS_DENIED,errorMessage=error.toString(),new OpenViduError_1.OpenViduError(errorName,errorMessage);case"overconstrainederror":return"deviceid"===error.constraint.toLowerCase()?(errorName=OpenViduError_1.OpenViduErrorName.INPUT_AUDIO_DEVICE_NOT_FOUND,errorMessage="Audio input device with deviceId '"+constraints.audio.deviceId.exact+"' not found"):(errorName=OpenViduError_1.OpenViduErrorName.PUBLISHER_PROPERTIES_ERROR,errorMessage="Audio input device doesn't support the value passed for constraint '"+error.constraint+"'"),new OpenViduError_1.OpenViduError(errorName,errorMessage);case"notreadableerror":return errorName=OpenViduError_1.OpenViduErrorName.DEVICE_ALREADY_IN_USE,errorMessage=error.toString(),new OpenViduError_1.OpenViduError(errorName,errorMessage);default:return new OpenViduError_1.OpenViduError(OpenViduError_1.OpenViduErrorName.INPUT_AUDIO_DEVICE_GENERIC_ERROR,error.toString())}},OpenVidu.prototype.addAlreadyProvidedTracks=function(myConstraints,mediaStream){return myConstraints.videoTrack&&mediaStream.addTrack(myConstraints.videoTrack),myConstraints.audioTrack&&mediaStream.addTrack(myConstraints.audioTrack),mediaStream},OpenVidu.prototype.configureDeviceIdOrScreensharing=function(myConstraints,publisherProperties,resolve,reject){var _this=this,audioSource=publisherProperties.audioSource,videoSource=publisherProperties.videoSource;if("string"==typeof audioSource&&(myConstraints.constraints.audio={deviceId:{exact:audioSource}}),"string"==typeof videoSource)if(this.isScreenShare(videoSource))if(this.checkScreenSharingCapabilities())if(platform.isElectron()){var videoSourceString=videoSource,electronScreenId=videoSourceString.substr(videoSourceString.indexOf("screen:")+"screen:".length);myConstraints.constraints.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:electronScreenId}},resolve(myConstraints)}else{if(this.advancedConfiguration.screenShareChromeExtension&&!platform.isFirefoxBrowser()&&!platform.isFirefoxMobileBrowser()&&!navigator.mediaDevices.getDisplayMedia)return void screenSharing.getScreenConstraints((function(error,screenConstraints){if(error||screenConstraints.mandatory&&"screen"===screenConstraints.mandatory.chromeMediaSource){if("permission-denied"!==error&&"PermissionDeniedError"!==error){var extensionId=_this.advancedConfiguration.screenShareChromeExtension.split("/").pop().trim();return void screenSharing.getChromeExtensionStatus(extensionId,(function(status){if("installed-disabled"===status){var error_2=new OpenViduError_1.OpenViduError(OpenViduError_1.OpenViduErrorName.SCREEN_EXTENSION_DISABLED,"You must enable the screen extension");logger.error(error_2),reject(error_2)}if("not-installed"===status){var error_3=new OpenViduError_1.OpenViduError(OpenViduError_1.OpenViduErrorName.SCREEN_EXTENSION_NOT_INSTALLED,_this.advancedConfiguration.screenShareChromeExtension);logger.error(error_3),reject(error_3)}}))}var error_1=new OpenViduError_1.OpenViduError(OpenViduError_1.OpenViduErrorName.SCREEN_CAPTURE_DENIED,"You must allow access to one window of your desktop");logger.error(error_1),reject(error_1)}else myConstraints.constraints.video=screenConstraints,resolve(myConstraints)}));if(!navigator.mediaDevices.getDisplayMedia){var firefoxString=platform.isFirefoxBrowser()||platform.isFirefoxMobileBrowser()?publisherProperties.videoSource:void 0;return void screenSharingAuto.getScreenId(firefoxString,(function(error,sourceId,screenConstraints){if(error)if("not-installed"===error){var extensionUrl=_this.advancedConfiguration.screenShareChromeExtension?_this.advancedConfiguration.screenShareChromeExtension:"https://chrome.google.com/webstore/detail/openvidu-screensharing/lfcgfepafnobdloecchnfaclibenjold",err=new OpenViduError_1.OpenViduError(OpenViduError_1.OpenViduErrorName.SCREEN_EXTENSION_NOT_INSTALLED,extensionUrl);logger.error(err),reject(err)}else if("installed-disabled"===error){err=new OpenViduError_1.OpenViduError(OpenViduError_1.OpenViduErrorName.SCREEN_EXTENSION_DISABLED,"You must enable the screen extension");logger.error(err),reject(err)}else if("permission-denied"===error){err=new OpenViduError_1.OpenViduError(OpenViduError_1.OpenViduErrorName.SCREEN_CAPTURE_DENIED,"You must allow access to one window of your desktop");logger.error(err),reject(err)}else{err=new OpenViduError_1.OpenViduError(OpenViduError_1.OpenViduErrorName.GENERIC_ERROR,"Unknown error when accessing screen share");logger.error(err),logger.error(error),reject(err)}else myConstraints.constraints.video=screenConstraints.video,resolve(myConstraints)}))}resolve(myConstraints)}else{var error=new OpenViduError_1.OpenViduError(OpenViduError_1.OpenViduErrorName.SCREEN_SHARING_NOT_SUPPORTED,"You can only screen share in desktop Chrome, Firefox, Opera, Safari (>=13.0), Edge (>= 80) or Electron. Detected client: "+platform.getName()+" "+platform.getVersion());logger.error(error),reject(error)}else this.setVideoSource(myConstraints,videoSource)},OpenVidu.prototype.setVideoSource=function(myConstraints,videoSource){myConstraints.constraints.video||(myConstraints.constraints.video={}),myConstraints.constraints.video.deviceId={exact:videoSource}},OpenVidu.prototype.disconnectCallback=function(){logger.warn("Websocket connection lost"),this.isRoomAvailable()?this.session.onLostConnection("networkDisconnect"):alert("Connection error. Please reload page.")},OpenVidu.prototype.reconnectingCallback=function(){logger.warn("Websocket connection lost (reconnecting)"),this.isRoomAvailable()?this.session.emitEvent("reconnecting",[]):alert("Connection error. Please reload page.")},OpenVidu.prototype.reconnectedCallback=function(){var _this=this;if(logger.warn("Websocket reconnected"),this.isRoomAvailable())if(this.session.connection)this.sendRequest("connect",{sessionId:this.session.connection.rpcSessionId},(function(error,response){error?_this.isMasterNodeCrashed()?logger.warn("Master Node has crashed!"):(logger.error(error),logger.warn("Websocket was able to reconnect to OpenVidu Server, but your Connection was already destroyed due to timeout. You are no longer a participant of the Session and your media streams have been destroyed"),_this.session.onLostConnection("networkDisconnect"),_this.jsonRpcClient.close(4101,"Reconnection fault")):(_this.jsonRpcClient.resetPing(),_this.session.onRecoveredConnection())}));else{logger.warn("There was no previous connection when running reconnection callback");var sessionDisconnectEvent=new SessionDisconnectedEvent_1.SessionDisconnectedEvent(this.session,"networkDisconnect");this.session.ee.emitEvent("sessionDisconnected",[sessionDisconnectEvent]),sessionDisconnectEvent.callDefaultBehavior()}else alert("Connection error. Please reload page.")},OpenVidu.prototype.isMasterNodeCrashed=function(){return this.masterNodeHasCrashed},OpenVidu.prototype.isRoomAvailable=function(){return void 0!==this.session&&this.session instanceof Session_1.Session||(logger.warn("Session instance not found"),!1)},OpenVidu.prototype.isScreenShare=function(videoSource){return"screen"===videoSource||"window"===videoSource||platform.isElectron()&&videoSource.startsWith("screen:")},OpenVidu}();exports.OpenVidu=OpenVidu},1089:function(module,exports,__webpack_require__){var extendStatics,__extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)});function JL(loggerName){if(!loggerName)return JL.__;Array.prototype.reduce||(Array.prototype.reduce=function(callback,initialValue){for(var previousValue=initialValue,i=0;i<this.length;i++)previousValue=callback(previousValue,this[i],i,this);return previousValue});var accumulatedLoggerName="";return("."+loggerName).split(".").reduce((function(prev,curr,idx,arr){accumulatedLoggerName?accumulatedLoggerName+="."+curr:accumulatedLoggerName=curr;var currentLogger=prev["__"+accumulatedLoggerName];return void 0===currentLogger&&(JL.Logger.prototype=prev,currentLogger=new JL.Logger(accumulatedLoggerName),prev["__"+accumulatedLoggerName]=currentLogger),currentLogger}),JL.__)}!function(JL){function copyProperty(propertyName,from,to){void 0!==from[propertyName]&&(null!==from[propertyName]?to[propertyName]=from[propertyName]:delete to[propertyName])}function allow(filters){if(null!=JL.enabled&&!JL.enabled)return!1;try{if(filters.userAgentRegex&&!new RegExp(filters.userAgentRegex).test(navigator.userAgent))return!1}catch(e){}try{if(filters.ipRegex&&JL.clientIP&&!new RegExp(filters.ipRegex).test(JL.clientIP))return!1}catch(e){}return!0}function allowMessage(filters,message){try{if(filters.disallow&&new RegExp(filters.disallow).test(message))return!1}catch(e){}return!0}function stringifyLogObjectFunction(logObject){return"function"==typeof logObject?logObject instanceof RegExp?logObject.toString():logObject():logObject}JL.requestId="",JL.entryId=0,JL._createXMLHttpRequest=function(){return new XMLHttpRequest},JL._getTime=function(){return(new Date).getTime()},JL._console=console,JL._appenderNames=[];var StringifiedLogObject=function StringifiedLogObject(msg,meta,finalString){this.msg=msg,this.meta=meta,this.finalString=finalString};function stringifyLogObject(logObject){var finalString,actualLogObject=stringifyLogObjectFunction(logObject);switch(typeof actualLogObject){case"string":return new StringifiedLogObject(actualLogObject,null,actualLogObject);case"number":case"boolean":return finalString=actualLogObject.toString(),new StringifiedLogObject(finalString,null,finalString);case"undefined":return new StringifiedLogObject("undefined",null,"undefined");case"object":return actualLogObject instanceof RegExp||actualLogObject instanceof String||actualLogObject instanceof Number||actualLogObject instanceof Boolean?(finalString=actualLogObject.toString(),new StringifiedLogObject(finalString,null,finalString)):(finalString="function"==typeof JL.serialize?JL.serialize.call(this,actualLogObject):JSON.stringify(actualLogObject),new StringifiedLogObject("",actualLogObject,finalString));default:return new StringifiedLogObject("unknown",null,"unknown")}}function getTraceLevel(){return 1e3}function getDebugLevel(){return 2e3}function getInfoLevel(){return 3e3}function getWarnLevel(){return 4e3}function getErrorLevel(){return 5e3}function getFatalLevel(){return 6e3}function levelToString(level){return level<=1e3?"trace":level<=2e3?"debug":level<=3e3?"info":level<=4e3?"warn":level<=5e3?"error":"fatal"}JL.setOptions=function setOptions(options){return copyProperty("enabled",options,this),copyProperty("maxMessages",options,this),copyProperty("defaultAjaxUrl",options,this),copyProperty("clientIP",options,this),copyProperty("requestId",options,this),copyProperty("defaultBeforeSend",options,this),copyProperty("serialize",options,this),this},JL.getAllLevel=function getAllLevel(){return-2147483648},JL.getTraceLevel=getTraceLevel,JL.getDebugLevel=getDebugLevel,JL.getInfoLevel=getInfoLevel,JL.getWarnLevel=getWarnLevel,JL.getErrorLevel=getErrorLevel,JL.getFatalLevel=getFatalLevel,JL.getOffLevel=function getOffLevel(){return 2147483647};var Exception=function Exception(data,inner){this.inner=inner,this.name="JL.Exception",this.message=stringifyLogObject(data).finalString};JL.Exception=Exception,Exception.prototype=new Error;var LogItem=function LogItem(l,m,n,t,u){this.l=l,this.m=m,this.n=n,this.t=t,this.u=u};function newLogItem(levelNbr,message,loggerName){return JL.entryId++,new LogItem(levelNbr,message,loggerName,JL._getTime(),JL.entryId)}function clearTimer(timer){timer.id&&(clearTimeout(timer.id),timer.id=null)}function setTimer(timer,timeoutMs,callback){var that=this;timer.id||(timer.id=setTimeout((function(){callback.call(that)}),timeoutMs))}JL.LogItem=LogItem;var Appender=function(){function Appender(appenderName,sendLogItems){this.appenderName=appenderName,this.sendLogItems=sendLogItems,this.level=JL.getTraceLevel(),this.sendWithBufferLevel=2147483647,this.storeInBufferLevel=-2147483648,this.bufferSize=0,this.batchSize=1,this.maxBatchSize=20,this.batchTimeout=2147483647,this.sendTimeout=5e3,this.buffer=[],this.batchBuffer=[],this.batchTimeoutTimer={id:null},this.sendTimeoutTimer={id:null},this.nbrLogItemsSkipped=0,this.nbrLogItemsBeingSent=0;var emptyNameErrorMessage="Trying to create an appender without a name or with an empty name";if(null==appenderName)throw emptyNameErrorMessage;if(-1!=JL._appenderNames.indexOf(appenderName)){if(!appenderName)throw emptyNameErrorMessage;throw"Multiple appenders use the same name "+appenderName}JL._appenderNames.push(appenderName)}return Appender.prototype.addLogItemsToBuffer=function(logItems){if(this.batchBuffer.length>=this.maxBatchSize)this.nbrLogItemsSkipped+=logItems.length;else{if(null!=JL.maxMessages){if(JL.maxMessages<1)return;JL.maxMessages-=logItems.length}this.batchBuffer=this.batchBuffer.concat(logItems);var that=this;setTimer(this.batchTimeoutTimer,this.batchTimeout,(function(){that.sendBatch.call(that)}))}},Appender.prototype.batchBufferHasOverdueMessages=function(){for(var i=0;i<this.batchBuffer.length;i++){if(JL._getTime()-this.batchBuffer[i].t>this.batchTimeout)return!0}return!1},Appender.prototype.batchBufferHasStrandedMessage=function(){return!(null==JL.maxMessages)&&JL.maxMessages<1&&this.batchBuffer.length>0},Appender.prototype.sendBatchIfComplete=function(){(this.batchBuffer.length>=this.batchSize||this.batchBufferHasOverdueMessages()||this.batchBufferHasStrandedMessage())&&this.sendBatch()},Appender.prototype.onSendingEnded=function(){clearTimer(this.sendTimeoutTimer),this.nbrLogItemsBeingSent=0,this.sendBatchIfComplete()},Appender.prototype.setOptions=function(options){if(copyProperty("level",options,this),copyProperty("ipRegex",options,this),copyProperty("userAgentRegex",options,this),copyProperty("disallow",options,this),copyProperty("sendWithBufferLevel",options,this),copyProperty("storeInBufferLevel",options,this),copyProperty("bufferSize",options,this),copyProperty("batchSize",options,this),copyProperty("maxBatchSize",options,this),copyProperty("batchTimeout",options,this),copyProperty("sendTimeout",options,this),this.bufferSize<this.buffer.length&&(this.buffer.length=this.bufferSize),this.maxBatchSize<this.batchSize)throw new JL.Exception({message:"maxBatchSize cannot be smaller than batchSize",maxBatchSize:this.maxBatchSize,batchSize:this.batchSize});return this},Appender.prototype.log=function(level,msg,meta,callback,levelNbr,message,loggerName){var logItem;allow(this)&&allowMessage(this,message)&&(levelNbr<this.storeInBufferLevel||(logItem=newLogItem(levelNbr,message,loggerName),levelNbr<this.level?this.bufferSize>0&&(this.buffer.push(logItem),this.buffer.length>this.bufferSize&&this.buffer.shift()):(this.addLogItemsToBuffer([logItem]),levelNbr>=this.sendWithBufferLevel&&this.buffer.length&&(this.addLogItemsToBuffer(this.buffer),this.buffer.length=0),this.sendBatchIfComplete())))},Appender.prototype.sendBatch=function(){if(!(this.nbrLogItemsBeingSent>0)&&(clearTimer(this.batchTimeoutTimer),0!=this.batchBuffer.length)){this.nbrLogItemsBeingSent=this.batchBuffer.length;var that=this;setTimer(this.sendTimeoutTimer,this.sendTimeout,(function(){that.onSendingEnded.call(that)})),this.sendLogItems(this.batchBuffer,(function(){that.batchBuffer.splice(0,that.nbrLogItemsBeingSent),that.nbrLogItemsSkipped>0&&(that.batchBuffer.push(newLogItem(4e3,"Lost "+that.nbrLogItemsSkipped+" messages. Either connection with the server was down or logging was disabled via the enabled option. Reduce lost messages by increasing the ajaxAppender option maxBatchSize.",that.appenderName)),that.nbrLogItemsSkipped=0),that.onSendingEnded.call(that)}))}},Appender}();JL.Appender=Appender;var AjaxAppender=function(_super){function AjaxAppender(appenderName){return _super.call(this,appenderName,AjaxAppender.prototype.sendLogItemsAjax)||this}return __extends(AjaxAppender,_super),AjaxAppender.prototype.setOptions=function(options){return copyProperty("url",options,this),copyProperty("beforeSend",options,this),_super.prototype.setOptions.call(this,options),this},AjaxAppender.prototype.sendLogItemsAjax=function(logItems,successCallback){try{if(!allow(this))return;this.xhr&&0!=this.xhr.readyState&&4!=this.xhr.readyState&&this.xhr.abort(),this.xhr=JL._createXMLHttpRequest();var ajaxUrl="/jsnlog.logger";null!=JL.defaultAjaxUrl&&(ajaxUrl=JL.defaultAjaxUrl),this.url&&(ajaxUrl=this.url),this.xhr.open("POST",ajaxUrl),this.xhr.setRequestHeader("Content-Type","application/json"),this.xhr.setRequestHeader("JSNLog-RequestId",JL.requestId);var that=this;this.xhr.onreadystatechange=function(){4==that.xhr.readyState&&that.xhr.status>=200&&that.xhr.status<300&&successCallback()};var json={r:JL.requestId,lg:logItems};"function"==typeof this.beforeSend?this.beforeSend.call(this,this.xhr,json):"function"==typeof JL.defaultBeforeSend&&JL.defaultBeforeSend.call(this,this.xhr,json);var finalmsg=JSON.stringify(json);this.xhr.send(finalmsg)}catch(e){}},AjaxAppender}(Appender);JL.AjaxAppender=AjaxAppender;var ConsoleAppender=function(_super){function ConsoleAppender(appenderName){return _super.call(this,appenderName,ConsoleAppender.prototype.sendLogItemsConsole)||this}return __extends(ConsoleAppender,_super),ConsoleAppender.prototype.clog=function(logEntry){JL._console.log(logEntry)},ConsoleAppender.prototype.cerror=function(logEntry){JL._console.error?JL._console.error(logEntry):this.clog(logEntry)},ConsoleAppender.prototype.cwarn=function(logEntry){JL._console.warn?JL._console.warn(logEntry):this.clog(logEntry)},ConsoleAppender.prototype.cinfo=function(logEntry){JL._console.info?JL._console.info(logEntry):this.clog(logEntry)},ConsoleAppender.prototype.cdebug=function(logEntry){JL._console.debug?JL._console.debug(logEntry):this.cinfo(logEntry)},ConsoleAppender.prototype.sendLogItemsConsole=function(logItems,successCallback){try{if(!allow(this))return;if(!JL._console)return;var i;for(i=0;i<logItems.length;++i){var li=logItems[i],msg=li.n+": "+li.m;"undefined"==typeof window&&(msg=new Date(li.t)+" | "+msg),li.l<=JL.getDebugLevel()?this.cdebug(msg):li.l<=JL.getInfoLevel()?this.cinfo(msg):li.l<=JL.getWarnLevel()?this.cwarn(msg):this.cerror(msg)}}catch(e){}successCallback()},ConsoleAppender}(Appender);JL.ConsoleAppender=ConsoleAppender;var defaultAppender,Logger=function(){function Logger(loggerName){this.loggerName=loggerName,this.seenRegexes=[]}return Logger.prototype.setOptions=function(options){return copyProperty("level",options,this),copyProperty("userAgentRegex",options,this),copyProperty("disallow",options,this),copyProperty("ipRegex",options,this),copyProperty("appenders",options,this),copyProperty("onceOnly",options,this),this.seenRegexes=[],this},Logger.prototype.buildExceptionObject=function(e){var excObject={};return e.stack?excObject.stack=e.stack:excObject.e=e,e.message&&(excObject.message=e.message),e.name&&(excObject.name=e.name),e.data&&(excObject.data=e.data),e.inner&&(excObject.inner=this.buildExceptionObject(e.inner)),excObject},Logger.prototype.log=function(level,logObject,e){var compositeMessage,excObject,i=0;if(!this.appenders)return this;if(level>=this.level&&allow(this)&&(e?(excObject=this.buildExceptionObject(e)).logData=stringifyLogObjectFunction(logObject):excObject=logObject,allowMessage(this,(compositeMessage=stringifyLogObject(excObject)).finalString))){if(this.onceOnly)for(i=this.onceOnly.length-1;i>=0;){if(new RegExp(this.onceOnly[i]).test(compositeMessage.finalString)){if(this.seenRegexes[i])return this;this.seenRegexes[i]=!0}i--}for(compositeMessage.meta=compositeMessage.meta||{},i=this.appenders.length-1;i>=0;)this.appenders[i].log(levelToString(level),compositeMessage.msg,compositeMessage.meta,(function(){}),level,compositeMessage.finalString,this.loggerName),i--}return this},Logger.prototype.trace=function(logObject){return this.log(1e3,logObject)},Logger.prototype.debug=function(logObject){return this.log(2e3,logObject)},Logger.prototype.info=function(logObject){return this.log(3e3,logObject)},Logger.prototype.warn=function(logObject){return this.log(4e3,logObject)},Logger.prototype.error=function(logObject){return this.log(5e3,logObject)},Logger.prototype.fatal=function(logObject){return this.log(6e3,logObject)},Logger.prototype.fatalException=function(logObject,e){return this.log(6e3,logObject,e)},Logger}();JL.Logger=Logger,JL.createAjaxAppender=function createAjaxAppender(appenderName){return new AjaxAppender(appenderName)},JL.createConsoleAppender=function createConsoleAppender(appenderName){return new ConsoleAppender(appenderName)},defaultAppender="undefined"!=typeof window?new AjaxAppender(""):new ConsoleAppender(""),JL.__=new JL.Logger(""),JL.__.setOptions({level:JL.getDebugLevel(),appenders:[defaultAppender]})}(JL||(JL={})),exports.__esModule=!0,exports.JL=JL,"function"==typeof __jsnlog_configure&&__jsnlog_configure(JL),"undefined"==typeof window||window.onerror||(window.onerror=function(errorMsg,url,lineNumber,column,errorObj){return JL("onerrorLogger").fatalException({msg:"Uncaught Exception",errorMsg:errorMsg?errorMsg.message||errorMsg:"",url:url,"line number":lineNumber,column:column},errorObj),!1}),"undefined"==typeof window||window.onunhandledrejection||(window.onunhandledrejection=function(event){JL("onerrorLogger").fatalException({msg:"unhandledrejection",errorMsg:event.reason?event.reason.message:event.message||null},event.reason)})},1090:function(module,exports,__webpack_require__){(function(module,global){var __WEBPACK_AMD_DEFINE_RESULT__;(function(){"use strict";var objectTypes={function:!0,object:!0},root=objectTypes[typeof window]&&window||this,freeExports=objectTypes[typeof exports]&&exports,freeModule=objectTypes[typeof module]&&module&&!module.nodeType&&module,freeGlobal=freeExports&&freeModule&&"object"==typeof global&&global;!freeGlobal||freeGlobal.global!==freeGlobal&&freeGlobal.window!==freeGlobal&&freeGlobal.self!==freeGlobal||(root=freeGlobal);var maxSafeInteger=Math.pow(2,53)-1,reOpera=/\bOpera/,objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty,toString=objectProto.toString;function capitalize(string){return(string=String(string)).charAt(0).toUpperCase()+string.slice(1)}function format(string){return string=trim(string),/^(?:webOS|i(?:OS|P))/.test(string)?string:capitalize(string)}function forOwn(object,callback){for(var key in object)hasOwnProperty.call(object,key)&&callback(object[key],key,object)}function getClassOf(value){return null==value?capitalize(value):toString.call(value).slice(8,-1)}function qualify(string){return String(string).replace(/([ -])(?!$)/g,"$1?")}function reduce(array,callback){var accumulator=null;return function each(object,callback){var index=-1,length=object?object.length:0;if("number"==typeof length&&length>-1&&length<=maxSafeInteger)for(;++index<length;)callback(object[index],index,object);else forOwn(object,callback)}(array,(function(value,index){accumulator=callback(accumulator,value,index,array)})),accumulator}function trim(string){return String(string).replace(/^ +| +$/g,"")}var platform=function parse(ua){var context=root,isCustomContext=ua&&"object"==typeof ua&&"String"!=getClassOf(ua);isCustomContext&&(context=ua,ua=null);var nav=context.navigator||{},userAgent=nav.userAgent||"";ua||(ua=userAgent);var data,isSpecialCasedOS,likeChrome=isCustomContext?!!nav.likeChrome:/\bChrome\b/.test(ua)&&!/internal|\n/i.test(toString.toString()),airRuntimeClass=isCustomContext?"Object":"ScriptBridgingProxyObject",enviroClass=isCustomContext?"Object":"Environment",javaClass=isCustomContext&&context.java?"JavaPackage":getClassOf(context.java),phantomClass=isCustomContext?"Object":"RuntimeObject",java=/\bJava/.test(javaClass)&&context.java,rhino=java&&getClassOf(context.environment)==enviroClass,alpha=java?"a":"α",beta=java?"b":"β",doc=context.document||{},opera=context.operamini||context.opera,operaClass=reOpera.test(operaClass=isCustomContext&&opera?opera["[[Class]]"]:getClassOf(opera))?operaClass:opera=null,arch=ua,description=[],prerelease=null,useFeatures=ua==userAgent,version=useFeatures&&opera&&"function"==typeof opera.version&&opera.version(),layout=function getLayout(guesses){return reduce(guesses,(function(result,guess){return result||RegExp("\\b"+(guess.pattern||qualify(guess))+"\\b","i").exec(ua)&&(guess.label||guess)}))}([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"]),name=function getName(guesses){return reduce(guesses,(function(result,guess){return result||RegExp("\\b"+(guess.pattern||qualify(guess))+"\\b","i").exec(ua)&&(guess.label||guess)}))}(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"(?:Edge|Edg|EdgA|EdgiOS)"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Vivaldi","Waterfox","WebPositive",{label:"Yandex Browser",pattern:"YaBrowser"},{label:"UC Browser",pattern:"UCBrowser"},"Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chromium","Chrome",{label:"Chrome",pattern:"(?:HeadlessChrome)"},{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),product=getProduct([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),manufacturer=function getManufacturer(guesses){return reduce(guesses,(function(result,value,key){return result||(value[product]||value[/^[a-z]+(?: +[a-z]+\b)*/i.exec(product)]||RegExp("\\b"+qualify(key)+"(?:\\b|\\w*\\d)","i").exec(ua))&&key}))}({Apple:{iPad:1,iPhone:1,iPod:1},Alcatel:{},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},Huawei:{},Lenovo:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Oppo:{},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1},Xiaomi:{Mi:1,Redmi:1}}),os=function getOS(guesses){return reduce(guesses,(function(result,guess){var pattern=guess.pattern||qualify(guess);return!result&&(result=RegExp("\\b"+pattern+"(?:/[\\d.]+|[ \\w.]*)","i").exec(ua))&&(result=function cleanupOS(os,pattern,label){var data={"10.0":"10",6.4:"10 Technical Preview",6.3:"8.1",6.2:"8",6.1:"Server 2008 R2 / 7","6.0":"Server 2008 / Vista",5.2:"Server 2003 / XP 64-bit",5.1:"XP",5.01:"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};return pattern&&label&&/^Win/i.test(os)&&!/^Windows Phone /i.test(os)&&(data=data[/[\d.]+$/.exec(os)])&&(os="Windows "+data),os=String(os),pattern&&label&&(os=os.replace(RegExp(pattern,"i"),label)),format(os.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])}(result,pattern,guess.label||guess)),result}))}(["Windows Phone","KaiOS","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian",{label:"DragonFly BSD",pattern:"DragonFly"},"Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "]);function getProduct(guesses){return reduce(guesses,(function(result,guess){var pattern=guess.pattern||qualify(guess);return!result&&(result=RegExp("\\b"+pattern+" *\\d+[.\\w_]*","i").exec(ua)||RegExp("\\b"+pattern+" *\\w+-[\\w]*","i").exec(ua)||RegExp("\\b"+pattern+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(ua))&&((result=String(guess.label&&!RegExp(pattern,"i").test(guess.label)?guess.label:result).split("/"))[1]&&!/[\d.]+/.test(result[0])&&(result[0]+=" "+result[1]),guess=guess.label||guess,result=format(result[0].replace(RegExp(pattern,"i"),guess).replace(RegExp("; *(?:"+guess+"[_-])?","i")," ").replace(RegExp("("+guess+")[-_.]?(\\w)","i"),"$1 $2"))),result}))}function getVersion(patterns){return reduce(patterns,(function(result,pattern){return result||(RegExp(pattern+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(ua)||0)[1]||null}))}if(layout&&(layout=[layout]),/\bAndroid\b/.test(os)&&!product&&(data=/\bAndroid[^;]*;(.*?)(?:Build|\) AppleWebKit)\b/i.exec(ua))&&(product=trim(data[1]).replace(/^[a-z]{2}-[a-z]{2};\s*/i,"")||null),manufacturer&&!product?product=getProduct([manufacturer]):manufacturer&&product&&(product=product.replace(RegExp("^("+qualify(manufacturer)+")[-_.\\s]","i"),manufacturer+" ").replace(RegExp("^("+qualify(manufacturer)+")[-_.]?(\\w)","i"),manufacturer+" $2")),(data=/\bGoogle TV\b/.exec(product))&&(product=data[0]),/\bSimulator\b/i.test(ua)&&(product=(product?product+" ":"")+"Simulator"),"Opera Mini"==name&&/\bOPiOS\b/.test(ua)&&description.push("running in Turbo/Uncompressed mode"),"IE"==name&&/\blike iPhone OS\b/.test(ua)?(manufacturer=(data=parse(ua.replace(/like iPhone OS/,""))).manufacturer,product=data.product):/^iP/.test(product)?(name||(name="Safari"),os="iOS"+((data=/ OS ([\d_]+)/i.exec(ua))?" "+data[1].replace(/_/g,"."):"")):"Konqueror"==name&&/^Linux\b/i.test(os)?os="Kubuntu":manufacturer&&"Google"!=manufacturer&&(/Chrome/.test(name)&&!/\bMobile Safari\b/i.test(ua)||/\bVita\b/.test(product))||/\bAndroid\b/.test(os)&&/^Chrome/.test(name)&&/\bVersion\//i.test(ua)?(name="Android Browser",os=/\bAndroid\b/.test(os)?os:"Android"):"Silk"==name?(/\bMobi/i.test(ua)||(os="Android",description.unshift("desktop mode")),/Accelerated *= *true/i.test(ua)&&description.unshift("accelerated")):"UC Browser"==name&&/\bUCWEB\b/.test(ua)?description.push("speed mode"):"PaleMoon"==name&&(data=/\bFirefox\/([\d.]+)\b/.exec(ua))?description.push("identifying as Firefox "+data[1]):"Firefox"==name&&(data=/\b(Mobile|Tablet|TV)\b/i.exec(ua))?(os||(os="Firefox OS"),product||(product=data[1])):!name||(data=!/\bMinefield\b/i.test(ua)&&/\b(?:Firefox|Safari)\b/.exec(name))?(name&&!product&&/[\/,]|^[^(]+?\)/.test(ua.slice(ua.indexOf(data+"/")+8))&&(name=null),(data=product||manufacturer||os)&&(product||manufacturer||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(os))&&(name=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(os)?os:data)+" Browser")):"Electron"==name&&(data=(/\bChrome\/([\d.]+)\b/.exec(ua)||0)[1])&&description.push("Chromium "+data),version||(version=getVersion(["(?:Cloud9|CriOS|CrMo|Edge|Edg|EdgA|EdgiOS|FxiOS|HeadlessChrome|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$)|UCBrowser|YaBrowser)","Version",qualify(name),"(?:Firefox|Minefield|NetFront)"])),(data=("iCab"==layout&&parseFloat(version)>3?"WebKit":/\bOpera\b/.test(name)&&(/\bOPR\b/.test(ua)?"Blink":"Presto"))||/\b(?:Midori|Nook|Safari)\b/i.test(ua)&&!/^(?:Trident|EdgeHTML)$/.test(layout)&&"WebKit"||!layout&&/\bMSIE\b/i.test(ua)&&("Mac OS"==os?"Tasman":"Trident")||"WebKit"==layout&&/\bPlayStation\b(?! Vita\b)/i.test(name)&&"NetFront")&&(layout=[data]),"IE"==name&&(data=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(ua)||0)[1])?(name+=" Mobile",os="Windows Phone "+(/\+$/.test(data)?data:data+".x"),description.unshift("desktop mode")):/\bWPDesktop\b/i.test(ua)?(name="IE Mobile",os="Windows Phone 8.x",description.unshift("desktop mode"),version||(version=(/\brv:([\d.]+)/.exec(ua)||0)[1])):"IE"!=name&&"Trident"==layout&&(data=/\brv:([\d.]+)/.exec(ua))&&(name&&description.push("identifying as "+name+(version?" "+version:"")),name="IE",version=data[1]),useFeatures){if(function isHostType(object,property){var type=null!=object?typeof object[property]:"number";return!(/^(?:boolean|number|string|undefined)$/.test(type)||"object"==type&&!object[property])}(context,"global"))if(java&&(arch=(data=java.lang.System).getProperty("os.arch"),os=os||data.getProperty("os.name")+" "+data.getProperty("os.version")),rhino){try{version=context.require("ringo/engine").version.join("."),name="RingoJS"}catch(e){(data=context.system)&&data.global.system==context.system&&(name="Narwhal",os||(os=data[0].os||null))}name||(name="Rhino")}else"object"==typeof context.process&&!context.process.browser&&(data=context.process)&&("object"==typeof data.versions&&("string"==typeof data.versions.electron?(description.push("Node "+data.versions.node),name="Electron",version=data.versions.electron):"string"==typeof data.versions.nw&&(description.push("Chromium "+version,"Node "+data.versions.node),name="NW.js",version=data.versions.nw)),name||(name="Node.js",arch=data.arch,os=data.platform,version=(version=/[\d.]+/.exec(data.version))?version[0]:null));else getClassOf(data=context.runtime)==airRuntimeClass?(name="Adobe AIR",os=data.flash.system.Capabilities.os):getClassOf(data=context.phantom)==phantomClass?(name="PhantomJS",version=(data=data.version||null)&&data.major+"."+data.minor+"."+data.patch):"number"==typeof doc.documentMode&&(data=/\bTrident\/(\d+)/i.exec(ua))?(version=[version,doc.documentMode],(data=+data[1]+4)!=version[1]&&(description.push("IE "+version[1]+" mode"),layout&&(layout[1]=""),version[1]=data),version="IE"==name?String(version[1].toFixed(1)):version[0]):"number"==typeof doc.documentMode&&/^(?:Chrome|Firefox)\b/.test(name)&&(description.push("masking as "+name+" "+version),name="IE",version="11.0",layout=["Trident"],os="Windows");os=os&&format(os)}if(version&&(data=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(version)||/(?:alpha|beta)(?: ?\d)?/i.exec(ua+";"+(useFeatures&&nav.appMinorVersion))||/\bMinefield\b/i.test(ua)&&"a")&&(prerelease=/b/i.test(data)?"beta":"alpha",version=version.replace(RegExp(data+"\\+?$"),"")+("beta"==prerelease?beta:alpha)+(/\d+\+?/.exec(data)||"")),"Fennec"==name||"Firefox"==name&&/\b(?:Android|Firefox OS|KaiOS)\b/.test(os))name="Firefox Mobile";else if("Maxthon"==name&&version)version=version.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(product))"Xbox 360"==product&&(os=null),"Xbox 360"==product&&/\bIEMobile\b/.test(ua)&&description.unshift("mobile mode");else if(!/^(?:Chrome|IE|Opera)$/.test(name)&&(!name||product||/Browser|Mobi/.test(name))||"Windows CE"!=os&&!/Mobi/i.test(ua))if("IE"==name&&useFeatures)try{null===context.external&&description.unshift("platform preview")}catch(e){description.unshift("embedded")}else(/\bBlackBerry\b/.test(product)||/\bBB10\b/.test(ua))&&(data=(RegExp(product.replace(/ +/g," *")+"/([.\\d]+)","i").exec(ua)||0)[1]||version)?(os=((data=[data,/BB10/.test(ua)])[1]?(product=null,manufacturer="BlackBerry"):"Device Software")+" "+data[0],version=null):this!=forOwn&&"Wii"!=product&&(useFeatures&&opera||/Opera/.test(name)&&/\b(?:MSIE|Firefox)\b/i.test(ua)||"Firefox"==name&&/\bOS X (?:\d+\.){2,}/.test(os)||"IE"==name&&(os&&!/^Win/.test(os)&&version>5.5||/\bWindows XP\b/.test(os)&&version>8||8==version&&!/\bTrident\b/.test(ua)))&&!reOpera.test(data=parse.call(forOwn,ua.replace(reOpera,"")+";"))&&data.name&&(data="ing as "+data.name+((data=data.version)?" "+data:""),reOpera.test(name)?(/\bIE\b/.test(data)&&"Mac OS"==os&&(os=null),data="identify"+data):(data="mask"+data,name=operaClass?format(operaClass.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(data)&&(os=null),useFeatures||(version=null)),layout=["Presto"],description.push(data));else name+=" Mobile";(data=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(ua)||0)[1])&&(data=[parseFloat(data.replace(/\.(\d)$/,".0$1")),data],"Safari"==name&&"+"==data[1].slice(-1)?(name="WebKit Nightly",prerelease="alpha",version=data[1].slice(0,-1)):version!=data[1]&&version!=(data[2]=(/\bSafari\/([\d.]+\+?)/i.exec(ua)||0)[1])||(version=null),data[1]=(/\b(?:Headless)?Chrome\/([\d.]+)/i.exec(ua)||0)[1],537.36==data[0]&&537.36==data[2]&&parseFloat(data[1])>=28&&"WebKit"==layout&&(layout=["Blink"]),useFeatures&&(likeChrome||data[1])?(layout&&(layout[1]="like Chrome"),data=data[1]||((data=data[0])<530?1:data<532?2:data<532.05?3:data<533?4:data<534.03?5:data<534.07?6:data<534.1?7:data<534.13?8:data<534.16?9:data<534.24?10:data<534.3?11:data<535.01?12:data<535.02?"13+":data<535.07?15:data<535.11?16:data<535.19?17:data<536.05?18:data<536.1?19:data<537.01?20:data<537.11?"21+":data<537.13?23:data<537.18?24:data<537.24?25:data<537.36?26:"Blink"!=layout?"27":"28")):(layout&&(layout[1]="like Safari"),data=(data=data[0])<400?1:data<500?2:data<526?3:data<533?4:data<534?"4+":data<535?5:data<537?6:data<538?7:data<601?8:data<602?9:data<604?10:data<606?11:data<608?12:"12"),layout&&(layout[1]+=" "+(data+="number"==typeof data?".x":/[.+]/.test(data)?"":"+")),"Safari"==name&&(!version||parseInt(version)>45)?version=data:"Chrome"==name&&/\bHeadlessChrome/i.test(ua)&&description.unshift("headless")),"Opera"==name&&(data=/\bzbov|zvav$/.exec(os))?(name+=" ",description.unshift("desktop mode"),"zvav"==data?(name+="Mini",version=null):name+="Mobile",os=os.replace(RegExp(" *"+data+"$"),"")):"Safari"==name&&/\bChrome\b/.exec(layout&&layout[1])?(description.unshift("desktop mode"),name="Chrome Mobile",version=null,/\bOS X\b/.test(os)?(manufacturer="Apple",os="iOS 4.3+"):os=null):/\bSRWare Iron\b/.test(name)&&!version&&(version=getVersion("Chrome")),version&&0==version.indexOf(data=/[\d.]+$/.exec(os))&&ua.indexOf("/"+data+"-")>-1&&(os=trim(os.replace(data,""))),os&&-1!=os.indexOf(name)&&!RegExp(name+" OS").test(os)&&(os=os.replace(RegExp(" *"+qualify(name)+" *"),"")),layout&&!/\b(?:Avant|Nook)\b/.test(name)&&(/Browser|Lunascape|Maxthon/.test(name)||"Safari"!=name&&/^iOS/.test(os)&&/\bSafari\b/.test(layout[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|SRWare Iron|Vivaldi|Web)/.test(name)&&layout[1])&&(data=layout[layout.length-1])&&description.push(data),description.length&&(description=["("+description.join("; ")+")"]),manufacturer&&product&&product.indexOf(manufacturer)<0&&description.push("on "+manufacturer),product&&description.push((/^on /.test(description[description.length-1])?"":"on ")+product),os&&(data=/ ([\d.+]+)$/.exec(os),isSpecialCasedOS=data&&"/"==os.charAt(os.length-data[0].length-1),os={architecture:32,family:data&&!isSpecialCasedOS?os.replace(data[0],""):os,version:data?data[1]:null,toString:function(){var version=this.version;return this.family+(version&&!isSpecialCasedOS?" "+version:"")+(64==this.architecture?" 64-bit":"")}}),(data=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(arch))&&!/\bi686\b/i.test(arch)?(os&&(os.architecture=64,os.family=os.family.replace(RegExp(" *"+data),"")),name&&(/\bWOW64\b/i.test(ua)||useFeatures&&/\w(?:86|32)$/.test(nav.cpuClass||nav.platform)&&!/\bWin64; x64\b/i.test(ua))&&description.unshift("32-bit")):os&&/^OS X/.test(os.family)&&"Chrome"==name&&parseFloat(version)>=39&&(os.architecture=64),ua||(ua=null);var platform={};return platform.description=ua,platform.layout=layout&&layout[0],platform.manufacturer=manufacturer,platform.name=name,platform.prerelease=prerelease,platform.product=product,platform.ua=ua,platform.version=name&&version,platform.os=os||{architecture:null,family:null,version:null,toString:function(){return"null"}},platform.parse=parse,platform.toString=function toStringPlatform(){return this.description||""},platform.version&&description.unshift(version),platform.name&&description.unshift(name),os&&name&&(os!=String(os).split(" ")[0]||os!=name.split(" ")[0]&&!product)&&description.push(product?"("+os+")":"on "+os),description.length&&(platform.description=description.join(" ")),platform}();root.platform=platform,void 0===(__WEBPACK_AMD_DEFINE_RESULT__=function(){return platform}.call(exports,__webpack_require__,exports,module))||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)}).call(this)}).call(this,__webpack_require__(208)(module),__webpack_require__(64))},1091:function(module,exports,__webpack_require__){"use strict";var extendStatics,__extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}),__awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},__generator=this&&this.__generator||function(thisArg,body){var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=_.trys,(t=t.length>0&&t[t.length-1])||6!==op[0]&&2!==op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}};exports.__esModule=!0,exports.WebRtcPeerSendrecv=exports.WebRtcPeerSendonly=exports.WebRtcPeerRecvonly=exports.WebRtcPeer=void 0;var freeice=__webpack_require__(1092),uuid_1=__webpack_require__(1111),ExceptionEvent_1=__webpack_require__(998),OpenViduLogger_1=__webpack_require__(992),Platform_1=__webpack_require__(994),logger=OpenViduLogger_1.OpenViduLogger.getInstance(),WebRtcPeer=function(){function WebRtcPeer(configuration){var _this=this;this.configuration=configuration,this.remoteCandidatesQueue=[],this.localCandidatesQueue=[],this.iceCandidateList=[],Platform_1.PlatformUtils.getInstance(),this.configuration.iceServers=this.configuration.iceServers&&this.configuration.iceServers.length>0?this.configuration.iceServers:freeice(),this.pc=new RTCPeerConnection({iceServers:this.configuration.iceServers}),this.id=configuration.id?configuration.id:this.generateUniqueId(),this.pc.addEventListener("icecandidate",(function(event){if(null!=event.candidate){var candidate=event.candidate;_this.configuration.onIceCandidate(candidate),""!==candidate.candidate&&_this.localCandidatesQueue.push({candidate:candidate.candidate})}})),this.pc.addEventListener("signalingstatechange",(function(){if("stable"===_this.pc.signalingState)for(;_this.iceCandidateList.length>0;){var candidate=_this.iceCandidateList.shift();_this.pc.addIceCandidate(candidate)}})),this.start()}return WebRtcPeer.prototype.start=function(){var _this=this;return new Promise((function(resolve,reject){if("closed"===_this.pc.signalingState&&reject('The peer connection object is in "closed" state. This is most likely due to an invocation of the dispose method before accepting in the dialogue'),_this.configuration.mediaStream){for(var _i=0,_a=_this.configuration.mediaStream.getTracks();_i<_a.length;_i++){var track=_a[_i];_this.pc.addTrack(track,_this.configuration.mediaStream)}resolve()}}))},WebRtcPeer.prototype.dispose=function(){if(logger.debug("Disposing WebRtcPeer"),this.pc){if("closed"===this.pc.signalingState)return;this.pc.close(),this.remoteCandidatesQueue=[],this.localCandidatesQueue=[]}},WebRtcPeer.prototype.createOffer=function(){var _this=this;return new Promise((function(resolve,reject){var offerAudio,offerVideo=!0;if(_this.configuration.mediaConstraints&&(offerAudio="boolean"!=typeof _this.configuration.mediaConstraints.audio||_this.configuration.mediaConstraints.audio,offerVideo="boolean"!=typeof _this.configuration.mediaConstraints.video||_this.configuration.mediaConstraints.video),"function"==typeof _this.pc.addTransceiver)logger.debug("Unified Plan supported"),offerAudio&&_this.pc.addTransceiver("audio",{direction:_this.configuration.mode}),offerVideo&&_this.pc.addTransceiver("video",{direction:_this.configuration.mode}),_this.pc.createOffer().then((function(offer){logger.debug("Created SDP offer"),resolve(offer)})).catch((function(error){return reject(error)}));else{var constraints={offerToReceiveAudio:"sendonly"!==_this.configuration.mode&&offerAudio,offerToReceiveVideo:"sendonly"!==_this.configuration.mode&&offerVideo};logger.debug("Unified Plan not supported. Using Plan B. RTCPeerConnection constraints: "+JSON.stringify(constraints)),_this.pc.createOffer(constraints).then((function(offer){logger.debug("Created SDP offer"),resolve(offer)})).catch((function(error){return reject(error)}))}}))},WebRtcPeer.prototype.createAnswer=function(){var _this=this;return new Promise((function(resolve,reject){var offerAudio,offerVideo=!0;_this.configuration.mediaConstraints&&(offerAudio="boolean"!=typeof _this.configuration.mediaConstraints.audio||_this.configuration.mediaConstraints.audio,offerVideo="boolean"!=typeof _this.configuration.mediaConstraints.video||_this.configuration.mediaConstraints.video);var constraints={offerToReceiveAudio:offerAudio,offerToReceiveVideo:offerVideo};_this.pc.createAnswer(constraints).then((function(sdpAnswer){resolve(sdpAnswer)})).catch((function(error){reject(error)}))}))},WebRtcPeer.prototype.processLocalOffer=function(offer){var _this=this;return new Promise((function(resolve,reject){_this.pc.setLocalDescription(offer).then((function(){var localDescription=_this.pc.localDescription;localDescription?(logger.debug("Local description set",localDescription.sdp),resolve()):reject("Local description is not defined")})).catch((function(error){reject(error)}))}))},WebRtcPeer.prototype.processRemoteOffer=function(sdpOffer){var _this=this;return new Promise((function(resolve,reject){var offer={type:"offer",sdp:sdpOffer};logger.debug("SDP offer received, setting remote description",offer),"closed"===_this.pc.signalingState&&reject("RTCPeerConnection is closed when trying to set remote description"),_this.setRemoteDescription(offer).then((function(){resolve()})).catch((function(error){reject(error)}))}))},WebRtcPeer.prototype.processLocalAnswer=function(answer){var _this=this;return new Promise((function(resolve,reject){logger.debug("SDP answer created, setting local description"),"closed"===_this.pc.signalingState&&reject("RTCPeerConnection is closed when trying to set local description"),_this.pc.setLocalDescription(answer).then((function(){return resolve()})).catch((function(error){return reject(error)}))}))},WebRtcPeer.prototype.processRemoteAnswer=function(sdpAnswer){var _this=this;return new Promise((function(resolve,reject){var answer={type:"answer",sdp:sdpAnswer};logger.debug("SDP answer received, setting remote description"),"closed"===_this.pc.signalingState&&reject("RTCPeerConnection is closed when trying to set remote description"),_this.setRemoteDescription(answer).then((function(){return resolve()})).catch((function(error){return reject(error)}))}))},WebRtcPeer.prototype.setRemoteDescription=function(sdp){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(_a){return[2,this.pc.setRemoteDescription(sdp)]}))}))},WebRtcPeer.prototype.addIceCandidate=function(iceCandidate){var _this=this;return new Promise((function(resolve,reject){switch(logger.debug("Remote ICE candidate received",iceCandidate),_this.remoteCandidatesQueue.push(iceCandidate),_this.pc.signalingState){case"closed":reject(new Error("PeerConnection object is closed"));break;case"stable":_this.pc.remoteDescription?_this.pc.addIceCandidate(iceCandidate).then((function(){return resolve()})).catch((function(error){return reject(error)})):(_this.iceCandidateList.push(iceCandidate),resolve());break;default:_this.iceCandidateList.push(iceCandidate),resolve()}}))},WebRtcPeer.prototype.addIceConnectionStateChangeListener=function(otherId){var _this=this;this.pc.addEventListener("iceconnectionstatechange",(function(){switch(_this.pc.iceConnectionState){case"disconnected":var msg1="IceConnectionState of RTCPeerConnection "+_this.id+" ("+otherId+') change to "disconnected". Possible network disconnection';logger.warn(msg1),_this.configuration.onIceConnectionStateException(ExceptionEvent_1.ExceptionEventName.ICE_CONNECTION_DISCONNECTED,msg1);break;case"failed":var msg2="IceConnectionState of RTCPeerConnection "+_this.id+" ("+otherId+') to "failed"';logger.error(msg2),_this.configuration.onIceConnectionStateException(ExceptionEvent_1.ExceptionEventName.ICE_CONNECTION_FAILED,msg2);break;case"closed":logger.log("IceConnectionState of RTCPeerConnection "+_this.id+" ("+otherId+') change to "closed"');break;case"new":logger.log("IceConnectionState of RTCPeerConnection "+_this.id+" ("+otherId+') change to "new"');break;case"checking":logger.log("IceConnectionState of RTCPeerConnection "+_this.id+" ("+otherId+') change to "checking"');break;case"connected":logger.log("IceConnectionState of RTCPeerConnection "+_this.id+" ("+otherId+') change to "connected"');break;case"completed":logger.log("IceConnectionState of RTCPeerConnection "+_this.id+" ("+otherId+') change to "completed"')}}))},WebRtcPeer.prototype.generateUniqueId=function(){return uuid_1.v4()},WebRtcPeer}();exports.WebRtcPeer=WebRtcPeer;var WebRtcPeerRecvonly=function(_super){function WebRtcPeerRecvonly(configuration){return configuration.mode="recvonly",_super.call(this,configuration)||this}return __extends(WebRtcPeerRecvonly,_super),WebRtcPeerRecvonly}(WebRtcPeer);exports.WebRtcPeerRecvonly=WebRtcPeerRecvonly;var WebRtcPeerSendonly=function(_super){function WebRtcPeerSendonly(configuration){return configuration.mode="sendonly",_super.call(this,configuration)||this}return __extends(WebRtcPeerSendonly,_super),WebRtcPeerSendonly}(WebRtcPeer);exports.WebRtcPeerSendonly=WebRtcPeerSendonly;var WebRtcPeerSendrecv=function(_super){function WebRtcPeerSendrecv(configuration){return configuration.mode="sendrecv",_super.call(this,configuration)||this}return __extends(WebRtcPeerSendrecv,_super),WebRtcPeerSendrecv}(WebRtcPeer);exports.WebRtcPeerSendrecv=WebRtcPeerSendrecv},1092:function(module,exports,__webpack_require__){"use strict";var normalice=__webpack_require__(1093);module.exports=function(opts){var selected,servers={stun:(opts||{}).stun||__webpack_require__(1094),turn:(opts||{}).turn||__webpack_require__(1095)},stunCount=(opts||{}).stunCount||2,turnCount=(opts||{}).turnCount||0;function getServers(type,count){for(var idx,out=[],input=[].concat(servers[type]);input.length&&out.length<count;)idx=Math.random()*input.length|0,out=out.concat(input.splice(idx,1));return out.map((function(url){return"string"==typeof url||url instanceof String?normalice(type+":"+url):url}))}return selected=[].concat(getServers("stun",stunCount)),turnCount&&(selected=selected.concat(getServers("turn",turnCount))),selected}},1093:function(module,exports){var protocols=["stun:","turn:"];module.exports=function(input){var protocol,parts,url=(input||{}).url||input,output={};return"string"==typeof url||url instanceof String?(url=url.trim(),(protocol=protocols[protocols.indexOf(url.slice(0,5))])?(parts=(url=url.slice(5)).split("@"),output.username=input.username,output.credential=input.credential,parts.length>1&&(url=parts[1],parts=parts[0].split(":"),output.username=parts[0],output.credential=(input||{}).credential||parts[1]||""),output.url=protocol+url,output.urls=[output.url],output):input):input}},1094:function(module){module.exports=JSON.parse('["stun.l.google.com:19302","stun1.l.google.com:19302","stun2.l.google.com:19302","stun3.l.google.com:19302","stun4.l.google.com:19302","stun.ekiga.net","stun.ideasip.com","stun.schlund.de","stun.stunprotocol.org:3478","stun.voiparound.com","stun.voipbuster.com","stun.voipstunt.com","stun.voxgratia.org"]')},1095:function(module){module.exports=JSON.parse("[]")},1096:function(module,exports,__webpack_require__){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},__generator=this&&this.__generator||function(thisArg,body){var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=_.trys,(t=t.length>0&&t[t.length-1])||6!==op[0]&&2!==op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}};exports.__esModule=!0,exports.WebRtcStats=void 0;var platform,OpenViduLogger_1=__webpack_require__(992),Platform_1=__webpack_require__(994),logger=OpenViduLogger_1.OpenViduLogger.getInstance(),WebRtcStats=function(){function WebRtcStats(stream){this.stream=stream,this.STATS_ITEM_NAME="webrtc-stats-config",this.webRtcStatsEnabled=!1,this.statsInterval=1,platform=Platform_1.PlatformUtils.getInstance()}return WebRtcStats.prototype.isEnabled=function(){return this.webRtcStatsEnabled},WebRtcStats.prototype.initWebRtcStats=function(){var _this=this,webrtcObj=localStorage.getItem(this.STATS_ITEM_NAME);if(webrtcObj){this.webRtcStatsEnabled=!0;var webrtcStatsConfig=JSON.parse(webrtcObj);logger.warn("WebRtc stats enabled for stream "+this.stream.streamId+" of connection "+this.stream.connection.connectionId),logger.warn("localStorage item: "+JSON.stringify(webrtcStatsConfig)),this.POST_URL=webrtcStatsConfig.httpEndpoint,this.statsInterval=webrtcStatsConfig.interval,this.webRtcStatsIntervalId=setInterval((function(){return __awaiter(_this,void 0,void 0,(function(){return __generator(this,(function(_a){switch(_a.label){case 0:return[4,this.sendStatsToHttpEndpoint()];case 1:return _a.sent(),[2]}}))}))}),1e3*this.statsInterval)}else logger.debug("WebRtc stats not enabled")},WebRtcStats.prototype.getSelectedIceCandidateInfo=function(){var _this=this;return new Promise((function(resolve,reject){return __awaiter(_this,void 0,void 0,(function(){var statsReport,transportStat,candidatePairs,localCandidates,remoteCandidates,selectedCandidatePair,selectedCandidatePairId,length_1,iterator,i,candidatePair,localCandidateId,remoteCandidateId,finalLocalCandidate,_i,cand_1,finalRemoteCandidate,candList,cand,_a,cand_2,c;return __generator(this,(function(_b){switch(_b.label){case 0:return[4,this.stream.getRTCPeerConnection().getStats()];case 1:if(statsReport=_b.sent(),candidatePairs=new Map,localCandidates=new Map,remoteCandidates=new Map,statsReport.forEach((function(stat){switch("transport"===stat.type&&(platform.isChromium()||platform.isSafariBrowser()||platform.isReactNative())&&(transportStat=stat),stat.type){case"candidate-pair":candidatePairs.set(stat.id,stat);break;case"local-candidate":localCandidates.set(stat.id,stat);break;case"remote-candidate":remoteCandidates.set(stat.id,stat)}})),null!=transportStat)selectedCandidatePairId=transportStat.selectedCandidatePairId,selectedCandidatePair=candidatePairs.get(selectedCandidatePairId);else for(length_1=candidatePairs.size,iterator=candidatePairs.values(),i=0;i<length_1;i++)if((candidatePair=iterator.next().value).selected){selectedCandidatePair=candidatePair;break}if(localCandidateId=selectedCandidatePair.localCandidateId,remoteCandidateId=selectedCandidatePair.remoteCandidateId,finalLocalCandidate=localCandidates.get(localCandidateId))for(candList=this.stream.getLocalIceCandidateList(),cand=candList.filter((function(c){return!!c.candidate&&(c.candidate.indexOf(finalLocalCandidate.ip)>=0||c.candidate.indexOf(finalLocalCandidate.address)>=0)&&c.candidate.indexOf(finalLocalCandidate.port)>=0})),finalLocalCandidate.raw=[],_i=0,cand_1=cand;_i<cand_1.length;_i++)c=cand_1[_i],finalLocalCandidate.raw.push(c.candidate);else finalLocalCandidate="ERROR: No active local ICE candidate. Probably ICE-TCP is being used";if(finalRemoteCandidate=remoteCandidates.get(remoteCandidateId))for(candList=this.stream.getRemoteIceCandidateList(),cand=candList.filter((function(c){return!!c.candidate&&(c.candidate.indexOf(finalRemoteCandidate.ip)>=0||c.candidate.indexOf(finalRemoteCandidate.address)>=0)&&c.candidate.indexOf(finalRemoteCandidate.port)>=0})),finalRemoteCandidate.raw=[],_a=0,cand_2=cand;_a<cand_2.length;_a++)c=cand_2[_a],finalRemoteCandidate.raw.push(c.candidate);else finalRemoteCandidate="ERROR: No active remote ICE candidate. Probably ICE-TCP is being used";return resolve({localCandidate:finalLocalCandidate,remoteCandidate:finalRemoteCandidate}),[2]}}))}))}))},WebRtcStats.prototype.stopWebRtcStats=function(){this.webRtcStatsEnabled&&(clearInterval(this.webRtcStatsIntervalId),logger.warn("WebRtc stats stopped for disposed stream "+this.stream.streamId+" of connection "+this.stream.connection.connectionId))},WebRtcStats.prototype.sendStats=function(url,response){return __awaiter(this,void 0,void 0,(function(){var configuration,error_1;return __generator(this,(function(_a){switch(_a.label){case 0:return _a.trys.push([0,2,,3]),configuration={headers:{"Content-type":"application/json"},body:JSON.stringify(response),method:"POST"},[4,fetch(url,configuration)];case 1:return _a.sent(),[3,3];case 2:return error_1=_a.sent(),logger.error(error_1),[3,3];case 3:return[2]}}))}))},WebRtcStats.prototype.sendStatsToHttpEndpoint=function(){return __awaiter(this,void 0,void 0,(function(){var webrtcStats,response,error_2;return __generator(this,(function(_a){switch(_a.label){case 0:return _a.trys.push([0,3,,4]),[4,this.getCommonStats()];case 1:return webrtcStats=_a.sent(),response=this.generateJSONStatsResponse(webrtcStats),[4,this.sendStats(this.POST_URL,response)];case 2:return _a.sent(),[3,4];case 3:return error_2=_a.sent(),logger.log(error_2),[3,4];case 4:return[2]}}))}))},WebRtcStats.prototype.getCommonStats=function(){return __awaiter(this,void 0,void 0,(function(){var _this=this;return __generator(this,(function(_a){return[2,new Promise((function(resolve,reject){return __awaiter(_this,void 0,void 0,(function(){var statsReport,response,videoTrackStats,_this=this;return __generator(this,(function(_a){switch(_a.label){case 0:return[4,this.stream.getRTCPeerConnection().getStats()];case 1:return statsReport=_a.sent(),response=this.getWebRtcStatsResponseOutline(),videoTrackStats=["framesReceived","framesDropped","framesSent","frameHeight","frameWidth"],statsReport.forEach((function(stat){var mediaType=null!=stat.mediaType?stat.mediaType:stat.kind,addStat=function(direction,key){null!=stat[key]&&null!=response[direction]&&(!mediaType&&videoTrackStats.indexOf(key)>-1&&(mediaType="video"),null!=direction&&null!=mediaType&&null!=key&&null!=response[direction]&&null!=response[direction][mediaType]&&(response[direction][mediaType][key]=Number(stat[key])))};switch(stat.type){case"outbound-rtp":addStat("outbound","bytesSent"),addStat("outbound","packetsSent"),addStat("outbound","framesEncoded"),addStat("outbound","nackCount"),addStat("outbound","firCount"),addStat("outbound","pliCount"),addStat("outbound","qpSum");break;case"inbound-rtp":addStat("inbound","bytesReceived"),addStat("inbound","packetsReceived"),addStat("inbound","packetsLost"),addStat("inbound","jitter"),addStat("inbound","framesDecoded"),addStat("inbound","nackCount"),addStat("inbound","firCount"),addStat("inbound","pliCount");break;case"track":addStat("inbound","jitterBufferDelay"),addStat("inbound","framesReceived"),addStat("outbound","framesDropped"),addStat("outbound","framesSent"),addStat(_this.stream.isLocal()?"outbound":"inbound","frameHeight"),addStat(_this.stream.isLocal()?"outbound":"inbound","frameWidth")}})),[2,resolve(response)]}}))}))}))]}))}))},WebRtcStats.prototype.generateJSONStatsResponse=function(stats){return{"@timestamp":(new Date).toISOString(),participant_id:this.stream.connection.data,session_id:this.stream.session.sessionId,platform:platform.getName(),platform_description:platform.getDescription(),stream:"webRTC",webrtc_stats:stats}},WebRtcStats.prototype.getWebRtcStatsResponseOutline=function(){return this.stream.isLocal()?{outbound:{audio:{},video:{}}}:{inbound:{audio:{},video:{}}}},WebRtcStats}();exports.WebRtcStats=WebRtcStats},1097:function(module,exports,__webpack_require__){var audioContextType,WildEmitter=__webpack_require__(1098);"undefined"!=typeof window&&(audioContextType=window.AudioContext||window.webkitAudioContext);var audioContext=null;module.exports=function(stream,options){var harker=new WildEmitter;if(!audioContextType)return harker;var sourceNode,fftBins,analyser,smoothing=(options=options||{}).smoothing||.1,interval=options.interval||50,threshold=options.threshold,play=options.play,history=options.history||10,running=!0;audioContext=options.audioContext||audioContext||new audioContextType,(analyser=audioContext.createAnalyser()).fftSize=512,analyser.smoothingTimeConstant=smoothing,fftBins=new Float32Array(analyser.frequencyBinCount),stream.jquery&&(stream=stream[0]),stream instanceof HTMLAudioElement||stream instanceof HTMLVideoElement?(sourceNode=audioContext.createMediaElementSource(stream),void 0===play&&(play=!0),threshold=threshold||-50):(sourceNode=audioContext.createMediaStreamSource(stream),threshold=threshold||-50),sourceNode.connect(analyser),play&&analyser.connect(audioContext.destination),harker.speaking=!1,harker.suspend=function(){return audioContext.suspend()},harker.resume=function(){return audioContext.resume()},Object.defineProperty(harker,"state",{get:function(){return audioContext.state}}),audioContext.onstatechange=function(){harker.emit("state_change",audioContext.state)},harker.setThreshold=function(t){threshold=t},harker.setInterval=function(i){interval=i},harker.stop=function(){running=!1,harker.emit("volume_change",-100,threshold),harker.speaking&&(harker.speaking=!1,harker.emit("stopped_speaking")),analyser.disconnect(),sourceNode.disconnect()},harker.speakingHistory=[];for(var i=0;i<history;i++)harker.speakingHistory.push(0);var looper=function(){setTimeout((function(){if(running){var currentVolume=function getMaxVolume(analyser,fftBins){var maxVolume=-1/0;analyser.getFloatFrequencyData(fftBins);for(var i=4,ii=fftBins.length;i<ii;i++)fftBins[i]>maxVolume&&fftBins[i]<0&&(maxVolume=fftBins[i]);return maxVolume}(analyser,fftBins);harker.emit("volume_change",currentVolume,threshold);var history=0;if(currentVolume>threshold&&!harker.speaking){for(var i=harker.speakingHistory.length-3;i<harker.speakingHistory.length;i++)history+=harker.speakingHistory[i];history>=2&&(harker.speaking=!0,harker.emit("speaking"))}else if(currentVolume<threshold&&harker.speaking){for(i=0;i<harker.speakingHistory.length;i++)history+=harker.speakingHistory[i];0==history&&(harker.speaking=!1,harker.emit("stopped_speaking"))}harker.speakingHistory.shift(),harker.speakingHistory.push(0+(currentVolume>threshold)),looper()}}),interval)};return looper(),harker}},1098:function(module,exports){function WildEmitter(){}module.exports=WildEmitter,WildEmitter.mixin=function(constructor){var prototype=constructor.prototype||constructor;prototype.isWildEmitter=!0,prototype.on=function(event,groupName,fn){this.callbacks=this.callbacks||{};var hasGroup=3===arguments.length,group=hasGroup?arguments[1]:void 0,func=hasGroup?arguments[2]:arguments[1];return func._groupName=group,(this.callbacks[event]=this.callbacks[event]||[]).push(func),this},prototype.once=function(event,groupName,fn){var self=this,hasGroup=3===arguments.length,group=hasGroup?arguments[1]:void 0,func=hasGroup?arguments[2]:arguments[1];function on(){self.off(event,on),func.apply(this,arguments)}return this.on(event,group,on),this},prototype.releaseGroup=function(groupName){var item,i,len,handlers;for(item in this.callbacks=this.callbacks||{},this.callbacks)for(i=0,len=(handlers=this.callbacks[item]).length;i<len;i++)handlers[i]._groupName===groupName&&(handlers.splice(i,1),i--,len--);return this},prototype.off=function(event,fn){this.callbacks=this.callbacks||{};var i,callbacks=this.callbacks[event];return callbacks?1===arguments.length?(delete this.callbacks[event],this):(-1!==(i=callbacks.indexOf(fn))&&(callbacks.splice(i,1),0===callbacks.length&&delete this.callbacks[event]),this):this},prototype.emit=function(event){this.callbacks=this.callbacks||{};var i,len,listeners,args=[].slice.call(arguments,1),callbacks=this.callbacks[event],specialCallbacks=this.getWildcardCallbacks(event);if(callbacks)for(i=0,len=(listeners=callbacks.slice()).length;i<len&&listeners[i];++i)listeners[i].apply(this,args);if(specialCallbacks)for(len=specialCallbacks.length,i=0,len=(listeners=specialCallbacks.slice()).length;i<len&&listeners[i];++i)listeners[i].apply(this,[event].concat(args));return this},prototype.getWildcardCallbacks=function(eventName){this.callbacks=this.callbacks||{};var item,split,result=[];for(item in this.callbacks)split=item.split("*"),("*"===item||2===split.length&&eventName.slice(0,split[0].length)===split[0])&&(result=result.concat(this.callbacks[item]));return result}},WildEmitter.mixin(WildEmitter)},1099:function(module,exports){function getScreenConstraints(error,sourceId,canRequestAudioTrack){var screen_constraints={audio:!1,video:{mandatory:{chromeMediaSource:error?"screen":"desktop",maxWidth:window.screen.width>1920?window.screen.width:1920,maxHeight:window.screen.height>1080?window.screen.height:1080},optional:[]}};return canRequestAudioTrack&&(screen_constraints.audio={mandatory:{chromeMediaSource:error?"screen":"desktop"},optional:[]}),sourceId&&(screen_constraints.video.mandatory.chromeMediaSourceId=sourceId,screen_constraints.audio&&screen_constraints.audio.mandatory&&(screen_constraints.audio.mandatory.chromeMediaSourceId=sourceId)),screen_constraints}function postGetSourceIdMessage(custom_parameter){iframe?iframe.isLoaded?custom_parameter?custom_parameter.forEach?iframe.contentWindow.postMessage({captureCustomSourceId:custom_parameter},"*"):iframe.contentWindow.postMessage({captureSourceIdWithAudio:!0},"*"):iframe.contentWindow.postMessage({captureSourceId:!0},"*"):setTimeout((function(){postGetSourceIdMessage(custom_parameter)}),100):loadIFrame((function(){postGetSourceIdMessage(custom_parameter)}))}var iframe;function loadIFrame(loadCallback){iframe?loadCallback():((iframe=document.createElement("iframe")).onload=function(){iframe.isLoaded=!0,loadCallback()},iframe.src="https://openvidu.github.io/openvidu-screen-sharing-chrome-extension/",iframe.style.display="none",(document.body||document.documentElement).appendChild(iframe))}function postGetChromeExtensionStatusMessage(){iframe?iframe.isLoaded?iframe.contentWindow.postMessage({getChromeExtensionStatus:!0},"*"):setTimeout(postGetChromeExtensionStatusMessage,100):loadIFrame(postGetChromeExtensionStatusMessage)}window.getScreenId=function(firefoxString,callback,custom_parameter){-1===navigator.userAgent.indexOf("Edge")||!navigator.msSaveOrOpenBlob&&!navigator.msSaveBlob?navigator.mozGetUserMedia?callback(null,"firefox",{video:{mozMediaSource:firefoxString,mediaSource:firefoxString}}):(window.addEventListener("message",(function onIFrameCallback(event){if(!event.data)return;event.data.chromeMediaSourceId&&("PermissionDeniedError"===event.data.chromeMediaSourceId?callback("permission-denied"):callback(null,event.data.chromeMediaSourceId,getScreenConstraints(null,event.data.chromeMediaSourceId,event.data.canRequestAudioTrack)),window.removeEventListener("message",onIFrameCallback));event.data.chromeExtensionStatus&&(callback(event.data.chromeExtensionStatus,null,getScreenConstraints(event.data.chromeExtensionStatus)),window.removeEventListener("message",onIFrameCallback))})),custom_parameter?setTimeout((function(){postGetSourceIdMessage(custom_parameter)}),100):setTimeout(postGetSourceIdMessage,100)):callback({video:!0})},window.getScreenConstraints=function(callback){loadIFrame((function(){getScreenId((function(error,sourceId,screen_constraints){screen_constraints||(screen_constraints={video:!0}),callback(error,screen_constraints.video)}))}))},window.getChromeExtensionStatus=function(callback){navigator.mozGetUserMedia?callback("installed-enabled"):(window.addEventListener("message",(function onIFrameCallback(event){if(!event.data)return;event.data.chromeExtensionStatus&&(callback(event.data.chromeExtensionStatus),window.removeEventListener("message",onIFrameCallback))})),setTimeout(postGetChromeExtensionStatusMessage,100))},exports.getScreenId=window.getScreenId},1100:function(module,exports){var sourceId,screenCallback,chromeMediaSource="screen";if("undefined"!=typeof window&&"undefined"!=typeof navigator&&void 0!==navigator.userAgent){var isFirefox=void 0!==window.InstallTrigger,isOpera=!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0;window.chrome;window.addEventListener("message",(function(event){event.origin==window.location.origin&&function onMessageCallback(data){if("PermissionDeniedError"==data){if(screenCallback)return screenCallback("PermissionDeniedError");throw new Error("PermissionDeniedError")}"rtcmulticonnection-extension-loaded"==data&&(chromeMediaSource="desktop");data.sourceId&&screenCallback&&screenCallback(sourceId=data.sourceId,!0===data.canRequestAudioTrack)}(event.data)}))}function getSourceId(callback){if(!callback)throw'"callback" parameter is mandatory.';if(sourceId)return callback(sourceId);screenCallback=callback,window.postMessage("get-sourceId","*")}function getScreenConstraints(callback,captureSourceIdWithAudio){sourceId="";if(isFirefox)return callback(null,{mozMediaSource:"window",mediaSource:"window"});var screen_constraints={mandatory:{chromeMediaSource:chromeMediaSource,maxWidth:screen.width>1920?screen.width:1920,maxHeight:screen.height>1080?screen.height:1080},optional:[]};"desktop"!=chromeMediaSource||sourceId?("desktop"==chromeMediaSource&&(screen_constraints.mandatory.chromeMediaSourceId=sourceId),callback(null,screen_constraints)):captureSourceIdWithAudio?function getSourceIdWithAudio(callback){if(!callback)throw'"callback" parameter is mandatory.';if(sourceId)return callback(sourceId);screenCallback=callback,window.postMessage("audio-plus-tab","*")}((function(sourceId,canRequestAudioTrack){screen_constraints.mandatory.chromeMediaSourceId=sourceId,canRequestAudioTrack&&(screen_constraints.canRequestAudioTrack=!0),callback("PermissionDeniedError"==sourceId?sourceId:null,screen_constraints)})):getSourceId((function(sourceId){screen_constraints.mandatory.chromeMediaSourceId=sourceId,callback("PermissionDeniedError"==sourceId?sourceId:null,screen_constraints)}))}exports.getScreenConstraints=getScreenConstraints,exports.getScreenConstraintsWithAudio=function getScreenConstraintsWithAudio(callback){getScreenConstraints(callback,!0)},exports.isChromeExtensionAvailable=function isChromeExtensionAvailable(callback){if(callback){if("desktop"==chromeMediaSource)return callback(!0);window.postMessage("are-you-there","*"),setTimeout((function(){callback("screen"!=chromeMediaSource)}),2e3)}},exports.getChromeExtensionStatus=function getChromeExtensionStatus(extensionid,callback){if(isFirefox)return callback("not-chrome");2!=arguments.length&&(callback=extensionid,extensionid="lfcgfepafnobdloecchnfaclibenjold");var image=document.createElement("img");image.src="chrome-extension://"+extensionid+"/icon.png",image.onload=function(){chromeMediaSource="screen",window.postMessage("are-you-there","*"),setTimeout((function(){callback("screen"==chromeMediaSource?"installed-disabled":"installed-enabled")}),2e3)},image.onerror=function(){callback("not-installed")}},exports.getSourceId=getSourceId},1101:function(module,exports,__webpack_require__){"use strict";var ReflectOwnKeys,R="object"==typeof Reflect?Reflect:null,ReflectApply=R&&"function"==typeof R.apply?R.apply:function ReflectApply(target,receiver,args){return Function.prototype.apply.call(target,receiver,args)};ReflectOwnKeys=R&&"function"==typeof R.ownKeys?R.ownKeys:Object.getOwnPropertySymbols?function ReflectOwnKeys(target){return Object.getOwnPropertyNames(target).concat(Object.getOwnPropertySymbols(target))}:function ReflectOwnKeys(target){return Object.getOwnPropertyNames(target)};var NumberIsNaN=Number.isNaN||function NumberIsNaN(value){return value!=value};function EventEmitter(){EventEmitter.init.call(this)}module.exports=EventEmitter,module.exports.once=function once(emitter,name){return new Promise((function(resolve,reject){function errorListener(err){emitter.removeListener(name,resolver),reject(err)}function resolver(){"function"==typeof emitter.removeListener&&emitter.removeListener("error",errorListener),resolve([].slice.call(arguments))}eventTargetAgnosticAddListener(emitter,name,resolver,{once:!0}),"error"!==name&&function addErrorHandlerIfEventEmitter(emitter,handler,flags){"function"==typeof emitter.on&&eventTargetAgnosticAddListener(emitter,"error",handler,flags)}(emitter,errorListener,{once:!0})}))},EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._eventsCount=0,EventEmitter.prototype._maxListeners=void 0;var defaultMaxListeners=10;function checkListener(listener){if("function"!=typeof listener)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof listener)}function _getMaxListeners(that){return void 0===that._maxListeners?EventEmitter.defaultMaxListeners:that._maxListeners}function _addListener(target,type,listener,prepend){var m,events,existing;if(checkListener(listener),void 0===(events=target._events)?(events=target._events=Object.create(null),target._eventsCount=0):(void 0!==events.newListener&&(target.emit("newListener",type,listener.listener?listener.listener:listener),events=target._events),existing=events[type]),void 0===existing)existing=events[type]=listener,++target._eventsCount;else if("function"==typeof existing?existing=events[type]=prepend?[listener,existing]:[existing,listener]:prepend?existing.unshift(listener):existing.push(listener),(m=_getMaxListeners(target))>0&&existing.length>m&&!existing.warned){existing.warned=!0;var w=new Error("Possible EventEmitter memory leak detected. "+existing.length+" "+String(type)+" listeners added. Use emitter.setMaxListeners() to increase limit");w.name="MaxListenersExceededWarning",w.emitter=target,w.type=type,w.count=existing.length,function ProcessEmitWarning(warning){console&&console.warn&&console.warn(warning)}(w)}return target}function onceWrapper(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function _onceWrap(target,type,listener){var state={fired:!1,wrapFn:void 0,target:target,type:type,listener:listener},wrapped=onceWrapper.bind(state);return wrapped.listener=listener,state.wrapFn=wrapped,wrapped}function _listeners(target,type,unwrap){var events=target._events;if(void 0===events)return[];var evlistener=events[type];return void 0===evlistener?[]:"function"==typeof evlistener?unwrap?[evlistener.listener||evlistener]:[evlistener]:unwrap?function unwrapListeners(arr){for(var ret=new Array(arr.length),i=0;i<ret.length;++i)ret[i]=arr[i].listener||arr[i];return ret}(evlistener):arrayClone(evlistener,evlistener.length)}function listenerCount(type){var events=this._events;if(void 0!==events){var evlistener=events[type];if("function"==typeof evlistener)return 1;if(void 0!==evlistener)return evlistener.length}return 0}function arrayClone(arr,n){for(var copy=new Array(n),i=0;i<n;++i)copy[i]=arr[i];return copy}function eventTargetAgnosticAddListener(emitter,name,listener,flags){if("function"==typeof emitter.on)flags.once?emitter.once(name,listener):emitter.on(name,listener);else{if("function"!=typeof emitter.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof emitter);emitter.addEventListener(name,(function wrapListener(arg){flags.once&&emitter.removeEventListener(name,wrapListener),listener(arg)}))}}Object.defineProperty(EventEmitter,"defaultMaxListeners",{enumerable:!0,get:function(){return defaultMaxListeners},set:function(arg){if("number"!=typeof arg||arg<0||NumberIsNaN(arg))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+arg+".");defaultMaxListeners=arg}}),EventEmitter.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},EventEmitter.prototype.setMaxListeners=function setMaxListeners(n){if("number"!=typeof n||n<0||NumberIsNaN(n))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+n+".");return this._maxListeners=n,this},EventEmitter.prototype.getMaxListeners=function getMaxListeners(){return _getMaxListeners(this)},EventEmitter.prototype.emit=function emit(type){for(var args=[],i=1;i<arguments.length;i++)args.push(arguments[i]);var doError="error"===type,events=this._events;if(void 0!==events)doError=doError&&void 0===events.error;else if(!doError)return!1;if(doError){var er;if(args.length>0&&(er=args[0]),er instanceof Error)throw er;var err=new Error("Unhandled error."+(er?" ("+er.message+")":""));throw err.context=er,err}var handler=events[type];if(void 0===handler)return!1;if("function"==typeof handler)ReflectApply(handler,this,args);else{var len=handler.length,listeners=arrayClone(handler,len);for(i=0;i<len;++i)ReflectApply(listeners[i],this,args)}return!0},EventEmitter.prototype.addListener=function addListener(type,listener){return _addListener(this,type,listener,!1)},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.prependListener=function prependListener(type,listener){return _addListener(this,type,listener,!0)},EventEmitter.prototype.once=function once(type,listener){return checkListener(listener),this.on(type,_onceWrap(this,type,listener)),this},EventEmitter.prototype.prependOnceListener=function prependOnceListener(type,listener){return checkListener(listener),this.prependListener(type,_onceWrap(this,type,listener)),this},EventEmitter.prototype.removeListener=function removeListener(type,listener){var list,events,position,i,originalListener;if(checkListener(listener),void 0===(events=this._events))return this;if(void 0===(list=events[type]))return this;if(list===listener||list.listener===listener)0==--this._eventsCount?this._events=Object.create(null):(delete events[type],events.removeListener&&this.emit("removeListener",type,list.listener||listener));else if("function"!=typeof list){for(position=-1,i=list.length-1;i>=0;i--)if(list[i]===listener||list[i].listener===listener){originalListener=list[i].listener,position=i;break}if(position<0)return this;0===position?list.shift():function spliceOne(list,index){for(;index+1<list.length;index++)list[index]=list[index+1];list.pop()}(list,position),1===list.length&&(events[type]=list[0]),void 0!==events.removeListener&&this.emit("removeListener",type,originalListener||listener)}return this},EventEmitter.prototype.off=EventEmitter.prototype.removeListener,EventEmitter.prototype.removeAllListeners=function removeAllListeners(type){var listeners,events,i;if(void 0===(events=this._events))return this;if(void 0===events.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==events[type]&&(0==--this._eventsCount?this._events=Object.create(null):delete events[type]),this;if(0===arguments.length){var key,keys=Object.keys(events);for(i=0;i<keys.length;++i)"removeListener"!==(key=keys[i])&&this.removeAllListeners(key);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(listeners=events[type]))this.removeListener(type,listeners);else if(void 0!==listeners)for(i=listeners.length-1;i>=0;i--)this.removeListener(type,listeners[i]);return this},EventEmitter.prototype.listeners=function listeners(type){return _listeners(this,type,!0)},EventEmitter.prototype.rawListeners=function rawListeners(type){return _listeners(this,type,!1)},EventEmitter.listenerCount=function(emitter,type){return"function"==typeof emitter.listenerCount?emitter.listenerCount(type):listenerCount.call(emitter,type)},EventEmitter.prototype.listenerCount=listenerCount,EventEmitter.prototype.eventNames=function eventNames(){return this._eventsCount>0?ReflectOwnKeys(this._events):[]}},1102:function(module,exports){"function"==typeof Object.create?module.exports=function inherits(ctor,superCtor){superCtor&&(ctor.super_=superCtor,ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:!1,writable:!0,configurable:!0}}))}:module.exports=function inherits(ctor,superCtor){if(superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype,ctor.prototype=new TempCtor,ctor.prototype.constructor=ctor}}},1103:function(module,exports,__webpack_require__){var JsonRPC=__webpack_require__(1104),XmlRPC=__webpack_require__(1105);exports.JsonRPC=JsonRPC,exports.XmlRPC=XmlRPC},1104:function(module,exports){exports.pack=function pack(message,id){var result={jsonrpc:"2.0"};if(message.method)result.method=message.method,message.params&&(result.params=message.params),null!=id&&(result.id=id);else if(null!=id){if(message.error){if(void 0!==message.result)throw new TypeError("Both result and error are defined");result.error=message.error}else{if(void 0===message.result)throw new TypeError("No result or error is defined");result.result=message.result}result.id=id}return JSON.stringify(result)},exports.unpack=function unpack(message){var result=message;("string"==typeof message||message instanceof String)&&(result=JSON.parse(message));var version=result.jsonrpc;if("2.0"!==version)throw new TypeError("Invalid JsonRPC version '"+version+"': "+message);if(null==result.method){if(null==result.id)throw new TypeError("Invalid message: "+message);var result_defined=void 0!==result.result,error_defined=void 0!==result.error;if(result_defined&&error_defined)throw new TypeError("Both result and error are defined: "+message);if(!result_defined&&!error_defined)throw new TypeError("No result or error is defined: "+message);result.ack=result.id,delete result.id}return result}},1105:function(module,exports){exports.pack=function pack(message){throw new TypeError("Not yet implemented")},exports.unpack=function unpack(message){throw new TypeError("Not yet implemented")}},1106:function(module,exports){function Mapper(){var sources={};this.forEach=function(callback){for(var key in sources){var source=sources[key];for(var key2 in source)callback(source[key2])}},this.get=function(id,source){var ids=sources[source];if(null!=ids)return ids[id]},this.remove=function(id,source){var ids=sources[source];if(null!=ids){for(var i in delete ids[id],ids)return!1;delete sources[source]}},this.set=function(value,id,source){if(null==value)return this.remove(id,source);var ids=sources[source];null==ids&&(sources[source]=ids={}),ids[id]=value}}Mapper.prototype.pop=function(id,source){var value=this.get(id,source);if(null!=value)return this.remove(id,source),value},module.exports=Mapper},1107:function(module,exports,__webpack_require__){var JsonRpcClient=__webpack_require__(1108);exports.JsonRpcClient=JsonRpcClient},1108:function(module,exports,__webpack_require__){var RpcBuilder=__webpack_require__(1036),WebSocketWithReconnection=__webpack_require__(1037),OpenViduLogger=__webpack_require__(992).OpenViduLogger;Date.now=Date.now||function(){return+new Date};var Logger=OpenViduLogger.getInstance();module.exports=function JsonRpcClient(configuration){var pingInterval,self=this,wsConfig=configuration.ws,notReconnectIfNumLessThan=-1,pingNextNum=0,enabledPings=!0,pingPongStarted=!1,status="DISCONNECTED",onreconnecting=wsConfig.onreconnecting,onreconnected=wsConfig.onreconnected,onconnected=wsConfig.onconnected,onerror=wsConfig.onerror;configuration.rpc.pull=function(params,request){request.reply(null,"push")},wsConfig.onreconnecting=function(){Logger.debug("--------- ONRECONNECTING -----------"),"RECONNECTING"!==status?(stopPing(),status="RECONNECTING",onreconnecting&&onreconnecting()):Logger.error("Websocket already in RECONNECTING state when receiving a new ONRECONNECTING message. Ignoring it")},wsConfig.onreconnected=function(){Logger.debug("--------- ONRECONNECTED -----------"),"CONNECTED"!==status?(status="CONNECTED",updateNotReconnectIfLessThan(),onreconnected&&onreconnected()):Logger.error("Websocket already in CONNECTED state when receiving a new ONRECONNECTED message. Ignoring it")},wsConfig.onconnected=function(){Logger.debug("--------- ONCONNECTED -----------"),"CONNECTED"!==status?(status="CONNECTED",enabledPings=!0,usePing(),onconnected&&onconnected()):Logger.error("Websocket already in CONNECTED state when receiving a new ONCONNECTED message. Ignoring it")},wsConfig.onerror=function(error){Logger.debug("--------- ONERROR -----------"),status="DISCONNECTED",stopPing(),onerror&&onerror(error)};var ws=new WebSocketWithReconnection(wsConfig);Logger.debug("Connecting websocket to URI: "+wsConfig.uri);var rpcBuilderOptions={request_timeout:configuration.rpc.requestTimeout,ping_request_timeout:configuration.rpc.heartbeatRequestTimeout},rpc=new RpcBuilder(RpcBuilder.packers.JsonRPC,rpcBuilderOptions,ws,(function(request){Logger.debug("Received request: "+JSON.stringify(request));try{var func=configuration.rpc[request.method];void 0===func?Logger.error("Method "+request.method+" not registered in client"):func(request.params,request)}catch(err){Logger.error("Exception processing request: "+JSON.stringify(request)),Logger.error(err)}}));function updateNotReconnectIfLessThan(){Logger.debug("notReconnectIfNumLessThan = "+pingNextNum+" (old="+notReconnectIfNumLessThan+")"),notReconnectIfNumLessThan=pingNextNum}function sendPing(){if(enabledPings){var params=null;0!=pingNextNum&&pingNextNum!=notReconnectIfNumLessThan||(params={interval:configuration.heartbeat||5e3}),pingNextNum++,self.send("ping",params,(pingNum=pingNextNum,function(error,result){error&&(Logger.debug("Error in ping request #"+pingNum+" ("+error.message+")"),pingNum>notReconnectIfNumLessThan&&(enabledPings=!1,updateNotReconnectIfLessThan(),Logger.debug("Server did not respond to ping message #"+pingNum+". Reconnecting... "),ws.reconnectWs()))}))}else Logger.debug("Trying to send ping, but ping is not enabled");var pingNum}function usePing(){pingPongStarted||(Logger.debug("Starting ping (if configured)"),pingPongStarted=!0,null!=configuration.heartbeat&&(pingInterval=setInterval(sendPing,configuration.heartbeat),sendPing()))}function stopPing(){clearInterval(pingInterval),pingPongStarted=!1,enabledPings=!1,pingNextNum=-1,rpc.cancel()}this.send=function(method,params,callback){var requestTime=Date.now();rpc.encode(method,params,(function(error,result){if(error){try{Logger.error("ERROR:"+error.message+" in Request: method:"+method+" params:"+JSON.stringify(params)+" request:"+error.request),error.data&&Logger.error("ERROR DATA:"+JSON.stringify(error.data))}catch(e){}error.requestTime=requestTime}callback&&(null!=result&&"pong"!==result.value&&Logger.debug("Response: "+JSON.stringify(result)),callback(error,result))}))},this.close=function(code,reason){Logger.debug("Closing  with code: "+code+" because: "+reason),null!=pingInterval&&(Logger.debug("Clearing ping interval"),clearInterval(pingInterval)),pingPongStarted=!1,enabledPings=!1,ws.close(code,reason)},this.forceClose=function(millis){ws.forceClose(millis)},this.reconnect=function(){ws.reconnectWs()},this.resetPing=function(){enabledPings=!0,pingNextNum=0,usePing()},this.getReadyState=function(){return ws.getReadyState()}}},1109:function(module,exports,__webpack_require__){var WebSocketWithReconnection=__webpack_require__(1037);exports.WebSocketWithReconnection=WebSocketWithReconnection},1110:function(module){module.exports=JSON.parse('{"author":"OpenVidu","dependencies":{"freeice":"2.2.2","hark":"1.2.3","jsnlog":"2.30.0","platform":"1.3.6","uuid":"8.3.2","wolfy87-eventemitter":"5.2.9"},"description":"OpenVidu Browser","devDependencies":{"@types/node":"14.14.32","@types/platform":"1.3.3","browserify":"17.0.0","grunt":"1.3.0","grunt-cli":"1.3.2","grunt-contrib-copy":"1.0.0","grunt-contrib-sass":"2.0.0","grunt-contrib-uglify":"5.0.0","grunt-contrib-watch":"1.1.0","grunt-postcss":"0.9.0","grunt-string-replace":"1.3.1","grunt-ts":"6.0.0-beta.22","terser":"5.6.0","tsify":"5.0.2","tslint":"6.1.3","typedoc":"0.19.2","typescript":"4.0.7"},"license":"Apache-2.0","main":"lib/index.js","name":"openvidu-browser","repository":{"type":"git","url":"git://github.com/OpenVidu/openvidu"},"scripts":{"browserify":"VERSION=${VERSION:-dev}; mkdir -p static/js/ && cd src && ../node_modules/browserify/bin/cmd.js Main.ts -p [ tsify ] --exclude kurento-browser-extensions --debug -o ../static/js/openvidu-browser-$VERSION.js -v","browserify-prod":"VERSION=${VERSION:-dev}; mkdir -p static/js/ && cd src && ../node_modules/browserify/bin/cmd.js --debug Main.ts -p [ tsify ] --exclude kurento-browser-extensions | ../node_modules/terser/bin/terser --source-map content=inline --output ../static/js/openvidu-browser-$VERSION.min.js","build":"cd src/OpenVidu && ./../../node_modules/typescript/bin/tsc && cd ../.. && ./node_modules/typescript/bin/tsc --declaration src/index.ts --outDir ./lib --sourceMap --lib dom,es5,es2015.promise,scripthost","docs":"./generate-docs.sh"},"types":"lib/index.d.ts","version":"2.18.0"}')},1111:function(module,__webpack_exports__,__webpack_require__){"use strict";var getRandomValues;__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"v1",(function(){return esm_browser_v1})),__webpack_require__.d(__webpack_exports__,"v3",(function(){return esm_browser_v3})),__webpack_require__.d(__webpack_exports__,"v4",(function(){return esm_browser_v4})),__webpack_require__.d(__webpack_exports__,"v5",(function(){return esm_browser_v5})),__webpack_require__.d(__webpack_exports__,"NIL",(function(){return nil})),__webpack_require__.d(__webpack_exports__,"version",(function(){return esm_browser_version})),__webpack_require__.d(__webpack_exports__,"validate",(function(){return esm_browser_validate})),__webpack_require__.d(__webpack_exports__,"stringify",(function(){return esm_browser_stringify})),__webpack_require__.d(__webpack_exports__,"parse",(function(){return esm_browser_parse}));var rnds8=new Uint8Array(16);function rng(){if(!getRandomValues&&!(getRandomValues="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return getRandomValues(rnds8)}var regex=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var esm_browser_validate=function validate(uuid){return"string"==typeof uuid&&regex.test(uuid)},byteToHex=[],stringify_i=0;stringify_i<256;++stringify_i)byteToHex.push((stringify_i+256).toString(16).substr(1));var _nodeId,_clockseq,esm_browser_stringify=function stringify(arr){var offset=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,uuid=(byteToHex[arr[offset+0]]+byteToHex[arr[offset+1]]+byteToHex[arr[offset+2]]+byteToHex[arr[offset+3]]+"-"+byteToHex[arr[offset+4]]+byteToHex[arr[offset+5]]+"-"+byteToHex[arr[offset+6]]+byteToHex[arr[offset+7]]+"-"+byteToHex[arr[offset+8]]+byteToHex[arr[offset+9]]+"-"+byteToHex[arr[offset+10]]+byteToHex[arr[offset+11]]+byteToHex[arr[offset+12]]+byteToHex[arr[offset+13]]+byteToHex[arr[offset+14]]+byteToHex[arr[offset+15]]).toLowerCase();if(!esm_browser_validate(uuid))throw TypeError("Stringified UUID is invalid");return uuid},_lastMSecs=0,_lastNSecs=0;var esm_browser_v1=function v1(options,buf,offset){var i=buf&&offset||0,b=buf||new Array(16),node=(options=options||{}).node||_nodeId,clockseq=void 0!==options.clockseq?options.clockseq:_clockseq;if(null==node||null==clockseq){var seedBytes=options.random||(options.rng||rng)();null==node&&(node=_nodeId=[1|seedBytes[0],seedBytes[1],seedBytes[2],seedBytes[3],seedBytes[4],seedBytes[5]]),null==clockseq&&(clockseq=_clockseq=16383&(seedBytes[6]<<8|seedBytes[7]))}var msecs=void 0!==options.msecs?options.msecs:Date.now(),nsecs=void 0!==options.nsecs?options.nsecs:_lastNSecs+1,dt=msecs-_lastMSecs+(nsecs-_lastNSecs)/1e4;if(dt<0&&void 0===options.clockseq&&(clockseq=clockseq+1&16383),(dt<0||msecs>_lastMSecs)&&void 0===options.nsecs&&(nsecs=0),nsecs>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");_lastMSecs=msecs,_lastNSecs=nsecs,_clockseq=clockseq;var tl=(1e4*(268435455&(msecs+=122192928e5))+nsecs)%4294967296;b[i++]=tl>>>24&255,b[i++]=tl>>>16&255,b[i++]=tl>>>8&255,b[i++]=255&tl;var tmh=msecs/4294967296*1e4&268435455;b[i++]=tmh>>>8&255,b[i++]=255&tmh,b[i++]=tmh>>>24&15|16,b[i++]=tmh>>>16&255,b[i++]=clockseq>>>8|128,b[i++]=255&clockseq;for(var n=0;n<6;++n)b[i+n]=node[n];return buf||esm_browser_stringify(b)};var esm_browser_parse=function parse(uuid){if(!esm_browser_validate(uuid))throw TypeError("Invalid UUID");var v,arr=new Uint8Array(16);return arr[0]=(v=parseInt(uuid.slice(0,8),16))>>>24,arr[1]=v>>>16&255,arr[2]=v>>>8&255,arr[3]=255&v,arr[4]=(v=parseInt(uuid.slice(9,13),16))>>>8,arr[5]=255&v,arr[6]=(v=parseInt(uuid.slice(14,18),16))>>>8,arr[7]=255&v,arr[8]=(v=parseInt(uuid.slice(19,23),16))>>>8,arr[9]=255&v,arr[10]=(v=parseInt(uuid.slice(24,36),16))/1099511627776&255,arr[11]=v/4294967296&255,arr[12]=v>>>24&255,arr[13]=v>>>16&255,arr[14]=v>>>8&255,arr[15]=255&v,arr};var v35=function(name,version,hashfunc){function generateUUID(value,namespace,buf,offset){if("string"==typeof value&&(value=function stringToBytes(str){str=unescape(encodeURIComponent(str));for(var bytes=[],i=0;i<str.length;++i)bytes.push(str.charCodeAt(i));return bytes}(value)),"string"==typeof namespace&&(namespace=esm_browser_parse(namespace)),16!==namespace.length)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var bytes=new Uint8Array(16+value.length);if(bytes.set(namespace),bytes.set(value,namespace.length),(bytes=hashfunc(bytes))[6]=15&bytes[6]|version,bytes[8]=63&bytes[8]|128,buf){offset=offset||0;for(var i=0;i<16;++i)buf[offset+i]=bytes[i];return buf}return esm_browser_stringify(bytes)}try{generateUUID.name=name}catch(err){}return generateUUID.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",generateUUID.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",generateUUID};function getOutputLength(inputLength8){return 14+(inputLength8+64>>>9<<4)+1}function safeAdd(x,y){var lsw=(65535&x)+(65535&y);return(x>>16)+(y>>16)+(lsw>>16)<<16|65535&lsw}function md5cmn(q,a,b,x,s,t){return safeAdd(function bitRotateLeft(num,cnt){return num<<cnt|num>>>32-cnt}(safeAdd(safeAdd(a,q),safeAdd(x,t)),s),b)}function md5ff(a,b,c,d,x,s,t){return md5cmn(b&c|~b&d,a,b,x,s,t)}function md5gg(a,b,c,d,x,s,t){return md5cmn(b&d|c&~d,a,b,x,s,t)}function md5hh(a,b,c,d,x,s,t){return md5cmn(b^c^d,a,b,x,s,t)}function md5ii(a,b,c,d,x,s,t){return md5cmn(c^(b|~d),a,b,x,s,t)}var esm_browser_v3=v35("v3",48,(function md5(bytes){if("string"==typeof bytes){var msg=unescape(encodeURIComponent(bytes));bytes=new Uint8Array(msg.length);for(var i=0;i<msg.length;++i)bytes[i]=msg.charCodeAt(i)}return function md5ToHexEncodedArray(input){for(var output=[],length32=32*input.length,hexTab="0123456789abcdef",i=0;i<length32;i+=8){var x=input[i>>5]>>>i%32&255,hex=parseInt(hexTab.charAt(x>>>4&15)+hexTab.charAt(15&x),16);output.push(hex)}return output}(function wordsToMd5(x,len){x[len>>5]|=128<<len%32,x[getOutputLength(len)-1]=len;for(var a=1732584193,b=-271733879,c=-1732584194,d=271733878,i=0;i<x.length;i+=16){var olda=a,oldb=b,oldc=c,oldd=d;a=md5ff(a,b,c,d,x[i],7,-680876936),d=md5ff(d,a,b,c,x[i+1],12,-389564586),c=md5ff(c,d,a,b,x[i+2],17,606105819),b=md5ff(b,c,d,a,x[i+3],22,-1044525330),a=md5ff(a,b,c,d,x[i+4],7,-176418897),d=md5ff(d,a,b,c,x[i+5],12,1200080426),c=md5ff(c,d,a,b,x[i+6],17,-1473231341),b=md5ff(b,c,d,a,x[i+7],22,-45705983),a=md5ff(a,b,c,d,x[i+8],7,1770035416),d=md5ff(d,a,b,c,x[i+9],12,-1958414417),c=md5ff(c,d,a,b,x[i+10],17,-42063),b=md5ff(b,c,d,a,x[i+11],22,-1990404162),a=md5ff(a,b,c,d,x[i+12],7,1804603682),d=md5ff(d,a,b,c,x[i+13],12,-40341101),c=md5ff(c,d,a,b,x[i+14],17,-1502002290),a=md5gg(a,b=md5ff(b,c,d,a,x[i+15],22,1236535329),c,d,x[i+1],5,-165796510),d=md5gg(d,a,b,c,x[i+6],9,-1069501632),c=md5gg(c,d,a,b,x[i+11],14,643717713),b=md5gg(b,c,d,a,x[i],20,-373897302),a=md5gg(a,b,c,d,x[i+5],5,-701558691),d=md5gg(d,a,b,c,x[i+10],9,38016083),c=md5gg(c,d,a,b,x[i+15],14,-660478335),b=md5gg(b,c,d,a,x[i+4],20,-405537848),a=md5gg(a,b,c,d,x[i+9],5,568446438),d=md5gg(d,a,b,c,x[i+14],9,-1019803690),c=md5gg(c,d,a,b,x[i+3],14,-187363961),b=md5gg(b,c,d,a,x[i+8],20,1163531501),a=md5gg(a,b,c,d,x[i+13],5,-1444681467),d=md5gg(d,a,b,c,x[i+2],9,-51403784),c=md5gg(c,d,a,b,x[i+7],14,1735328473),a=md5hh(a,b=md5gg(b,c,d,a,x[i+12],20,-1926607734),c,d,x[i+5],4,-378558),d=md5hh(d,a,b,c,x[i+8],11,-2022574463),c=md5hh(c,d,a,b,x[i+11],16,1839030562),b=md5hh(b,c,d,a,x[i+14],23,-35309556),a=md5hh(a,b,c,d,x[i+1],4,-1530992060),d=md5hh(d,a,b,c,x[i+4],11,1272893353),c=md5hh(c,d,a,b,x[i+7],16,-155497632),b=md5hh(b,c,d,a,x[i+10],23,-1094730640),a=md5hh(a,b,c,d,x[i+13],4,681279174),d=md5hh(d,a,b,c,x[i],11,-358537222),c=md5hh(c,d,a,b,x[i+3],16,-722521979),b=md5hh(b,c,d,a,x[i+6],23,76029189),a=md5hh(a,b,c,d,x[i+9],4,-640364487),d=md5hh(d,a,b,c,x[i+12],11,-421815835),c=md5hh(c,d,a,b,x[i+15],16,530742520),a=md5ii(a,b=md5hh(b,c,d,a,x[i+2],23,-995338651),c,d,x[i],6,-198630844),d=md5ii(d,a,b,c,x[i+7],10,1126891415),c=md5ii(c,d,a,b,x[i+14],15,-1416354905),b=md5ii(b,c,d,a,x[i+5],21,-57434055),a=md5ii(a,b,c,d,x[i+12],6,1700485571),d=md5ii(d,a,b,c,x[i+3],10,-1894986606),c=md5ii(c,d,a,b,x[i+10],15,-1051523),b=md5ii(b,c,d,a,x[i+1],21,-2054922799),a=md5ii(a,b,c,d,x[i+8],6,1873313359),d=md5ii(d,a,b,c,x[i+15],10,-30611744),c=md5ii(c,d,a,b,x[i+6],15,-1560198380),b=md5ii(b,c,d,a,x[i+13],21,1309151649),a=md5ii(a,b,c,d,x[i+4],6,-145523070),d=md5ii(d,a,b,c,x[i+11],10,-1120210379),c=md5ii(c,d,a,b,x[i+2],15,718787259),b=md5ii(b,c,d,a,x[i+9],21,-343485551),a=safeAdd(a,olda),b=safeAdd(b,oldb),c=safeAdd(c,oldc),d=safeAdd(d,oldd)}return[a,b,c,d]}(function bytesToWords(input){if(0===input.length)return[];for(var length8=8*input.length,output=new Uint32Array(getOutputLength(length8)),i=0;i<length8;i+=8)output[i>>5]|=(255&input[i/8])<<i%32;return output}(bytes),8*bytes.length))}));var esm_browser_v4=function v4(options,buf,offset){var rnds=(options=options||{}).random||(options.rng||rng)();if(rnds[6]=15&rnds[6]|64,rnds[8]=63&rnds[8]|128,buf){offset=offset||0;for(var i=0;i<16;++i)buf[offset+i]=rnds[i];return buf}return esm_browser_stringify(rnds)};function f(s,x,y,z){switch(s){case 0:return x&y^~x&z;case 1:return x^y^z;case 2:return x&y^x&z^y&z;case 3:return x^y^z}}function ROTL(x,n){return x<<n|x>>>32-n}var esm_browser_v5=v35("v5",80,(function sha1(bytes){var K=[1518500249,1859775393,2400959708,3395469782],H=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof bytes){var msg=unescape(encodeURIComponent(bytes));bytes=[];for(var i=0;i<msg.length;++i)bytes.push(msg.charCodeAt(i))}else Array.isArray(bytes)||(bytes=Array.prototype.slice.call(bytes));bytes.push(128);for(var l=bytes.length/4+2,N=Math.ceil(l/16),M=new Array(N),_i=0;_i<N;++_i){for(var arr=new Uint32Array(16),j=0;j<16;++j)arr[j]=bytes[64*_i+4*j]<<24|bytes[64*_i+4*j+1]<<16|bytes[64*_i+4*j+2]<<8|bytes[64*_i+4*j+3];M[_i]=arr}M[N-1][14]=8*(bytes.length-1)/Math.pow(2,32),M[N-1][14]=Math.floor(M[N-1][14]),M[N-1][15]=8*(bytes.length-1)&4294967295;for(var _i2=0;_i2<N;++_i2){for(var W=new Uint32Array(80),t=0;t<16;++t)W[t]=M[_i2][t];for(var _t=16;_t<80;++_t)W[_t]=ROTL(W[_t-3]^W[_t-8]^W[_t-14]^W[_t-16],1);for(var a=H[0],b=H[1],c=H[2],d=H[3],e=H[4],_t2=0;_t2<80;++_t2){var s=Math.floor(_t2/20),T=ROTL(a,5)+f(s,b,c,d)+e+K[s]+W[_t2]>>>0;e=d,d=c,c=ROTL(b,30)>>>0,b=a,a=T}H[0]=H[0]+a>>>0,H[1]=H[1]+b>>>0,H[2]=H[2]+c>>>0,H[3]=H[3]+d>>>0,H[4]=H[4]+e>>>0}return[H[0]>>24&255,H[0]>>16&255,H[0]>>8&255,255&H[0],H[1]>>24&255,H[1]>>16&255,H[1]>>8&255,255&H[1],H[2]>>24&255,H[2]>>16&255,H[2]>>8&255,255&H[2],H[3]>>24&255,H[3]>>16&255,H[3]>>8&255,255&H[3],H[4]>>24&255,H[4]>>16&255,H[4]>>8&255,255&H[4]]})),nil="00000000-0000-0000-0000-000000000000";var esm_browser_version=function version_version(uuid){if(!esm_browser_validate(uuid))throw TypeError("Invalid UUID");return parseInt(uuid.substr(14,1),16)}},985:function(module,exports,__webpack_require__){"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){void 0===k2&&(k2=k),Object.defineProperty(o,k2,{enumerable:!0,get:function(){return m[k]}})}:function(o,m,k,k2){void 0===k2&&(k2=k),o[k2]=m[k]});exports.__esModule=!0,exports.EventDispatcher=exports.ExceptionEvent=exports.NetworkQualityLevelChangedEvent=exports.FilterEvent=exports.ConnectionPropertyChangedEvent=exports.StreamPropertyChangedEvent=exports.VideoElementEvent=exports.StreamManagerEvent=exports.StreamEvent=exports.SignalEvent=exports.SessionDisconnectedEvent=exports.RecordingEvent=exports.PublisherSpeakingEvent=exports.ConnectionEvent=exports.Event=exports.VideoInsertMode=exports.OpenViduError=exports.LocalRecorderState=exports.Filter=exports.LocalRecorder=exports.Connection=exports.Stream=exports.StreamManager=exports.Subscriber=exports.Publisher=exports.Session=exports.OpenVidu=void 0,__createBinding(exports,__webpack_require__(1088),"OpenVidu"),__createBinding(exports,__webpack_require__(999),"Session"),__createBinding(exports,__webpack_require__(1003),"Publisher"),__createBinding(exports,__webpack_require__(1006),"Subscriber"),__createBinding(exports,__webpack_require__(1007),"StreamManager"),__createBinding(exports,__webpack_require__(1004),"Stream"),__createBinding(exports,__webpack_require__(1028),"Connection"),__createBinding(exports,__webpack_require__(1025),"LocalRecorder"),__createBinding(exports,__webpack_require__(1005),"Filter"),__createBinding(exports,__webpack_require__(1026),"LocalRecorderState"),__createBinding(exports,__webpack_require__(996),"OpenViduError"),__createBinding(exports,__webpack_require__(1e3),"VideoInsertMode"),__createBinding(exports,__webpack_require__(993),"Event"),__createBinding(exports,__webpack_require__(1030),"ConnectionEvent"),__createBinding(exports,__webpack_require__(1029),"PublisherSpeakingEvent"),__createBinding(exports,__webpack_require__(1032),"RecordingEvent"),__createBinding(exports,__webpack_require__(1012),"SessionDisconnectedEvent"),__createBinding(exports,__webpack_require__(1033),"SignalEvent"),__createBinding(exports,__webpack_require__(1013),"StreamEvent"),__createBinding(exports,__webpack_require__(1010),"StreamManagerEvent"),__createBinding(exports,__webpack_require__(1011),"VideoElementEvent"),__createBinding(exports,__webpack_require__(995),"StreamPropertyChangedEvent"),__createBinding(exports,__webpack_require__(1034),"ConnectionPropertyChangedEvent"),__createBinding(exports,__webpack_require__(1031),"FilterEvent"),__createBinding(exports,__webpack_require__(1035),"NetworkQualityLevelChangedEvent"),__createBinding(exports,__webpack_require__(998),"ExceptionEvent"),__createBinding(exports,__webpack_require__(1008),"EventDispatcher")},992:function(module,exports,__webpack_require__){"use strict";exports.__esModule=!0,exports.OpenViduLogger=void 0;var jsnlog_1=__webpack_require__(1089),OpenViduLoggerConfiguration_1=__webpack_require__(1027),OpenViduLogger=function(){function OpenViduLogger(){this.JSNLOG_URL="/openvidu/elk/openvidu-browser-logs",this.MAX_JSNLOG_BATCH_LOG_MESSAGES=100,this.MAX_MSECONDS_BATCH_MESSAGES=5e3,this.MAX_LENGTH_STRING_JSON=1e3,this.logger=window.console,this.LOG_FNS=[this.logger.log,this.logger.debug,this.logger.info,this.logger.warn,this.logger.error],this.isProdMode=!1,this.isJSNLogSetup=!1}return OpenViduLogger.configureJSNLog=function(openVidu,token){var _this=this;try{if(this.instance&&openVidu.webrtcStatsInterval>-1&&openVidu.sendBrowserLogs===OpenViduLoggerConfiguration_1.OpenViduLoggerConfiguration.debug&&this.instance.canConfigureJSNLog(openVidu,this.instance)){this.instance.isJSNLogSetup=!1,this.instance.info("Configuring JSNLogs.");var finalUserId_1=openVidu.finalUserId,sessionId_1=openVidu.session.sessionId;this.instance.currentAppender=jsnlog_1.JL.createAjaxAppender("appender-"+finalUserId_1+"-"+sessionId_1),this.instance.currentAppender.setOptions({beforeSend:function(xhr){var parentReadyStateFunction=xhr.onreadystatechange;xhr.onreadystatechange=function(){401!=xhr.status&&403!=xhr.status&&404!=xhr.status||(Object.defineProperty(xhr,"readyState",{value:4}),Object.defineProperty(xhr,"status",{value:200})),parentReadyStateFunction()},xhr.setRequestHeader("Authorization","Basic "+btoa(finalUserId_1+"%/%"+sessionId_1+":"+token)),xhr.setRequestHeader("X-Requested-With","XMLHttpRequest"),xhr.setRequestHeader("OV-Final-User-Id",finalUserId_1),xhr.setRequestHeader("OV-Session-Id",sessionId_1),xhr.setRequestHeader("OV-Token",token)},maxBatchSize:1e3,batchSize:this.instance.MAX_JSNLOG_BATCH_LOG_MESSAGES,batchTimeout:this.instance.MAX_MSECONDS_BATCH_MESSAGES});jsnlog_1.JL.setOptions({defaultAjaxUrl:openVidu.httpUri+this.instance.JSNLOG_URL,serialize:function(obj){var seen,stringifyJson=JSON.stringify(obj,(seen=new WeakSet,function(key,value){if("object"==typeof value&&null!=value){if(seen.has(value)||value instanceof HTMLElement)return;seen.add(value)}return value}));return stringifyJson.length>_this.instance.MAX_LENGTH_STRING_JSON?stringifyJson.substring(0,_this.instance.MAX_LENGTH_STRING_JSON)+"...":stringifyJson}}),jsnlog_1.JL().setOptions({appenders:[this.instance.currentAppender]}),this.instance.isJSNLogSetup=!0,this.instance.loggingSessionId=sessionId_1,this.instance.loggingFinalUserId=finalUserId_1,this.instance.info("JSNLog configured.")}}catch(e){console.error("Error configuring JSNLog: "),console.error(e),this.instance.isJSNLogSetup=!1,this.instance.loggingSessionId=void 0,this.instance.loggingFinalUserId=void 0,this.instance.currentAppender=void 0}},OpenViduLogger.getInstance=function(){return OpenViduLogger.instance||(OpenViduLogger.instance=new OpenViduLogger),OpenViduLogger.instance},OpenViduLogger.prototype.isDebugLogEnabled=function(){return this.isJSNLogSetup},OpenViduLogger.prototype.canConfigureJSNLog=function(openVidu,logger){return openVidu.session.sessionId!=logger.loggingSessionId},OpenViduLogger.prototype.log=function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];this.isProdMode||this.LOG_FNS[0].apply(this.logger,arguments),this.isDebugLogEnabled()&&jsnlog_1.JL().info(arguments)},OpenViduLogger.prototype.debug=function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];this.isProdMode||this.LOG_FNS[1].apply(this.logger,arguments)},OpenViduLogger.prototype.info=function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];this.isProdMode||this.LOG_FNS[2].apply(this.logger,arguments),this.isDebugLogEnabled()&&jsnlog_1.JL().info(arguments)},OpenViduLogger.prototype.warn=function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];this.isProdMode||this.LOG_FNS[3].apply(this.logger,arguments),this.isDebugLogEnabled()&&jsnlog_1.JL().warn(arguments)},OpenViduLogger.prototype.error=function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];this.LOG_FNS[4].apply(this.logger,arguments),this.isDebugLogEnabled()&&jsnlog_1.JL().error(arguments)},OpenViduLogger.prototype.flush=function(){this.isDebugLogEnabled()&&null!=this.currentAppender&&this.currentAppender.sendBatch()},OpenViduLogger.prototype.enableProdMode=function(){this.isProdMode=!0},OpenViduLogger}();exports.OpenViduLogger=OpenViduLogger},993:function(module,exports,__webpack_require__){"use strict";exports.__esModule=!0,exports.Event=void 0;var Event=function(){function Event(cancelable,target,type){this.hasBeenPrevented=!1,this.cancelable=cancelable,this.target=target,this.type=type}return Event.prototype.isDefaultPrevented=function(){return this.hasBeenPrevented},Event.prototype.preventDefault=function(){this.callDefaultBehavior=function(){},this.hasBeenPrevented=!0},Event}();exports.Event=Event},994:function(module,exports,__webpack_require__){"use strict";exports.__esModule=!0,exports.PlatformUtils=void 0;var platform=__webpack_require__(1090),PlatformUtils=function(){function PlatformUtils(){}return PlatformUtils.getInstance=function(){return this.instance||(this.instance=new PlatformUtils),PlatformUtils.instance},PlatformUtils.prototype.isChromeBrowser=function(){return"Chrome"===platform.name},PlatformUtils.prototype.isSafariBrowser=function(){return"Safari"===platform.name},PlatformUtils.prototype.isChromeMobileBrowser=function(){return"Chrome Mobile"===platform.name},PlatformUtils.prototype.isFirefoxBrowser=function(){return"Firefox"===platform.name},PlatformUtils.prototype.isFirefoxMobileBrowser=function(){return"Firefox Mobile"===platform.name},PlatformUtils.prototype.isOperaBrowser=function(){return"Opera"===platform.name},PlatformUtils.prototype.isOperaMobileBrowser=function(){return"Opera Mobile"===platform.name},PlatformUtils.prototype.isEdgeBrowser=function(){var version=(null==platform?void 0:platform.version)?parseFloat(platform.version):-1;return"Microsoft Edge"===platform.name&&version>=80},PlatformUtils.prototype.isEdgeMobileBrowser=function(){var _a,version=(null==platform?void 0:platform.version)?parseFloat(platform.version):-1;return"Microsoft Edge"===platform.name&&"Android"===(null===(_a=platform.os)||void 0===_a?void 0:_a.family)&&version>45},PlatformUtils.prototype.isAndroidBrowser=function(){return"Android Browser"===platform.name},PlatformUtils.prototype.isElectron=function(){return"Electron"===platform.name},PlatformUtils.prototype.isSamsungBrowser=function(){return"Samsung Internet Mobile"===platform.name||"Samsung Internet"===platform.name},PlatformUtils.prototype.isIPhoneOrIPad=function(){var userAgent=platform.ua?platform.ua:navigator.userAgent,isTouchable="ontouchend"in document,isIPad=/\b(\w*Macintosh\w*)\b/.test(userAgent)&&isTouchable,isIPhone=/\b(\w*iPhone\w*)\b/.test(userAgent)&&/\b(\w*Mobile\w*)\b/.test(userAgent)&&isTouchable;return isIPad||isIPhone},PlatformUtils.prototype.isIOSWithSafari=function(){var userAgent=platform.ua?platform.ua:navigator.userAgent;return this.isIPhoneOrIPad()&&/\b(\w*Apple\w*)\b/.test(navigator.vendor)&&/\b(\w*Safari\w*)\b/.test(userAgent)&&!/\b(\w*CriOS\w*)\b/.test(userAgent)&&!/\b(\w*FxiOS\w*)\b/.test(userAgent)},PlatformUtils.prototype.isIonicIos=function(){return this.isIPhoneOrIPad()&&-1===platform.ua.indexOf("Safari")},PlatformUtils.prototype.isIonicAndroid=function(){return"Android"===platform.os.family&&"Android Browser"==platform.name},PlatformUtils.prototype.isMobileDevice=function(){return"iOS"===platform.os.family||"Android"===platform.os.family},PlatformUtils.prototype.isReactNative=function(){return!1},PlatformUtils.prototype.isChromium=function(){return this.isChromeBrowser()||this.isChromeMobileBrowser()||this.isOperaBrowser()||this.isOperaMobileBrowser()||this.isEdgeBrowser()||this.isEdgeMobileBrowser()||this.isSamsungBrowser()||this.isIonicAndroid()||this.isIonicIos()||this.isElectron()},PlatformUtils.prototype.canScreenShare=function(){var version=(null==platform?void 0:platform.version)?parseFloat(platform.version):-1;return!this.isMobileDevice()&&(this.isChromeBrowser()||this.isFirefoxBrowser()||this.isOperaBrowser()||this.isElectron()||this.isEdgeBrowser()||this.isSafariBrowser()&&version>=13)},PlatformUtils.prototype.getName=function(){return platform.name||""},PlatformUtils.prototype.getVersion=function(){return platform.version||""},PlatformUtils.prototype.getFamily=function(){return platform.os.family||""},PlatformUtils.prototype.getDescription=function(){return platform.description||""},PlatformUtils}();exports.PlatformUtils=PlatformUtils},995:function(module,exports,__webpack_require__){"use strict";var extendStatics,__extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)});exports.__esModule=!0,exports.StreamPropertyChangedEvent=void 0;var StreamPropertyChangedEvent=function(_super){function StreamPropertyChangedEvent(target,stream,changedProperty,newValue,oldValue,reason){var _this=_super.call(this,!1,target,"streamPropertyChanged")||this;return _this.stream=stream,_this.changedProperty=changedProperty,_this.newValue=newValue,_this.oldValue=oldValue,_this.reason=reason,_this}return __extends(StreamPropertyChangedEvent,_super),StreamPropertyChangedEvent.prototype.callDefaultBehavior=function(){},StreamPropertyChangedEvent}(__webpack_require__(993).Event);exports.StreamPropertyChangedEvent=StreamPropertyChangedEvent},996:function(module,exports,__webpack_require__){"use strict";exports.__esModule=!0,exports.OpenViduError=exports.OpenViduErrorName=void 0,function(OpenViduErrorName){OpenViduErrorName.BROWSER_NOT_SUPPORTED="BROWSER_NOT_SUPPORTED",OpenViduErrorName.DEVICE_ACCESS_DENIED="DEVICE_ACCESS_DENIED",OpenViduErrorName.DEVICE_ALREADY_IN_USE="DEVICE_ALREADY_IN_USE",OpenViduErrorName.SCREEN_CAPTURE_DENIED="SCREEN_CAPTURE_DENIED",OpenViduErrorName.SCREEN_SHARING_NOT_SUPPORTED="SCREEN_SHARING_NOT_SUPPORTED",OpenViduErrorName.SCREEN_EXTENSION_NOT_INSTALLED="SCREEN_EXTENSION_NOT_INSTALLED",OpenViduErrorName.SCREEN_EXTENSION_DISABLED="SCREEN_EXTENSION_DISABLED",OpenViduErrorName.INPUT_VIDEO_DEVICE_NOT_FOUND="INPUT_VIDEO_DEVICE_NOT_FOUND",OpenViduErrorName.INPUT_AUDIO_DEVICE_NOT_FOUND="INPUT_AUDIO_DEVICE_NOT_FOUND",OpenViduErrorName.INPUT_AUDIO_DEVICE_GENERIC_ERROR="INPUT_AUDIO_DEVICE_GENERIC_ERROR",OpenViduErrorName.NO_INPUT_SOURCE_SET="NO_INPUT_SOURCE_SET",OpenViduErrorName.PUBLISHER_PROPERTIES_ERROR="PUBLISHER_PROPERTIES_ERROR",OpenViduErrorName.OPENVIDU_PERMISSION_DENIED="OPENVIDU_PERMISSION_DENIED",OpenViduErrorName.OPENVIDU_NOT_CONNECTED="OPENVIDU_NOT_CONNECTED",OpenViduErrorName.GENERIC_ERROR="GENERIC_ERROR"}(exports.OpenViduErrorName||(exports.OpenViduErrorName={}));var OpenViduError=function OpenViduError(name,message){this.name=name,this.message=message};exports.OpenViduError=OpenViduError},998:function(module,exports,__webpack_require__){"use strict";var extendStatics,__extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)});exports.__esModule=!0,exports.ExceptionEvent=exports.ExceptionEventName=void 0;var Event_1=__webpack_require__(993);!function(ExceptionEventName){ExceptionEventName.ICE_CANDIDATE_ERROR="ICE_CANDIDATE_ERROR",ExceptionEventName.ICE_CONNECTION_FAILED="ICE_CONNECTION_FAILED",ExceptionEventName.ICE_CONNECTION_DISCONNECTED="ICE_CONNECTION_DISCONNECTED",ExceptionEventName.NO_STREAM_PLAYING_EVENT="NO_STREAM_PLAYING_EVENT"}(exports.ExceptionEventName||(exports.ExceptionEventName={}));var ExceptionEvent=function(_super){function ExceptionEvent(session,name,origin,message,data){var _this=_super.call(this,!1,session,"exception")||this;return _this.name=name,_this.origin=origin,_this.message=message,_this.data=data,_this}return __extends(ExceptionEvent,_super),ExceptionEvent.prototype.callDefaultBehavior=function(){},ExceptionEvent}(Event_1.Event);exports.ExceptionEvent=ExceptionEvent},999:function(module,exports,__webpack_require__){"use strict";var extendStatics,__extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}),__awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},__generator=this&&this.__generator||function(thisArg,body){var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=_.trys,(t=t.length>0&&t[t.length-1])||6!==op[0]&&2!==op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}};exports.__esModule=!0,exports.Session=void 0;var platform,Connection_1=__webpack_require__(1028),Filter_1=__webpack_require__(1005),Subscriber_1=__webpack_require__(1006),EventDispatcher_1=__webpack_require__(1008),ConnectionEvent_1=__webpack_require__(1030),FilterEvent_1=__webpack_require__(1031),RecordingEvent_1=__webpack_require__(1032),SessionDisconnectedEvent_1=__webpack_require__(1012),SignalEvent_1=__webpack_require__(1033),StreamEvent_1=__webpack_require__(1013),StreamPropertyChangedEvent_1=__webpack_require__(995),ConnectionPropertyChangedEvent_1=__webpack_require__(1034),NetworkQualityLevelChangedEvent_1=__webpack_require__(1035),OpenViduError_1=__webpack_require__(996),VideoInsertMode_1=__webpack_require__(1e3),OpenViduLogger_1=__webpack_require__(992),Platform_1=__webpack_require__(994),logger=OpenViduLogger_1.OpenViduLogger.getInstance(),Session=function(_super){function Session(openvidu){var _this=_super.call(this)||this;return _this.streamManagers=[],_this.remoteStreamsCreated=new Map,_this.remoteConnections=new Map,platform=Platform_1.PlatformUtils.getInstance(),_this.openvidu=openvidu,_this}return __extends(Session,_super),Session.prototype.connect=function(token,metadata){var _this=this;return new Promise((function(resolve,reject){_this.processToken(token),_this.openvidu.checkSystemRequirements()?(_this.options={sessionId:_this.sessionId,participantId:token,metadata:metadata?_this.stringClientMetadata(metadata):""},_this.connectAux(token).then((function(){resolve()})).catch((function(error){reject(error)}))):reject(new OpenViduError_1.OpenViduError(OpenViduError_1.OpenViduErrorName.BROWSER_NOT_SUPPORTED,"Browser "+platform.getName()+" (version "+platform.getVersion()+") for "+platform.getFamily()+" is not supported in OpenVidu"))}))},Session.prototype.disconnect=function(){this.leave(!1,"disconnect")},Session.prototype.subscribe=function(stream,targetElement,param3,param4){var properties={};properties=param3&&"function"!=typeof param3?{insertMode:void 0!==param3.insertMode?"string"==typeof param3.insertMode?VideoInsertMode_1.VideoInsertMode[param3.insertMode]:properties.insertMode:VideoInsertMode_1.VideoInsertMode.APPEND,subscribeToAudio:void 0===param3.subscribeToAudio||param3.subscribeToAudio,subscribeToVideo:void 0===param3.subscribeToVideo||param3.subscribeToVideo}:{insertMode:VideoInsertMode_1.VideoInsertMode.APPEND,subscribeToAudio:!0,subscribeToVideo:!0};var completionHandler=void 0;if(param3&&"function"==typeof param3?completionHandler=param3:param4&&(completionHandler=param4),!this.sessionConnected())throw void 0!==completionHandler&&completionHandler(this.notConnectedError()),this.notConnectedError();logger.info("Subscribing to "+stream.connection.connectionId),stream.subscribe().then((function(){logger.info("Subscribed correctly to "+stream.connection.connectionId),void 0!==completionHandler&&completionHandler(void 0)})).catch((function(error){void 0!==completionHandler&&completionHandler(error)}));var subscriber=new Subscriber_1.Subscriber(stream,targetElement,properties);return subscriber.targetElement&&stream.streamManager.createVideoElement(subscriber.targetElement,properties.insertMode),subscriber},Session.prototype.subscribeAsync=function(stream,targetElement,properties){var _this=this;return new Promise((function(resolve,reject){var subscriber;_this.sessionConnected()||reject(_this.notConnectedError());var callback=function(error){error?reject(error):resolve(subscriber)};subscriber=properties?_this.subscribe(stream,targetElement,properties,callback):_this.subscribe(stream,targetElement,callback)}))},Session.prototype.unsubscribe=function(subscriber){var _this=this;return new Promise((function(resolve,reject){if(_this.sessionConnected()){var connectionId_1=subscriber.stream.connection.connectionId;logger.info("Unsubscribing from "+connectionId_1),_this.openvidu.sendRequest("unsubscribeFromVideo",{sender:subscriber.stream.connection.connectionId},(function(error,response){error?(logger.error("Error unsubscribing from "+connectionId_1),reject(error)):(logger.info("Unsubscribed correctly from "+connectionId_1),subscriber.stream.streamManager.removeAllVideos(),subscriber.stream.disposeWebRtcPeer(),subscriber.stream.disposeMediaStream(),resolve())}))}else reject(_this.notConnectedError())}))},Session.prototype.publish=function(publisher){var _this=this;return new Promise((function(resolve,reject){_this.sessionConnected()||reject(_this.notConnectedError()),publisher.session=_this,publisher.stream.session=_this,publisher.stream.publishedOnce?publisher.initialize().then((function(){_this.connection.addStream(publisher.stream),publisher.reestablishStreamPlayingEvent(),publisher.stream.publish().then((function(){_this.sendVideoData(publisher,8,!0,5),resolve()})).catch((function(error){reject(error)}))})).catch((function(error){reject(error)})):(_this.connection.addStream(publisher.stream),publisher.stream.publish().then((function(){_this.sendVideoData(publisher,8,!0,5),resolve()})).catch((function(error){reject(error)})))}))},Session.prototype.unpublish=function(publisher){var _this=this;return new Promise((function(resolve,reject){if(!_this.sessionConnected())throw _this.notConnectedError();var stream=publisher.stream;stream.connection?stream.connection!==_this.connection?reject(new Error("The associated Connection object of this Publisher is not your local Connection.Only moderators can force unpublish on remote Streams via 'forceUnpublish' method")):(logger.info("Unpublishing local media ("+stream.connection.connectionId+")"),_this.openvidu.sendRequest("unpublishVideo",(function(error,response){if(error)reject(error);else{logger.info("Media unpublished correctly"),stream.disposeWebRtcPeer(),stream.connection.stream==stream&&delete stream.connection.stream;var streamEvent=new StreamEvent_1.StreamEvent(!0,publisher,"streamDestroyed",publisher.stream,"unpublish");publisher.emitEvent("streamDestroyed",[streamEvent]),streamEvent.callDefaultBehavior(),resolve()}}))):reject(new Error("The associated Connection object of this Publisher is null"))}))},Session.prototype.forceDisconnect=function(connection){var _this=this;return new Promise((function(resolve,reject){_this.sessionConnected()||reject(_this.notConnectedError()),logger.info("Forcing disconnect for connection "+connection.connectionId),_this.openvidu.sendRequest("forceDisconnect",{connectionId:connection.connectionId},(function(error,response){error?(logger.error("Error forcing disconnect for Connection "+connection.connectionId,error),401===error.code?reject(new OpenViduError_1.OpenViduError(OpenViduError_1.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to force a disconnection")):reject(error)):(logger.info("Forcing disconnect correctly for Connection "+connection.connectionId),resolve())}))}))},Session.prototype.forceUnpublish=function(stream){var _this=this;return new Promise((function(resolve,reject){_this.sessionConnected()||reject(_this.notConnectedError()),logger.info("Forcing unpublish for stream "+stream.streamId),_this.openvidu.sendRequest("forceUnpublish",{streamId:stream.streamId},(function(error,response){error?(logger.error("Error forcing unpublish for Stream "+stream.streamId,error),401===error.code?reject(new OpenViduError_1.OpenViduError(OpenViduError_1.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to force an unpublishing")):reject(error)):(logger.info("Forcing unpublish correctly for Stream "+stream.streamId),resolve())}))}))},Session.prototype.signal=function(signal){var _this=this;return new Promise((function(resolve,reject){_this.sessionConnected()||reject(_this.notConnectedError());var signalMessage={};if(signal.to&&signal.to.length>0){var connectionIds_1=[];signal.to.forEach((function(connection){connection.connectionId&&connectionIds_1.push(connection.connectionId)})),signalMessage.to=connectionIds_1}else signalMessage.to=[];signalMessage.data=signal.data?signal.data:"";var typeAux=signal.type?signal.type:"signal";typeAux&&"signal:"!==typeAux.substring(0,7)&&(typeAux="signal:"+typeAux),signalMessage.type=typeAux,_this.openvidu.sendRequest("sendMessage",{message:JSON.stringify(signalMessage)},(function(error,response){error?reject(error):resolve()}))}))},Session.prototype.on=function(type,handler){var _a,_b,_c,_d;return _super.prototype.onAux.call(this,type,"Event '"+type+"' triggered by 'Session'",handler),"publisherStartSpeaking"===type&&(this.remoteConnections.forEach((function(remoteConnection){var _a;(null===(_a=remoteConnection.stream)||void 0===_a?void 0:_a.hasAudio)&&remoteConnection.stream.enableHarkSpeakingEvent()})),(null===(_b=null===(_a=this.connection)||void 0===_a?void 0:_a.stream)||void 0===_b?void 0:_b.hasAudio)&&this.connection.stream.enableHarkSpeakingEvent()),"publisherStopSpeaking"===type&&(this.remoteConnections.forEach((function(remoteConnection){var _a;(null===(_a=remoteConnection.stream)||void 0===_a?void 0:_a.hasAudio)&&remoteConnection.stream.enableHarkStoppedSpeakingEvent()})),(null===(_d=null===(_c=this.connection)||void 0===_c?void 0:_c.stream)||void 0===_d?void 0:_d.hasAudio)&&this.connection.stream.enableHarkStoppedSpeakingEvent()),this},Session.prototype.once=function(type,handler){var _a,_b,_c,_d;return _super.prototype.onceAux.call(this,type,"Event '"+type+"' triggered once by 'Session'",handler),"publisherStartSpeaking"===type&&(this.remoteConnections.forEach((function(remoteConnection){var _a;(null===(_a=remoteConnection.stream)||void 0===_a?void 0:_a.hasAudio)&&remoteConnection.stream.enableOnceHarkSpeakingEvent()})),(null===(_b=null===(_a=this.connection)||void 0===_a?void 0:_a.stream)||void 0===_b?void 0:_b.hasAudio)&&this.connection.stream.enableOnceHarkSpeakingEvent()),"publisherStopSpeaking"===type&&(this.remoteConnections.forEach((function(remoteConnection){var _a;(null===(_a=remoteConnection.stream)||void 0===_a?void 0:_a.hasAudio)&&remoteConnection.stream.enableOnceHarkStoppedSpeakingEvent()})),(null===(_d=null===(_c=this.connection)||void 0===_c?void 0:_c.stream)||void 0===_d?void 0:_d.hasAudio)&&this.connection.stream.enableOnceHarkStoppedSpeakingEvent()),this},Session.prototype.off=function(type,handler){var _a,_b,_c,_d,_this=this;return _super.prototype.off.call(this,type,handler),"publisherStartSpeaking"===type&&(this.anySpeechEventListenerEnabled("publisherStartSpeaking",!1)||(this.remoteConnections.forEach((function(remoteConnection){var _a;(null===(_a=remoteConnection.stream)||void 0===_a?void 0:_a.streamManager)&&(_this.anySpeechEventListenerEnabled("publisherStartSpeaking",!1,remoteConnection.stream.streamManager)||remoteConnection.stream.disableHarkSpeakingEvent(!1))})),(null===(_b=null===(_a=this.connection)||void 0===_a?void 0:_a.stream)||void 0===_b?void 0:_b.streamManager)&&(this.anySpeechEventListenerEnabled("publisherStartSpeaking",!1,this.connection.stream.streamManager)||this.connection.stream.disableHarkSpeakingEvent(!1)))),"publisherStopSpeaking"===type&&(this.anySpeechEventListenerEnabled("publisherStopSpeaking",!1)||(this.remoteConnections.forEach((function(remoteConnection){var _a;(null===(_a=remoteConnection.stream)||void 0===_a?void 0:_a.streamManager)&&(_this.anySpeechEventListenerEnabled("publisherStopSpeaking",!1,remoteConnection.stream.streamManager)||remoteConnection.stream.disableHarkStoppedSpeakingEvent(!1))})),(null===(_d=null===(_c=this.connection)||void 0===_c?void 0:_c.stream)||void 0===_d?void 0:_d.streamManager)&&(this.anySpeechEventListenerEnabled("publisherStopSpeaking",!1,this.connection.stream.streamManager)||this.connection.stream.disableHarkStoppedSpeakingEvent(!1)))),this},Session.prototype.onParticipantJoined=function(response){var _this=this;this.getConnection(response.id,"").then((function(connection){logger.warn("Connection "+response.id+" already exists in connections list")})).catch((function(openViduError){var connection=new Connection_1.Connection(_this,response);_this.remoteConnections.set(response.id,connection),_this.ee.emitEvent("connectionCreated",[new ConnectionEvent_1.ConnectionEvent(!1,_this,"connectionCreated",connection,"")])}))},Session.prototype.onParticipantLeft=function(msg){var _this=this;this.remoteConnections.size>0&&this.getRemoteConnection(msg.connectionId,"onParticipantLeft").then((function(connection){if(connection.stream){var stream=connection.stream,streamEvent=new StreamEvent_1.StreamEvent(!0,_this,"streamDestroyed",stream,msg.reason);_this.ee.emitEvent("streamDestroyed",[streamEvent]),streamEvent.callDefaultBehavior(),_this.remoteStreamsCreated.delete(stream.streamId)}_this.remoteConnections.delete(connection.connectionId),_this.ee.emitEvent("connectionDestroyed",[new ConnectionEvent_1.ConnectionEvent(!1,_this,"connectionDestroyed",connection,msg.reason)])})).catch((function(openViduError){logger.error(openViduError)}))},Session.prototype.onParticipantPublished=function(response){var connection,_this=this,afterConnectionFound=function(connection){_this.remoteConnections.set(connection.connectionId,connection),_this.remoteStreamsCreated.get(connection.stream.streamId)||_this.ee.emitEvent("streamCreated",[new StreamEvent_1.StreamEvent(!1,_this,"streamCreated",connection.stream,"")]),_this.remoteStreamsCreated.set(connection.stream.streamId,!0)};this.getRemoteConnection(response.id,"onParticipantPublished").then((function(con){connection=con,response.metadata=con.data,connection.remoteOptions=response,connection.initRemoteStreams(response.streams),afterConnectionFound(connection)})).catch((function(openViduError){connection=new Connection_1.Connection(_this,response),afterConnectionFound(connection)}))},Session.prototype.onParticipantUnpublished=function(msg){var _this=this;msg.connectionId===this.connection.connectionId?this.stopPublisherStream(msg.reason):this.getRemoteConnection(msg.connectionId,"onParticipantUnpublished").then((function(connection){var streamEvent=new StreamEvent_1.StreamEvent(!0,_this,"streamDestroyed",connection.stream,msg.reason);_this.ee.emitEvent("streamDestroyed",[streamEvent]),streamEvent.callDefaultBehavior();var streamId=connection.stream.streamId;_this.remoteStreamsCreated.delete(streamId),connection.removeStream(streamId)})).catch((function(openViduError){logger.error(openViduError)}))},Session.prototype.onParticipantEvicted=function(msg){msg.connectionId===this.connection.connectionId&&this.sessionId&&!this.connection.disposed&&this.leave(!0,msg.reason)},Session.prototype.onNewMessage=function(msg){var _this=this;logger.info("New signal: "+JSON.stringify(msg));var strippedType=msg.type?msg.type.replace(/^(signal:)/,""):void 0;msg.from?this.getConnection(msg.from,"Connection '"+msg.from+"' unknown when 'onNewMessage'. Existing remote connections: "+JSON.stringify(this.remoteConnections.keys())+". Existing local connection: "+this.connection.connectionId).then((function(connection){_this.ee.emitEvent("signal",[new SignalEvent_1.SignalEvent(_this,strippedType,msg.data,connection)]),"signal"!==msg.type&&_this.ee.emitEvent(msg.type,[new SignalEvent_1.SignalEvent(_this,strippedType,msg.data,connection)])})).catch((function(openViduError){logger.error(openViduError)})):(this.ee.emitEvent("signal",[new SignalEvent_1.SignalEvent(this,strippedType,msg.data,void 0)]),"signal"!==msg.type&&this.ee.emitEvent(msg.type,[new SignalEvent_1.SignalEvent(this,strippedType,msg.data,void 0)]))},Session.prototype.onStreamPropertyChanged=function(msg){var _this=this,callback=function(connection){if(connection.stream&&connection.stream.streamId===msg.streamId){var stream=connection.stream,oldValue=void 0;switch(msg.property){case"audioActive":oldValue=stream.audioActive,msg.newValue="true"===msg.newValue,stream.audioActive=msg.newValue;break;case"videoActive":oldValue=stream.videoActive,msg.newValue="true"===msg.newValue,stream.videoActive=msg.newValue;break;case"videoDimensions":oldValue=stream.videoDimensions,msg.newValue=JSON.parse(JSON.parse(msg.newValue)),stream.videoDimensions=msg.newValue;break;case"filter":oldValue=stream.filter,msg.newValue=Object.keys(msg.newValue).length>0?msg.newValue:void 0,void 0!==msg.newValue?(stream.filter=new Filter_1.Filter(msg.newValue.type,msg.newValue.options),stream.filter.stream=stream,msg.newValue.lastExecMethod&&(stream.filter.lastExecMethod=msg.newValue.lastExecMethod)):delete stream.filter,msg.newValue=stream.filter}_this.ee.emitEvent("streamPropertyChanged",[new StreamPropertyChangedEvent_1.StreamPropertyChangedEvent(_this,stream,msg.property,msg.newValue,oldValue,msg.reason)]),stream.streamManager&&stream.streamManager.emitEvent("streamPropertyChanged",[new StreamPropertyChangedEvent_1.StreamPropertyChangedEvent(stream.streamManager,stream,msg.property,msg.newValue,oldValue,msg.reason)])}else logger.error("No stream with streamId '"+msg.streamId+"' found for connection '"+msg.connectionId+"' on 'streamPropertyChanged' event")};msg.connectionId===this.connection.connectionId?callback(this.connection):this.getRemoteConnection(msg.connectionId,"onStreamPropertyChanged").then((function(connection){callback(connection)})).catch((function(openViduError){logger.error(openViduError)}))},Session.prototype.onConnectionPropertyChanged=function(msg){var oldValue;switch(msg.property){case"role":oldValue=this.connection.role.slice(),this.connection.role=msg.newValue,this.connection.localOptions.role=msg.newValue;break;case"record":oldValue=this.connection.record,msg.newValue="true"===msg.newValue,this.connection.record=msg.newValue,this.connection.localOptions.record=msg.newValue}this.ee.emitEvent("connectionPropertyChanged",[new ConnectionPropertyChangedEvent_1.ConnectionPropertyChangedEvent(this,this.connection,msg.property,msg.newValue,oldValue)])},Session.prototype.onNetworkQualityLevelChangedChanged=function(msg){var _this=this;msg.connectionId===this.connection.connectionId?this.ee.emitEvent("networkQualityLevelChanged",[new NetworkQualityLevelChangedEvent_1.NetworkQualityLevelChangedEvent(this,msg.newValue,msg.oldValue,this.connection)]):this.getConnection(msg.connectionId,"Connection not found for connectionId "+msg.connectionId).then((function(connection){_this.ee.emitEvent("networkQualityLevelChanged",[new NetworkQualityLevelChangedEvent_1.NetworkQualityLevelChangedEvent(_this,msg.newValue,msg.oldValue,connection)])})).catch((function(openViduError){logger.error(openViduError)}))},Session.prototype.recvIceCandidate=function(msg){var candidate={candidate:msg.candidate,component:msg.component,foundation:msg.foundation,port:msg.port,priority:msg.priority,protocol:msg.protocol,relatedAddress:msg.relatedAddress,relatedPort:msg.relatedPort,sdpMid:msg.sdpMid,sdpMLineIndex:msg.sdpMLineIndex,tcpType:msg.tcpType,usernameFragment:msg.usernameFragment,type:msg.type,toJSON:function(){return{candidate:msg.candidate}}};this.getConnection(msg.senderConnectionId,"Connection not found for connectionId "+msg.senderConnectionId+" owning endpoint "+msg.endpointName+". Ice candidate will be ignored: "+candidate).then((function(connection){var stream=connection.stream;stream.getWebRtcPeer().addIceCandidate(candidate).catch((function(error){logger.error("Error adding candidate for "+stream.streamId+" stream of endpoint "+msg.endpointName+": "+error)}))})).catch((function(openViduError){logger.error(openViduError)}))},Session.prototype.onSessionClosed=function(msg){logger.info("Session closed: "+JSON.stringify(msg));var s=msg.sessionId;void 0!==s?this.ee.emitEvent("session-closed",[{session:s}]):logger.warn("Session undefined on session closed",msg)},Session.prototype.onLostConnection=function(reason){logger.warn("Lost connection in Session "+this.sessionId),this.sessionId&&this.connection&&!this.connection.disposed&&this.leave(!0,reason)},Session.prototype.onRecoveredConnection=function(){logger.info("Recovered connection in Session "+this.sessionId),this.reconnectBrokenStreams(),this.ee.emitEvent("reconnected",[])},Session.prototype.onMediaError=function(params){logger.error("Media error: "+JSON.stringify(params));var err=params.error;err?this.ee.emitEvent("error-media",[{error:err}]):logger.warn("Received undefined media error. Params:",params)},Session.prototype.onRecordingStarted=function(response){this.ee.emitEvent("recordingStarted",[new RecordingEvent_1.RecordingEvent(this,"recordingStarted",response.id,response.name)])},Session.prototype.onRecordingStopped=function(response){this.ee.emitEvent("recordingStopped",[new RecordingEvent_1.RecordingEvent(this,"recordingStopped",response.id,response.name,response.reason)])},Session.prototype.onFilterEventDispatched=function(response){var _this=this,connectionId=response.connectionId;response.streamId;this.getConnection(connectionId,"No connection found for connectionId "+connectionId).then((function(connection){var _a;logger.info("Filter event dispatched");var stream=connection.stream;null===(_a=stream.filter.handlers.get(response.eventType))||void 0===_a||_a.call(_this,new FilterEvent_1.FilterEvent(stream.filter,response.eventType,response.data))}))},Session.prototype.reconnectBrokenStreams=function(){logger.info("Re-establishing media connections...");var someReconnection=!1;this.connection.stream&&this.connection.stream.streamIceConnectionStateBroken()&&(logger.warn("Re-establishing Publisher "+this.connection.stream.streamId),this.connection.stream.initWebRtcPeerSend(!0),someReconnection=!0),this.remoteConnections.forEach((function(remoteConnection){remoteConnection.stream&&remoteConnection.stream.streamIceConnectionStateBroken()&&(logger.warn("Re-establishing Subscriber "+remoteConnection.stream.streamId),remoteConnection.stream.initWebRtcPeerReceive(!0),someReconnection=!0)})),someReconnection||logger.info("There were no media streams in need of a reconnection")},Session.prototype.emitEvent=function(type,eventArray){this.ee.emitEvent(type,eventArray)},Session.prototype.leave=function(forced,reason){var _this=this;if(forced=!!forced,logger.info("Leaving Session (forced="+forced+")"),this.stopVideoDataIntervals(),this.connection){if(this.connection.disposed||forced?this.openvidu.closeWs():this.openvidu.sendRequest("leaveRoom",(function(error,response){error&&logger.error(error),_this.openvidu.closeWs()})),this.stopPublisherStream(reason),!this.connection.disposed){var sessionDisconnectEvent=new SessionDisconnectedEvent_1.SessionDisconnectedEvent(this,reason);this.ee.emitEvent("sessionDisconnected",[sessionDisconnectEvent]),sessionDisconnectEvent.callDefaultBehavior()}}else logger.warn("You were not connected to the session "+this.sessionId);logger.flush()},Session.prototype.initializeParams=function(token){return{token:token||"",session:this.sessionId,platform:platform.getDescription()?platform.getDescription():"unknown",metadata:this.options.metadata?this.options.metadata:"",secret:this.openvidu.getSecret(),recorder:this.openvidu.getRecorder()}},Session.prototype.sendVideoData=function(streamManager,intervalSeconds,doInterval,maxLoops){var _a,_b,_this=this;if(void 0===intervalSeconds&&(intervalSeconds=1),void 0===doInterval&&(doInterval=!1),void 0===maxLoops&&(maxLoops=1),platform.isChromeBrowser()||platform.isChromeMobileBrowser()||platform.isOperaBrowser()||platform.isOperaMobileBrowser()||platform.isEdgeBrowser()||platform.isEdgeMobileBrowser()||platform.isElectron()||platform.isSafariBrowser()&&!platform.isIonicIos()||platform.isAndroidBrowser()||platform.isSamsungBrowser()||platform.isIonicAndroid()||platform.isIOSWithSafari()){var obtainAndSendVideo_1=function(){return __awaiter(_this,void 0,void 0,(function(){var pc,statsMap,arr_1;return __generator(this,(function(_a){switch(_a.label){case 0:return"connected"!==(pc=streamManager.stream.getRTCPeerConnection()).connectionState?[3,2]:[4,pc.getStats()];case 1:statsMap=_a.sent(),arr_1=[],statsMap.forEach((function(stats){"frameWidth"in stats&&"frameHeight"in stats&&0===arr_1.length&&arr_1.push(stats)})),arr_1.length>0&&this.openvidu.sendRequest("videoData",{height:arr_1[0].frameHeight,width:arr_1[0].frameWidth,videoActive:null!=streamManager.stream.videoActive&&streamManager.stream.videoActive,audioActive:null!=streamManager.stream.audioActive&&streamManager.stream.audioActive},(function(error,response){error&&logger.error("Error sending 'videoData' event",error)})),_a.label=2;case 2:return[2]}}))}))};if(doInterval){var loops_1=1;this.videoDataInterval=setInterval((function(){loops_1<maxLoops?(loops_1++,obtainAndSendVideo_1()):clearInterval(_this.videoDataInterval)}),1e3*intervalSeconds)}else this.videoDataTimeout=setTimeout(obtainAndSendVideo_1,1e3*intervalSeconds)}else platform.isFirefoxBrowser()||platform.isFirefoxMobileBrowser()||platform.isIonicIos()||platform.isReactNative()?this.openvidu.sendRequest("videoData",{height:(null===(_a=streamManager.stream.videoDimensions)||void 0===_a?void 0:_a.height)||0,width:(null===(_b=streamManager.stream.videoDimensions)||void 0===_b?void 0:_b.width)||0,videoActive:null!=streamManager.stream.videoActive&&streamManager.stream.videoActive,audioActive:null!=streamManager.stream.audioActive&&streamManager.stream.audioActive},(function(error,response){error&&logger.error("Error sending 'videoData' event",error)})):logger.error("Browser "+platform.getName()+" (version "+platform.getVersion()+") for "+platform.getFamily()+" is not supported in OpenVidu for Network Quality")},Session.prototype.sessionConnected=function(){return null!=this.connection},Session.prototype.notConnectedError=function(){return new OpenViduError_1.OpenViduError(OpenViduError_1.OpenViduErrorName.OPENVIDU_NOT_CONNECTED,"There is no connection to the session. Method 'Session.connect' must be successfully completed first")},Session.prototype.anySpeechEventListenerEnabled=function(event,onlyOnce,streamManager){var handlersInSession=this.ee.getListeners(event);if(onlyOnce&&(handlersInSession=handlersInSession.filter((function(h){return h.once}))),handlersInSession.length>0)return!0;var listenersInStreamManager=0;if(streamManager){var handlersInStreamManager=streamManager.ee.getListeners(event);onlyOnce&&(handlersInStreamManager=handlersInStreamManager.filter((function(h){return h.once}))),listenersInStreamManager=handlersInStreamManager.length}return listenersInStreamManager>0},Session.prototype.connectAux=function(token){var _this=this;return new Promise((function(resolve,reject){_this.openvidu.startWs((function(error){if(error)reject(error);else{var joinParams=_this.initializeParams(token);_this.openvidu.sendRequest("joinRoom",joinParams,(function(error,response){if(error)reject(error);else{_this.processJoinRoomResponse(response),OpenViduLogger_1.OpenViduLogger.configureJSNLog(_this.openvidu,token),_this.connection=new Connection_1.Connection(_this,response);var events_1={connections:new Array,streams:new Array};response.value.forEach((function(remoteConnectionOptions){var connection=new Connection_1.Connection(_this,remoteConnectionOptions);_this.remoteConnections.set(connection.connectionId,connection),events_1.connections.push(connection),connection.stream&&(_this.remoteStreamsCreated.set(connection.stream.streamId,!0),events_1.streams.push(connection.stream))})),_this.ee.emitEvent("connectionCreated",[new ConnectionEvent_1.ConnectionEvent(!1,_this,"connectionCreated",_this.connection,"")]),events_1.connections.forEach((function(connection){_this.ee.emitEvent("connectionCreated",[new ConnectionEvent_1.ConnectionEvent(!1,_this,"connectionCreated",connection,"")])})),events_1.streams.forEach((function(stream){_this.ee.emitEvent("streamCreated",[new StreamEvent_1.StreamEvent(!1,_this,"streamCreated",stream,"")])})),resolve()}}))}}))}))},Session.prototype.stopPublisherStream=function(reason){this.connection.stream&&(this.connection.stream.disposeWebRtcPeer(),this.connection.stream.isLocalStreamPublished&&this.connection.stream.ee.emitEvent("local-stream-destroyed",[reason]))},Session.prototype.stopVideoDataIntervals=function(){clearInterval(this.videoDataInterval),clearTimeout(this.videoDataTimeout)},Session.prototype.stringClientMetadata=function(metadata){return"string"!=typeof metadata?JSON.stringify(metadata):metadata},Session.prototype.getConnection=function(connectionId,errorMessage){var _this=this;return new Promise((function(resolve,reject){var connection=_this.remoteConnections.get(connectionId);connection?resolve(connection):_this.connection.connectionId===connectionId?resolve(_this.connection):reject(new OpenViduError_1.OpenViduError(OpenViduError_1.OpenViduErrorName.GENERIC_ERROR,errorMessage))}))},Session.prototype.getRemoteConnection=function(connectionId,operation){var _this=this;return new Promise((function(resolve,reject){var connection=_this.remoteConnections.get(connectionId);if(connection)resolve(connection);else{var errorMessage="Remote connection "+connectionId+" unknown when '"+operation+"'. Existing remote connections: "+JSON.stringify(_this.remoteConnections.keys());reject(new OpenViduError_1.OpenViduError(OpenViduError_1.OpenViduErrorName.GENERIC_ERROR,errorMessage))}}))},Session.prototype.processToken=function(token){var match=token.match(/^(wss?\:)\/\/(([^:\/?#]*)(?:\:([0-9]+))?)([\/]{0,1}[^?#]*)(\?[^#]*|)(#.*|)$/);if(match){var url={protocol:match[1],host:match[2],hostname:match[3],port:match[4],pathname:match[5],search:match[6],hash:match[7]},params=token.split("?"),queryParams=decodeURI(params[1]).split("&").map((function(param){return param.split("=")})).reduce((function(values,_a){var key=_a[0],value=_a[1];return values[key]=value,values}),{});this.sessionId=queryParams.sessionId;var secret=queryParams.secret,recorder=queryParams.recorder,webrtcStatsInterval=queryParams.webrtcStatsInterval,sendBrowserLogs=queryParams.sendBrowserLogs;secret&&(this.openvidu.secret=secret),recorder&&(this.openvidu.recorder=!0),webrtcStatsInterval&&(this.openvidu.webrtcStatsInterval=+webrtcStatsInterval),sendBrowserLogs&&(this.openvidu.sendBrowserLogs=sendBrowserLogs),this.openvidu.wsUri="wss://"+url.host+"/openvidu",this.openvidu.httpUri="https://"+url.host}else logger.error('Token "'+token+'" is not valid')},Session.prototype.processJoinRoomResponse=function(opts){if(this.sessionId=opts.session,null!=opts.coturnIp&&null!=opts.turnUsername&&null!=opts.turnCredential){var turnUrl1="turn:"+opts.coturnIp+":3478";this.openvidu.iceServers=[{urls:[turnUrl1],username:opts.turnUsername,credential:opts.turnCredential}],logger.log("STUN/TURN server IP: "+opts.coturnIp),logger.log("TURN temp credentials ["+opts.turnUsername+":"+opts.turnCredential+"]")}this.openvidu.role=opts.role,this.openvidu.finalUserId=opts.finalUserId,this.openvidu.mediaServer=opts.mediaServer,this.capabilities={subscribe:!0,publish:"SUBSCRIBER"!==this.openvidu.role,forceUnpublish:"MODERATOR"===this.openvidu.role,forceDisconnect:"MODERATOR"===this.openvidu.role},logger.info("openvidu-server version: "+opts.version),opts.version!==this.openvidu.libraryVersion&&logger.warn("OpenVidu Server ("+opts.version+") and OpenVidu Browser ("+this.openvidu.libraryVersion+") versions do NOT match. There may be incompatibilities")},Session}(EventDispatcher_1.EventDispatcher);exports.Session=Session}}]);
//# sourceMappingURL=4.b1639119.iframe.bundle.js.map